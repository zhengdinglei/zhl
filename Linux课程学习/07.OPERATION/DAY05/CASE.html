
<!-- saved from url=(0080)http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>CASE</title>
    
    <script type="text/javascript" src="./CASE_files/jquery.min.js">
    </script>
    <script type="text/javascript" src="./CASE_files/jquery.snippet.js">
    </script>
    <script type="text/javascript" src="./CASE_files/main.js">
    </script>
    <link type="text/css" href="./CASE_files/index.css" rel="Stylesheet">
    <link type="text/css" href="./CASE_files/jquery.snippet.css" rel="Stylesheet">
  </head>
  <body>
    <div class="source_style_case">
      <a name="page_top_case" id="top_anchor">
      </a><a id="link_top" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#page_top_case">Top</a>
      <h1>NSD OPERATION DAY05</h1>
      <ol class="index">
        <li>
          <a href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#case1">案例1：安装部署Tomcat服务器</a>
        </li>
        <li>
          <a href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#case2">案例2：使用Tomcat部署虚拟主机</a>
        </li>
        <li>
          <a href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#case3">案例3：使用Varnish加速Web</a>
        </li>
      </ol>
      <a name="case1">
      </a>
      <h2>1 案例1：安装部署Tomcat服务器</h2>
      <h3>1.1 问题</h3>
      <p>本案例要求部署Tomcat服务器，具体要求如下：</p>
      <ul class="list">
        <li>安装部署JDK基础环境
</li>
        <li>安装部署Tomcat服务器
</li>
        <li>创建JSP测试页面，文件名为test.jsp，显示服务器当前时间
</li>
      </ul>
      <p>然后客户机访问此Web服务器验证效果：</p>
      <ul class="list">
        <li>使用火狐浏览器访问Tomcat服务器的8080端口，浏览默认首页
</li>
        <li>使用火狐浏览器访问Tomcat服务器的8080端口，浏览默认测试页面
</li>
      </ul>
      <h3>1.2 方案</h3>
      <p>使用2台RHEL7虚拟机，其中一台作为Tomcat服务器（192.168.2.100）、另外一台作为测试用的Linux客户机（192.168.2.5），如图-1所示。</p>
      <div class="image">
        <img src="./CASE_files/image001.png">
        <p>图-1</p>
      </div>
      <p>使用RPM安装JDK基础环境</p>
      <p>使用源码安装部署Tomcat服务器</p>
      <h3>1.3 步骤</h3>
      <p>实现此案例需要按照如下步骤进行。</p>
      <p class="number">步骤一：部署Tomcat服务器软件(192.168.2.100/24)</p>
      <p>1）使用RPM安装JDK环境</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># yum <span class="sh_symbol">-</span>y install  java<span class="sh_number">-1.8.0</span><span class="sh_symbol">-</span>openjdk&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//安装JDK</span></li><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># yum <span class="sh_symbol">-</span>y install java<span class="sh_number">-1.8.0</span><span class="sh_symbol">-</span>openjdk<span class="sh_symbol">-</span>headless&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//安装JDK</span></li><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># java <span class="sh_symbol">-</span>version&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//查看JAVA版本</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@web1 ~]# yum -y install  java-1.8.0-openjdk				//安装JDK
[root@web1 ~]# yum -y install java-1.8.0-openjdk-headless		//安装JDK
[root@web1 ~]# java -version									//查看JAVA版本
</pre></div></div>
      <p>2）安装Tomcat（apache-tomcat-8.0.30.tar.gz软件包，在lnmp_soft中有提供）</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># tar <span class="sh_symbol">-</span>xf  apache<span class="sh_symbol">-</span>tomcat<span class="sh_number">-8.0.30</span><span class="sh_symbol">.</span>tar<span class="sh_symbol">.</span>gz</li><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># mv apache<span class="sh_symbol">-</span>tomcat<span class="sh_number">-8.0.30</span><span class="sh_normal">  </span><span class="sh_symbol">/</span><span class="sh_normal">usr</span><span class="sh_symbol">/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span>tomcat</li><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># <span class="sh_normal">ls </span><span class="sh_symbol">/</span><span class="sh_normal">usr</span><span class="sh_symbol">/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span>tomcat</li><li><span class="sh_normal">bin</span><span class="sh_symbol">/</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//主程序目录</span></li><li><span class="sh_normal">lib</span><span class="sh_symbol">/</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//库文件目录</span></li><li><span class="sh_normal">logs</span><span class="sh_symbol">/</span>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//日志目录  </span></li><li><span class="sh_normal">temp</span><span class="sh_symbol">/</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//临时目录</span></li><li><span class="sh_normal">work</span><span class="sh_symbol">/</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//自动编译目录jsp代码转换servlet</span></li><li><span class="sh_normal">conf</span><span class="sh_symbol">/</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//配置文件目录</span></li><li><span class="sh_normal">webapps</span><span class="sh_symbol">/</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//页面目录</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@web1 ~]# tar -xf  apache-tomcat-8.0.30.tar.gz
[root@web1 ~]# mv apache-tomcat-8.0.30  /usr/local/tomcat
[root@web1 ~]# ls /usr/local/tomcat
bin/											//主程序目录
lib/											//库文件目录
logs/  										//日志目录  
temp/ 										//临时目录
work/										//自动编译目录jsp代码转换servlet
conf/										//配置文件目录
webapps/										//页面目录
</pre></div></div>
      <p>3）启动服务</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># <span class="sh_regexp">/usr/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">tomcat</span><span class="sh_symbol">/</span><span class="sh_normal">bin</span><span class="sh_symbol">/</span>startup<span class="sh_symbol">.</span>sh</li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># firewall<span class="sh_symbol">-</span>cmd <span class="sh_symbol">--</span>set<span class="sh_symbol">-</span><span class="sh_keyword">default</span><span class="sh_symbol">-</span>zone<span class="sh_symbol">=</span>trusted</li><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># setenforce <span class="sh_number">0</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@web1 ~]# /usr/local/tomcat/bin/startup.sh

[root@web1 ~]# firewall-cmd --set-default-zone=trusted
[root@web1 ~]# setenforce 0
</pre></div></div>
      <p>4）服务器验证端口信息</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># netstat <span class="sh_symbol">-</span>nutlp <span class="sh_symbol">|</span>grep java&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//查看java监听的端口</span></li><li>tcp        <span class="sh_number">0</span>      <span class="sh_number">0</span> <span class="sh_symbol">:::</span><span class="sh_number">8080</span>              <span class="sh_symbol">:::*</span>                LISTEN      <span class="sh_number">2778</span><span class="sh_symbol">/</span>java           </li><li>tcp        <span class="sh_number">0</span>      <span class="sh_number">0</span> <span class="sh_symbol">::</span>ffff<span class="sh_symbol">:</span><span class="sh_number">127.0.0.1</span><span class="sh_symbol">:</span><span class="sh_number">8005</span>     <span class="sh_symbol">:::*</span>         LISTEN       <span class="sh_number">2778</span><span class="sh_symbol">/</span>java  </li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@web1 ~]# netstat -nutlp |grep java		//查看java监听的端口
tcp        0      0 :::8080              :::*                LISTEN      2778/java           
tcp        0      0 ::ffff:127.0.0.1:8005     :::*         LISTEN       2778/java  
</pre></div></div>
      <p>提示：如果检查端口时，8005端口启动非常慢，可用使用下面的命令用urandom替换random（非必须操作）。</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># <span class="sh_normal">mv </span><span class="sh_symbol">/</span><span class="sh_normal">dev</span><span class="sh_symbol">/</span><span class="sh_normal">random  </span><span class="sh_symbol">/</span><span class="sh_normal">dev</span><span class="sh_symbol">/</span>random<span class="sh_symbol">.</span>bak</li><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># ln <span class="sh_symbol">-</span><span class="sh_normal">s </span><span class="sh_symbol">/</span><span class="sh_normal">dev</span><span class="sh_symbol">/</span><span class="sh_normal">urandom  </span><span class="sh_symbol">/</span><span class="sh_normal">dev</span><span class="sh_symbol">/</span>random</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@web1 ~]# mv /dev/random  /dev/random.bak
[root@web1 ~]# ln -s /dev/urandom  /dev/random
</pre></div></div>
      <p>5）客户端浏览测试页面(proxy作为客户端)</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@proxy <span class="sh_symbol">~]</span># firefox http<span class="sh_symbol">:</span><span class="sh_comment">//192.168.2.100:8080</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@proxy ~]# firefox http://192.168.2.100:8080
</pre></div></div>
      <p class="number">步骤二：修改Tomcat配置文件</p>
      <p>1）创建测试JSP页面</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># <span class="sh_normal">vim  </span><span class="sh_symbol">/</span><span class="sh_normal">usr</span><span class="sh_symbol">/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">tomcat</span><span class="sh_symbol">/</span><span class="sh_normal">webapps</span><span class="sh_symbol">/</span><span class="sh_normal">ROOT</span><span class="sh_symbol">/</span>test<span class="sh_symbol">.</span>jsp</li><li><span class="sh_symbol">&lt;</span>html<span class="sh_symbol">&gt;</span></li><li><span class="sh_symbol">&lt;</span>body<span class="sh_symbol">&gt;</span></li><li><span class="sh_symbol">&lt;</span>center<span class="sh_symbol">&gt;</span></li><li>Now time is<span class="sh_symbol">:</span> <span class="sh_symbol">&lt;%=</span><span class="sh_keyword">new</span> java<span class="sh_symbol">.</span>util<span class="sh_symbol">.</span><span class="sh_predef_func">Date</span><span class="sh_symbol">()%&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//显示服务器当前时间</span></li><li><span class="sh_symbol">&lt;/</span>center<span class="sh_symbol">&gt;</span></li><li><span class="sh_symbol">&lt;/</span>body<span class="sh_symbol">&gt;</span></li><li><span class="sh_symbol">&lt;/</span>html<span class="sh_symbol">&gt;</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@web1 ~]# vim  /usr/local/tomcat/webapps/ROOT/test.jsp
&lt;html&gt;
&lt;body&gt;
&lt;center&gt;
Now time is: &lt;%=new java.util.Date()%&gt;			//显示服务器当前时间
&lt;/center&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></div></div>
      <p>2）重启服务</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># <span class="sh_regexp">/usr/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">tomcat</span><span class="sh_symbol">/</span><span class="sh_normal">bin</span><span class="sh_symbol">/</span>shutdown<span class="sh_symbol">.</span>sh</li><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># <span class="sh_regexp">/usr/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">tomcat</span><span class="sh_symbol">/</span><span class="sh_normal">bin</span><span class="sh_symbol">/</span>startup<span class="sh_symbol">.</span>sh</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@web1 ~]# /usr/local/tomcat/bin/shutdown.sh
[root@web1 ~]# /usr/local/tomcat/bin/startup.sh
</pre></div></div>
      <p class="number">步骤三：验证测试</p>
      <p>1）服务器验证端口信息</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># netstat <span class="sh_symbol">-</span>nutlp <span class="sh_symbol">|</span>grep java&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//查看java监听的端口</span></li><li>tcp        <span class="sh_number">0</span>      <span class="sh_number">0</span> <span class="sh_symbol">:::</span><span class="sh_number">8080</span>              <span class="sh_symbol">:::*</span>                LISTEN      <span class="sh_number">2778</span><span class="sh_symbol">/</span>java           </li><li>tcp        <span class="sh_number">0</span>      <span class="sh_number">0</span> <span class="sh_symbol">::</span>ffff<span class="sh_symbol">:</span><span class="sh_number">127.0.0.1</span><span class="sh_symbol">:</span><span class="sh_number">8005</span>     <span class="sh_symbol">:::*</span>         LISTEN       <span class="sh_number">2778</span><span class="sh_symbol">/</span>java  </li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@web1 ~]# netstat -nutlp |grep java		//查看java监听的端口
tcp        0      0 :::8080              :::*                LISTEN      2778/java           
tcp        0      0 ::ffff:127.0.0.1:8005     :::*         LISTEN       2778/java  
</pre></div></div>
      <p>提示：如果检查端口时，8005端口启动非常慢，可用使用下面的命令用urandom替换random（非必须操作）。</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># <span class="sh_normal">mv </span><span class="sh_symbol">/</span><span class="sh_normal">dev</span><span class="sh_symbol">/</span><span class="sh_normal">random  </span><span class="sh_symbol">/</span><span class="sh_normal">dev</span><span class="sh_symbol">/</span>random<span class="sh_symbol">.</span>bak</li><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># ln <span class="sh_symbol">-</span><span class="sh_normal">s </span><span class="sh_symbol">/</span><span class="sh_normal">dev</span><span class="sh_symbol">/</span><span class="sh_normal">urandom  </span><span class="sh_symbol">/</span><span class="sh_normal">dev</span><span class="sh_symbol">/</span>random</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@web1 ~]# mv /dev/random  /dev/random.bak
[root@web1 ~]# ln -s /dev/urandom  /dev/random
</pre></div></div>
      <p>2）客户端浏览测试页面(proxy充当客户端角色)</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@proxy <span class="sh_symbol">~]</span># firefox http<span class="sh_symbol">:</span><span class="sh_comment">//192.168.2.100:8080</span></li><li><span class="sh_symbol">[</span>root@proxy <span class="sh_symbol">~]</span># firefox http<span class="sh_symbol">:</span><span class="sh_comment">//192.168.2.100:8080/test.jsp</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@proxy ~]# firefox http://192.168.2.100:8080
[root@proxy ~]# firefox http://192.168.2.100:8080/test.jsp
</pre></div></div>
      <a name="case2">
      </a>
      <h2>2 案例2：使用Tomcat部署虚拟主机</h2>
      <h3>2.1 问题</h3>
      <p>沿用练习二，使用Tomcat部署加密虚拟主机，实现以下要求：</p>
      <ul class="list">
        <li>实现两个基于域名的虚拟主机，域名分别为：www.a.com和 www.b.com
</li>
        <li>使用www.a.com域名访问的页面根路径为/usr/local/tomcat/a/ROOT
</li>
        <li>使用www.b.com域名访问的页面根路径为/usr/local/tomcat/b/base
</li>
        <li>访问www.a.com/test时，页面自动跳转到/var/www/html目录下的页面
</li>
        <li>访问页面时支持SSL加密通讯
</li>
        <li>私钥、证书存储路径为/usr/local/tomcat/conf/cert
</li>
        <li>每个虚拟主机都拥有独立的访问日志文件
</li>
        <li>配置tomcat集群环境
</li>
      </ul>
      <h3>2.2 方案</h3>
      <p>修改server.xml配置文件，创建两个域名的虚拟主机，修改如下两个参数块：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li># <span class="sh_normal">cat </span><span class="sh_symbol">/</span><span class="sh_normal">usr</span><span class="sh_symbol">/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">tomcat</span><span class="sh_symbol">/</span><span class="sh_normal">conf</span><span class="sh_symbol">/</span>server<span class="sh_symbol">.</span>xml</li><li><span class="sh_symbol">&lt;</span>Server<span class="sh_symbol">&gt;</span></li><li>   <span class="sh_symbol">&lt;</span>Service<span class="sh_symbol">&gt;</span></li><li>     <span class="sh_symbol">&lt;</span>Connector port<span class="sh_symbol">=</span><span class="sh_number">8080</span><span class="sh_normal"> </span><span class="sh_symbol">/&gt;</span></li><li>     <span class="sh_symbol">&lt;</span>Connector port<span class="sh_symbol">=</span><span class="sh_number">8009</span><span class="sh_normal"> </span><span class="sh_symbol">/&gt;</span></li><li>     <span class="sh_symbol">&lt;</span>Engine name<span class="sh_symbol">=</span><span class="sh_string">"Catalina"</span> defaultHost<span class="sh_symbol">=</span><span class="sh_string">"localhost"</span><span class="sh_symbol">&gt;</span></li><li><span class="sh_symbol">&lt;</span>Host name<span class="sh_symbol">=</span><span class="sh_string">"www.a.com"</span> appBase<span class="sh_symbol">=</span><span class="sh_string">"a"</span> unpackWARS<span class="sh_symbol">=</span><span class="sh_string">"true"</span> autoDeploy<span class="sh_symbol">=</span><span class="sh_string">"true"</span><span class="sh_symbol">&gt;</span></li><li><span class="sh_symbol">&lt;/</span>Host<span class="sh_symbol">&gt;</span></li><li><span class="sh_symbol">&lt;</span>Host name<span class="sh_symbol">=</span><span class="sh_string">"www.b.com"</span> appBase<span class="sh_symbol">=</span><span class="sh_string">"b"</span> unpackWARS<span class="sh_symbol">=</span><span class="sh_string">"true"</span> autoDeploy<span class="sh_symbol">=</span><span class="sh_string">"true"</span><span class="sh_symbol">&gt;</span></li><li><span class="sh_symbol">&lt;/</span>Host<span class="sh_symbol">&gt;</span></li><li>… …</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;"># cat /usr/local/tomcat/conf/server.xml
&lt;Server&gt;
   &lt;Service&gt;
     &lt;Connector port=8080 /&gt;
     &lt;Connector port=8009 /&gt;
     &lt;Engine name="Catalina" defaultHost="localhost"&gt;
&lt;Host name="www.a.com" appBase="a" unpackWARS="true" autoDeploy="true"&gt;
&lt;/Host&gt;
&lt;Host name="www.b.com" appBase="b" unpackWARS="true" autoDeploy="true"&gt;
&lt;/Host&gt;
… …
</pre></div></div>
      <h3>2.3 步骤</h3>
      <p>实现此案例需要按照如下步骤进行。</p>
      <p class="number">步骤一：配置服务器虚拟主机</p>
      <p>1）修改server.xml配置文件，创建虚拟主机</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># <span class="sh_normal">vim </span><span class="sh_symbol">/</span><span class="sh_normal">usr</span><span class="sh_symbol">/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">tomcat</span><span class="sh_symbol">/</span><span class="sh_normal">conf</span><span class="sh_symbol">/</span>server<span class="sh_symbol">.</span>xml</li><li>… …</li><li><span class="sh_symbol">&lt;</span>Host name<span class="sh_symbol">=</span><span class="sh_string">"www.a.com"</span> appBase<span class="sh_symbol">=</span><span class="sh_string">"a"</span> unpackWARS<span class="sh_symbol">=</span><span class="sh_string">"true"</span> autoDeploy<span class="sh_symbol">=</span><span class="sh_string">"true"</span><span class="sh_symbol">&gt;</span></li><li><span class="sh_symbol">&lt;/</span>Host<span class="sh_symbol">&gt;</span></li><li><span class="sh_symbol">&lt;</span>Host name<span class="sh_symbol">=</span><span class="sh_string">"www.b.com"</span> appBase<span class="sh_symbol">=</span><span class="sh_string">"b"</span> unpackWARS<span class="sh_symbol">=</span><span class="sh_string">"true"</span> autoDeploy<span class="sh_symbol">=</span><span class="sh_string">"true"</span><span class="sh_symbol">&gt;</span></li><li><span class="sh_symbol">&lt;/</span>Host<span class="sh_symbol">&gt;</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@web1 ~]# vim /usr/local/tomcat/conf/server.xml
… …
&lt;Host name="www.a.com" appBase="a" unpackWARS="true" autoDeploy="true"&gt;
&lt;/Host&gt;
&lt;Host name="www.b.com" appBase="b" unpackWARS="true" autoDeploy="true"&gt;
&lt;/Host&gt;
</pre></div></div>
      <p>2）创建虚拟主机对应的页面根路径</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># mkdir <span class="sh_symbol">-</span><span class="sh_normal">p  </span><span class="sh_symbol">/</span><span class="sh_normal">usr</span><span class="sh_symbol">/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">tomcat</span><span class="sh_symbol">/</span><span class="sh_cbracket">{</span>a<span class="sh_symbol">,</span>b<span class="sh_cbracket">}</span><span class="sh_symbol">/</span>ROOT</li><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># echo <span class="sh_string">"AAA"</span>   <span class="sh_symbol">&gt;</span> <span class="sh_regexp">/usr/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">tomcat</span><span class="sh_symbol">/</span><span class="sh_normal">a</span><span class="sh_symbol">/</span><span class="sh_normal">ROOT</span><span class="sh_symbol">/</span>index<span class="sh_symbol">.</span>html</li><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># echo <span class="sh_string">"BBB"</span> <span class="sh_symbol">&gt;</span> <span class="sh_regexp">/usr/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">tomcat</span><span class="sh_symbol">/</span><span class="sh_normal">b</span><span class="sh_symbol">/</span><span class="sh_normal">ROOT</span><span class="sh_symbol">/</span>index<span class="sh_symbol">.</span>html</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@web1 ~]# mkdir -p  /usr/local/tomcat/{a,b}/ROOT
[root@web1 ~]# echo "AAA"   &gt; /usr/local/tomcat/a/ROOT/index.html
[root@web1 ~]# echo "BBB" &gt; /usr/local/tomcat/b/ROOT/index.html
</pre></div></div>
      <p>3）重启Tomcat服务器</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># <span class="sh_regexp">/usr/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">tomcat</span><span class="sh_symbol">/</span><span class="sh_normal">bin</span><span class="sh_symbol">/</span>shutdown<span class="sh_symbol">.</span>sh</li><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># <span class="sh_regexp">/usr/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">tomcat</span><span class="sh_symbol">/</span><span class="sh_normal">bin</span><span class="sh_symbol">/</span>startup<span class="sh_symbol">.</span>sh</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@web1 ~]# /usr/local/tomcat/bin/shutdown.sh
[root@web1 ~]# /usr/local/tomcat/bin/startup.sh
</pre></div></div>
      <p>4）客户端设置host文件，并浏览测试页面进行测试(proxy充当客户端角色)</p>
      <p>注意：ssh远程连接时使用使用-X参数才可以！！！</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@proxy <span class="sh_symbol">~]</span># <span class="sh_normal">vim </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span>hosts</li><li>… …</li><li><span class="sh_number">192.168.2.100</span>  &nbsp;&nbsp;&nbsp;&nbsp;www<span class="sh_symbol">.</span>a<span class="sh_symbol">.</span>com  www<span class="sh_symbol">.</span>b<span class="sh_symbol">.</span>com</li><li><span class="sh_symbol">[</span>root@proxy <span class="sh_symbol">~]</span># firefox http<span class="sh_symbol">:</span><span class="sh_comment">//www.a.com:8080/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//注意访问的端口为8080</span></li><li><span class="sh_symbol">[</span>root@proxy <span class="sh_symbol">~]</span># firefox http<span class="sh_symbol">:</span><span class="sh_comment">//www.b.com:8080/</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@proxy ~]# vim /etc/hosts
… …
192.168.2.100  	www.a.com  www.b.com
[root@proxy ~]# firefox http://www.a.com:8080/		//注意访问的端口为8080
[root@proxy ~]# firefox http://www.b.com:8080/
</pre></div></div>
      <p class="number">步骤二：修改www.b.com网站的首页目录为base</p>
      <p>1）使用docBase参数可以修改默认网站首页路径</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># <span class="sh_normal">vim </span><span class="sh_symbol">/</span><span class="sh_normal">usr</span><span class="sh_symbol">/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">tomcat</span><span class="sh_symbol">/</span><span class="sh_normal">conf</span><span class="sh_symbol">/</span>server<span class="sh_symbol">.</span>xml</li><li>… …</li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_symbol">&lt;</span>Host name<span class="sh_symbol">=</span><span class="sh_string">"www.a.com"</span> appBase<span class="sh_symbol">=</span><span class="sh_string">"a"</span> unpackWARS<span class="sh_symbol">=</span><span class="sh_string">"true"</span> autoDeploy<span class="sh_symbol">=</span><span class="sh_string">"true"</span><span class="sh_symbol">&gt;</span></li><li><span class="sh_symbol">&lt;/</span>Host<span class="sh_symbol">&gt;</span></li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_symbol">&lt;</span>Host name<span class="sh_symbol">=</span><span class="sh_string">"www.b.com"</span> appBase<span class="sh_symbol">=</span><span class="sh_string">"b"</span> unpackWARS<span class="sh_symbol">=</span><span class="sh_string">"true"</span> autoDeploy<span class="sh_symbol">=</span><span class="sh_string">"true"</span><span class="sh_symbol">&gt;</span></li><li><span class="sh_symbol">&lt;</span>Context path<span class="sh_symbol">=</span><span class="sh_string">""</span> docBase<span class="sh_symbol">=</span><span class="sh_string">"base"</span><span class="sh_symbol">/&gt;</span></li><li><span class="sh_symbol">&lt;/</span>Host<span class="sh_symbol">&gt;</span></li><li>… …</li><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># <span class="sh_normal">mkdir  </span><span class="sh_symbol">/</span><span class="sh_normal">usr</span><span class="sh_symbol">/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">tomcat</span><span class="sh_symbol">/</span><span class="sh_normal">b</span><span class="sh_symbol">/</span>base</li><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># echo <span class="sh_string">"BASE"</span> <span class="sh_symbol">&gt;</span> <span class="sh_regexp">/usr/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">tomcat</span><span class="sh_symbol">/</span><span class="sh_normal">b</span><span class="sh_symbol">/</span><span class="sh_normal">base</span><span class="sh_symbol">/</span>index<span class="sh_symbol">.</span>html</li><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># <span class="sh_regexp">/usr/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">tomcat</span><span class="sh_symbol">/</span><span class="sh_normal">bin</span><span class="sh_symbol">/</span>shutdown<span class="sh_symbol">.</span>sh</li><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># <span class="sh_regexp">/usr/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">tomcat</span><span class="sh_symbol">/</span><span class="sh_normal">bin</span><span class="sh_symbol">/</span>startup<span class="sh_symbol">.</span>sh</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@web1 ~]# vim /usr/local/tomcat/conf/server.xml
… …

&lt;Host name="www.a.com" appBase="a" unpackWARS="true" autoDeploy="true"&gt;
&lt;/Host&gt;

&lt;Host name="www.b.com" appBase="b" unpackWARS="true" autoDeploy="true"&gt;
&lt;Context path="" docBase="base"/&gt;
&lt;/Host&gt;
… …
[root@web1 ~]# mkdir  /usr/local/tomcat/b/base
[root@web1 ~]# echo "BASE" &gt; /usr/local/tomcat/b/base/index.html
[root@web1 ~]# /usr/local/tomcat/bin/shutdown.sh
[root@web1 ~]# /usr/local/tomcat/bin/startup.sh
</pre></div></div>
      <p>2）测试查看页面是否正确(proxy充当客户端角色)</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@proxy <span class="sh_symbol">~]</span># firefox http<span class="sh_symbol">:</span><span class="sh_comment">//www.b.com:8080/&nbsp;&nbsp;&nbsp;&nbsp;    //结果为base目录下的页面内容</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@proxy ~]# firefox http://www.b.com:8080/	    //结果为base目录下的页面内容
</pre></div></div>
      <p class="number">步骤三：跳转</p>
      <p>1）当用户访问http://www.a.com/test打开/var/www/html目录下的页面</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># <span class="sh_normal">vim </span><span class="sh_symbol">/</span><span class="sh_normal">usr</span><span class="sh_symbol">/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">tomcat</span><span class="sh_symbol">/</span><span class="sh_normal">conf</span><span class="sh_symbol">/</span>server<span class="sh_symbol">.</span>xml</li><li>… …</li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_symbol">&lt;</span>Host name<span class="sh_symbol">=</span><span class="sh_string">"www.a.com"</span> appBase<span class="sh_symbol">=</span><span class="sh_string">"a"</span> unpackWARS<span class="sh_symbol">=</span><span class="sh_string">"true"</span> autoDeploy<span class="sh_symbol">=</span><span class="sh_string">"true"</span><span class="sh_symbol">&gt;</span></li><li><span class="sh_symbol">&lt;</span>Context path<span class="sh_symbol">=</span><span class="sh_string">"/test"</span> docBase<span class="sh_symbol">=</span><span class="sh_string">"/var/www/html/"</span> <span class="sh_symbol">/&gt;</span></li><li><span class="sh_symbol">&lt;/</span>Host<span class="sh_symbol">&gt;</span></li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_symbol">&lt;</span>Host name<span class="sh_symbol">=</span><span class="sh_string">"www.b.com"</span> appBase<span class="sh_symbol">=</span><span class="sh_string">"b"</span> unpackWARS<span class="sh_symbol">=</span><span class="sh_string">"true"</span> autoDeploy<span class="sh_symbol">=</span><span class="sh_string">"true"</span><span class="sh_symbol">&gt;</span></li><li><span class="sh_symbol">&lt;</span>Context path<span class="sh_symbol">=</span><span class="sh_string">""</span> docBase<span class="sh_symbol">=</span><span class="sh_string">"base"</span> <span class="sh_symbol">/&gt;</span></li><li><span class="sh_symbol">&lt;/</span>Host<span class="sh_symbol">&gt;</span></li><li>… …</li><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># echo <span class="sh_string">"Test"</span> <span class="sh_symbol">&gt;</span> <span class="sh_regexp">/var/</span><span class="sh_normal">www</span><span class="sh_symbol">/</span><span class="sh_normal">html</span><span class="sh_symbol">/</span>index<span class="sh_symbol">.</span>html</li><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># <span class="sh_regexp">/usr/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">tomcat</span><span class="sh_symbol">/</span><span class="sh_normal">bin</span><span class="sh_symbol">/</span>shutdown<span class="sh_symbol">.</span>sh</li><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># <span class="sh_regexp">/usr/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">tomcat</span><span class="sh_symbol">/</span><span class="sh_normal">bin</span><span class="sh_symbol">/</span>startup<span class="sh_symbol">.</span>sh</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@web1 ~]# vim /usr/local/tomcat/conf/server.xml
… …

&lt;Host name="www.a.com" appBase="a" unpackWARS="true" autoDeploy="true"&gt;
&lt;Context path="/test" docBase="/var/www/html/" /&gt;
&lt;/Host&gt;

&lt;Host name="www.b.com" appBase="b" unpackWARS="true" autoDeploy="true"&gt;
&lt;Context path="" docBase="base" /&gt;
&lt;/Host&gt;
… …
[root@web1 ~]# echo "Test" &gt; /var/www/html/index.html
[root@web1 ~]# /usr/local/tomcat/bin/shutdown.sh
[root@web1 ~]# /usr/local/tomcat/bin/startup.sh
</pre></div></div>
      <p>2）测试查看页面是否正确(proxy充当客户端角色)</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@proxy <span class="sh_symbol">~]</span># firefox http<span class="sh_symbol">:</span><span class="sh_comment">//www.a.com:8080/test&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span class="sh_comment">//返回/var/www/html/index.html的内容</span></li><li><span class="sh_comment">//注意，访问的端口为8080</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@proxy ~]# firefox http://www.a.com:8080/test	
//返回/var/www/html/index.html的内容
//注意，访问的端口为8080
</pre></div></div>
      <p class="number">步骤四：配置Tomcat支持SSL加密网站</p>
      <p>1）创建加密用的私钥和证书文件</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># keytool <span class="sh_symbol">-</span>genkeypair <span class="sh_symbol">-</span>alias tomcat <span class="sh_symbol">-</span>keyalg RSA <span class="sh_symbol">-</span><span class="sh_normal">keystore </span><span class="sh_symbol">/</span><span class="sh_normal">usr</span><span class="sh_symbol">/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">tomcat</span><span class="sh_symbol">/</span>keystore&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//提示输入密码为:123456</span></li><li><span class="sh_comment">//-genkeypair &nbsp;&nbsp;&nbsp;&nbsp;生成密钥对</span></li><li><span class="sh_comment">//-alias tomcat &nbsp;&nbsp;&nbsp;&nbsp;密钥别名</span></li><li><span class="sh_comment">//-keyalg RSA &nbsp;&nbsp;&nbsp;&nbsp;定义密钥算法为RSA算法</span></li><li><span class="sh_comment">//-keystore &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;定义密钥文件存储在:/usr/local/tomcat/keystore</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@web1 ~]# keytool -genkeypair -alias tomcat -keyalg RSA -keystore /usr/local/tomcat/keystore				//提示输入密码为:123456
//-genkeypair 	生成密钥对
//-alias tomcat 	密钥别名
//-keyalg RSA 	定义密钥算法为RSA算法
//-keystore 		定义密钥文件存储在:/usr/local/tomcat/keystore
</pre></div></div>
      <p>2)再次修改server.xml配置文件，创建支持加密连接的Connector</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># <span class="sh_normal">vim </span><span class="sh_symbol">/</span><span class="sh_normal">usr</span><span class="sh_symbol">/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">tomcat</span><span class="sh_symbol">/</span><span class="sh_normal">conf</span><span class="sh_symbol">/</span>server<span class="sh_symbol">.</span>xml</li><li>… …</li><li><span class="sh_symbol">&lt;</span>Connector port<span class="sh_symbol">=</span><span class="sh_string">"8443"</span> protocol<span class="sh_symbol">=</span><span class="sh_string">"org.apache.coyote.http11.Http11NioProtocol"</span></li><li>maxThreads<span class="sh_symbol">=</span><span class="sh_string">"150"</span> SSLEnabled<span class="sh_symbol">=</span><span class="sh_string">"true"</span> scheme<span class="sh_symbol">=</span><span class="sh_string">"https"</span> secure<span class="sh_symbol">=</span><span class="sh_string">"true"</span></li><li>keystoreFile<span class="sh_symbol">=</span><span class="sh_string">"/usr/local/tomcat/keystore"</span> keystorePass<span class="sh_symbol">=</span><span class="sh_string">"123456"</span> clientAuth<span class="sh_symbol">=</span><span class="sh_string">"false"</span> sslProtocol<span class="sh_symbol">=</span><span class="sh_string">"TLS"</span> <span class="sh_symbol">/&gt;</span></li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_comment">//备注，默认这段Connector被注释掉了，打开注释，添加密钥信息即可</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@web1 ~]# vim /usr/local/tomcat/conf/server.xml
… …
&lt;Connector port="8443" protocol="org.apache.coyote.http11.Http11NioProtocol"
maxThreads="150" SSLEnabled="true" scheme="https" secure="true"
keystoreFile="/usr/local/tomcat/keystore" keystorePass="123456" clientAuth="false" sslProtocol="TLS" /&gt;

//备注，默认这段Connector被注释掉了，打开注释，添加密钥信息即可
</pre></div></div>
      <p>3）重启Tomcat服务器</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># <span class="sh_regexp">/usr/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">tomcat</span><span class="sh_symbol">/</span><span class="sh_normal">bin</span><span class="sh_symbol">/</span>shutdown<span class="sh_symbol">.</span>sh</li><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># <span class="sh_regexp">/usr/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">tomcat</span><span class="sh_symbol">/</span><span class="sh_normal">bin</span><span class="sh_symbol">/</span>startup<span class="sh_symbol">.</span>sh</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@web1 ~]# /usr/local/tomcat/bin/shutdown.sh
[root@web1 ~]# /usr/local/tomcat/bin/startup.sh
</pre></div></div>
      <p>4）客户端设置host文件，并浏览测试页面进行测试(proxy充当客户端角色)</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@proxy <span class="sh_symbol">~]</span># <span class="sh_normal">vim </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span>hosts</li><li>… …</li><li><span class="sh_number">192.168.2.100</span>  &nbsp;&nbsp;&nbsp;&nbsp;www<span class="sh_symbol">.</span>a<span class="sh_symbol">.</span>com  www<span class="sh_symbol">.</span>b<span class="sh_symbol">.</span>com</li><li><span class="sh_symbol">[</span>root@proxy <span class="sh_symbol">~]</span># firefox https<span class="sh_symbol">:</span><span class="sh_comment">//www.a.com:8443/</span></li><li><span class="sh_symbol">[</span>root@proxy <span class="sh_symbol">~]</span># firefox https<span class="sh_symbol">:</span><span class="sh_comment">//www.b.com:8443/</span></li><li><span class="sh_symbol">[</span>root@proxy <span class="sh_symbol">~]</span># firefox https<span class="sh_symbol">:</span><span class="sh_comment">//192.168.2.100:8443/</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@proxy ~]# vim /etc/hosts
… …
192.168.2.100  	www.a.com  www.b.com
[root@proxy ~]# firefox https://www.a.com:8443/
[root@proxy ~]# firefox https://www.b.com:8443/
[root@proxy ~]# firefox https://192.168.2.100:8443/
</pre></div></div>
      <p class="number">步骤五：配置Tomcat日志</p>
      <p>1)为每个虚拟主机设置不同的日志文件</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># <span class="sh_normal">vim </span><span class="sh_symbol">/</span><span class="sh_normal">usr</span><span class="sh_symbol">/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">tomcat</span><span class="sh_symbol">/</span><span class="sh_normal">conf</span><span class="sh_symbol">/</span>server<span class="sh_symbol">.</span>xml</li><li><span class="sh_symbol">..</span> <span class="sh_symbol">..</span></li><li><span class="sh_symbol">&lt;</span>Host name<span class="sh_symbol">=</span><span class="sh_string">"www.a.com"</span> appBase<span class="sh_symbol">=</span><span class="sh_string">"a"</span> unpackWARS<span class="sh_symbol">=</span><span class="sh_string">"true"</span> autoDeploy<span class="sh_symbol">=</span><span class="sh_string">"true"</span><span class="sh_symbol">&gt;</span></li><li><span class="sh_symbol">&lt;</span>Context path<span class="sh_symbol">=</span><span class="sh_string">"/test"</span> docBase<span class="sh_symbol">=</span><span class="sh_string">"/var/www/html/"</span> <span class="sh_symbol">/&gt;</span></li><li>#从默认localhost虚拟主机中把Valve这段复制过来，适当修改下即可</li><li><span class="sh_symbol">&lt;</span>Valve className<span class="sh_symbol">=</span><span class="sh_string">"org.apache.catalina.valves.AccessLogValve"</span> directory<span class="sh_symbol">=</span><span class="sh_string">"logs"</span></li><li>               prefix<span class="sh_symbol">=</span><span class="sh_string">" a_access"</span> suffix<span class="sh_symbol">=</span><span class="sh_string">".txt"</span></li><li>               pattern<span class="sh_symbol">=</span><span class="sh_string">"%h %l %u %t &amp;quot;%r&amp;quot; %s %b"</span> <span class="sh_symbol">/&gt;</span></li><li><span class="sh_symbol">&lt;/</span>Host<span class="sh_symbol">&gt;</span></li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_symbol">&lt;</span>Host name<span class="sh_symbol">=</span><span class="sh_string">"www.b.com"</span> appBase<span class="sh_symbol">=</span><span class="sh_string">"b"</span> unpackWARS<span class="sh_symbol">=</span><span class="sh_string">"true"</span> autoDeploy<span class="sh_symbol">=</span><span class="sh_string">"true"</span><span class="sh_symbol">&gt;</span></li><li><span class="sh_symbol">&lt;</span>Context path<span class="sh_symbol">=</span><span class="sh_string">""</span> docBase<span class="sh_symbol">=</span><span class="sh_string">"base"</span> <span class="sh_symbol">/&gt;</span></li><li><span class="sh_symbol">&lt;</span>Valve className<span class="sh_symbol">=</span><span class="sh_string">"org.apache.catalina.valves.AccessLogValve"</span> directory<span class="sh_symbol">=</span><span class="sh_string">"logs"</span></li><li>               prefix<span class="sh_symbol">=</span><span class="sh_string">" b_access"</span> suffix<span class="sh_symbol">=</span><span class="sh_string">".txt"</span></li><li>               pattern<span class="sh_symbol">=</span><span class="sh_string">"%h %l %u %t &amp;quot;%r&amp;quot; %s %b"</span> <span class="sh_symbol">/&gt;</span></li><li><span class="sh_symbol">&lt;/</span>Host<span class="sh_symbol">&gt;</span></li><li><span class="sh_symbol">..</span> <span class="sh_symbol">..</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@web1 ~]# vim /usr/local/tomcat/conf/server.xml
.. ..
&lt;Host name="www.a.com" appBase="a" unpackWARS="true" autoDeploy="true"&gt;
&lt;Context path="/test" docBase="/var/www/html/" /&gt;
#从默认localhost虚拟主机中把Valve这段复制过来，适当修改下即可
&lt;Valve className="org.apache.catalina.valves.AccessLogValve" directory="logs"
               prefix=" a_access" suffix=".txt"
               pattern="%h %l %u %t &amp;quot;%r&amp;quot; %s %b" /&gt;
&lt;/Host&gt;

&lt;Host name="www.b.com" appBase="b" unpackWARS="true" autoDeploy="true"&gt;
&lt;Context path="" docBase="base" /&gt;
&lt;Valve className="org.apache.catalina.valves.AccessLogValve" directory="logs"
               prefix=" b_access" suffix=".txt"
               pattern="%h %l %u %t &amp;quot;%r&amp;quot; %s %b" /&gt;
&lt;/Host&gt;
.. ..
</pre></div></div>
      <p>2）重启Tomcat服务器</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># <span class="sh_regexp">/usr/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">tomcat</span><span class="sh_symbol">/</span><span class="sh_normal">bin</span><span class="sh_symbol">/</span>shutdown<span class="sh_symbol">.</span>sh</li><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># <span class="sh_regexp">/usr/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">tomcat</span><span class="sh_symbol">/</span><span class="sh_normal">bin</span><span class="sh_symbol">/</span>startup<span class="sh_symbol">.</span>sh</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@web1 ~]# /usr/local/tomcat/bin/shutdown.sh
[root@web1 ~]# /usr/local/tomcat/bin/startup.sh
</pre></div></div>
      <p>3）查看服务器日志文件</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># <span class="sh_normal">ls </span><span class="sh_symbol">/</span><span class="sh_normal">usr</span><span class="sh_symbol">/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">tomcat</span><span class="sh_symbol">/</span><span class="sh_normal">logs</span><span class="sh_symbol">/</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@web1 ~]# ls /usr/local/tomcat/logs/
</pre></div></div>
      <p class="number">步骤六：扩展实验(配置Tomcat集群)</p>
      <p>1) 在192.168.4.5主机上配置Nginx调度器（具体安装步骤参考前面的章节）</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@proxy <span class="sh_symbol">~]</span># <span class="sh_normal">vim  </span><span class="sh_symbol">/</span><span class="sh_normal">usr</span><span class="sh_symbol">/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">nginx</span><span class="sh_symbol">/</span><span class="sh_normal">conf</span><span class="sh_symbol">/</span>nginx<span class="sh_symbol">.</span>conf</li><li>http<span class="sh_cbracket">{</span></li><li>&nbsp;&nbsp;&nbsp;&nbsp;upstream toms <span class="sh_cbracket">{</span></li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server <span class="sh_number">192.168.2.100</span><span class="sh_symbol">:</span><span class="sh_number">8080</span><span class="sh_symbol">;</span></li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server <span class="sh_number">192.168.2.200</span><span class="sh_symbol">:</span><span class="sh_number">8080</span><span class="sh_symbol">;</span></li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_cbracket">}</span></li><li>&nbsp;&nbsp;&nbsp;&nbsp;server  <span class="sh_cbracket">{</span></li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;listen <span class="sh_number">80</span><span class="sh_symbol">;</span></li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server_name localhost<span class="sh_symbol">;</span></li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_normal">location </span><span class="sh_symbol">/</span> <span class="sh_cbracket">{</span></li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proxy_pass  http<span class="sh_symbol">:</span><span class="sh_comment">//toms;</span></li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_cbracket">}</span></li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_cbracket">}</span></li><li><span class="sh_cbracket">}</span>&nbsp;&nbsp;</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@proxy ~]# vim  /usr/local/nginx/conf/nginx.conf
http{
	upstream toms {
		server 192.168.2.100:8080;
		server 192.168.2.200:8080;
	}
	server  {
		listen 80;
		server_name localhost;
		location / {
			proxy_pass  http://toms;
		}
	}
}&nbsp;&nbsp;
</pre></div></div>
      <p>2) 在192.168.2.100和192.168.2.200主机上配置Tomcat调度器</p>
      <p>以下以Web1为例：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># yum <span class="sh_symbol">-</span>y install  java<span class="sh_number">-1.8.0</span><span class="sh_symbol">-</span>openjdk&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//安装JDK</span></li><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># yum <span class="sh_symbol">-</span>y install java<span class="sh_number">-1.8.0</span><span class="sh_symbol">-</span>openjdk<span class="sh_symbol">-</span>headless&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//安装JDK</span></li><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># tar <span class="sh_symbol">-</span>xzf  apache<span class="sh_symbol">-</span>tomcat<span class="sh_number">-8.0.30</span><span class="sh_symbol">.</span>tar<span class="sh_symbol">.</span>gz</li><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># mv apache<span class="sh_symbol">-</span>tomcat<span class="sh_number">-8.0.30</span><span class="sh_normal">  </span><span class="sh_symbol">/</span><span class="sh_normal">usr</span><span class="sh_symbol">/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span>tomcat</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@web1 ~]# yum -y install  java-1.8.0-openjdk				//安装JDK
[root@web1 ~]# yum -y install java-1.8.0-openjdk-headless		//安装JDK
[root@web1 ~]# tar -xzf  apache-tomcat-8.0.30.tar.gz
[root@web1 ~]# mv apache-tomcat-8.0.30  /usr/local/tomcat
</pre></div></div>
      <p>3）启动服务</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># <span class="sh_regexp">/usr/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">tomcat</span><span class="sh_symbol">/</span><span class="sh_normal">bin</span><span class="sh_symbol">/</span>startup<span class="sh_symbol">.</span>sh</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@web1 ~]# /usr/local/tomcat/bin/startup.sh
</pre></div></div>
      <p>4) 客户端验证</p>
      <p>为了防止有数据缓存，可以使用真实主机的google-chrome访问代理服务器，输入Ctrl+F5刷新页面。</p>
      <a name="case3">
      </a>
      <h2>3 案例3：使用Varnish加速Web</h2>
      <h3>3.1 问题</h3>
      <p>通过配置Varnish缓存服务器，实现如下目标：</p>
      <ul class="list">
        <li>使用Varnish加速后端Web服务
</li>
        <li>代理服务器可以将远程的Web服务器页面缓存在本地
</li>
        <li>远程Web服务器对客户端用户是透明的
</li>
        <li>利用缓存机制提高网站的响应速度
</li>
        <li>使用varnishadm命令管理缓存页面
</li>
        <li>使用varnishstat命令查看Varnish状态
</li>
      </ul>
      <h3>3.2 方案</h3>
      <p>通过源码编译安装Varnish缓存服务器</p>
      <ul class="list">
        <li>编译安装Varnish软件
</li>
      </ul>
      <p>修改配置文件，缓存代理源Web服务器，实现Web加速功能</p>
      <p>使用3台RHEL7虚拟机，其中一台作为Web服务器（192.168.2.100）、一台作为Varnish代理服务器（192.168.4.5,192.168.2.5)，另外一台作为测试用的Linux客户机（192.168.4.10），如图-2所示。</p>
      <div class="image">
        <img src="./CASE_files/image002.png">
        <p>图-2</p>
      </div>
      <p>对于Web服务器的部署，此实验中仅需要安装nginx或者httpd软件、启动服务，并生成测试首页文件即可，默认httpd网站根路径为/var/www/html，首页文档名称为index.html，默认nginx网站根路径为/usr/local/nginx/html，默认首页为index.html。下面的实验我们以httpd为例作为Web服务器。</p>
      <h3>3.3 步骤</h3>
      <p>实现此案例需要按照如下步骤进行。</p>
      <p class="number">步骤一：构建Web服务器</p>
      <p>1）使用yum安装web软件包</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># yum  <span class="sh_symbol">-</span>y  install  httpd</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@web1 ~]# yum  -y  install  httpd
</pre></div></div>
      <p>2）启用httpd服务（注意需要关闭nginx，否则端口冲突）</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># systemctl start httpd</li><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># setenforce <span class="sh_number">0</span></li><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># firewall<span class="sh_symbol">-</span>cmd <span class="sh_symbol">--</span>set<span class="sh_symbol">-</span><span class="sh_keyword">default</span><span class="sh_symbol">-</span>zone<span class="sh_symbol">=</span>trusted</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@web1 ~]# systemctl start httpd
[root@web1 ~]# setenforce 0
[root@web1 ~]# firewall-cmd --set-default-zone=trusted
</pre></div></div>
      <p>httpd服务默认通过TCP 80端口监听客户端请求：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># netstat  <span class="sh_symbol">-</span>anptu  <span class="sh_symbol">|</span>  grep httpd</li><li>tcp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_number">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_number">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_symbol">:::</span><span class="sh_number">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_symbol">:::*</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LISTEN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_number">2813</span><span class="sh_symbol">/</span>httpd</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@web1 ~]# netstat  -anptu  |  grep httpd
tcp		0		0		:::80		:::*		LISTEN		2813/httpd
</pre></div></div>
      <p>3）为Web访问建立测试文件</p>
      <p>在网站根目录/var/www/html下创建一个名为index.html的首页文件：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@web1 <span class="sh_symbol">~]</span># <span class="sh_normal">cat </span><span class="sh_symbol">/</span><span class="sh_keyword">var</span><span class="sh_regexp">/www/</span><span class="sh_normal">html</span><span class="sh_symbol">/</span>index<span class="sh_symbol">.</span>html </li><li><span class="sh_number">192.168.2.100</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@web1 ~]# cat /var/www/html/index.html 
192.168.2.100
</pre></div></div>
      <p>4）测试页面是否正常（代理服务器测试后台web）</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@proxy <span class="sh_symbol">~]</span># firefox http<span class="sh_symbol">:</span><span class="sh_comment">//192.168.2.100</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@proxy ~]# firefox http://192.168.2.100
</pre></div></div>
      <p class="number">步骤二：部署Varnish缓存服务器(192.168.4.5)</p>
      <p>1）编译安装软件(python-docutils默认光盘中没有，需要在lnmp_soft中找)</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@proxy <span class="sh_symbol">~]</span># yum <span class="sh_symbol">-</span>y install gcc readline<span class="sh_symbol">-</span>devel&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//安装软件依赖包</span></li><li><span class="sh_symbol">[</span>root@proxy <span class="sh_symbol">~]</span># yum <span class="sh_symbol">-</span>y install ncurses<span class="sh_symbol">-</span>devel &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//安装软件依赖包</span></li><li><span class="sh_symbol">[</span>root@proxy <span class="sh_symbol">~]</span># yum <span class="sh_symbol">-</span>y install pcre<span class="sh_symbol">-</span>devel&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//安装软件依赖包</span></li><li><span class="sh_symbol">[</span>root@proxy <span class="sh_symbol">~]</span># yum <span class="sh_symbol">-</span>y install <span class="sh_symbol">\</span></li><li>python<span class="sh_symbol">-</span>docutils<span class="sh_number">-0.11-0.2</span><span class="sh_symbol">.</span>20130715svn7687<span class="sh_symbol">.</span>el7<span class="sh_symbol">.</span>noarch<span class="sh_symbol">.</span>rpm &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//安装软件依赖包</span></li><li> <span class="sh_symbol">[</span>root@proxy <span class="sh_symbol">~]</span># useradd <span class="sh_symbol">-</span><span class="sh_normal">s </span><span class="sh_symbol">/</span><span class="sh_normal">sbin</span><span class="sh_symbol">/</span>nologin varnish&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//创建账户</span></li><li><span class="sh_symbol">[</span>root@proxy <span class="sh_symbol">~]</span># tar <span class="sh_symbol">-</span>xf varnish<span class="sh_number">-5.2.1</span><span class="sh_symbol">.</span>tar<span class="sh_symbol">.</span>gz</li><li><span class="sh_symbol">[</span>root@proxy <span class="sh_symbol">~]</span># cd varnish<span class="sh_number">-5.2.1</span></li><li><span class="sh_symbol">[</span>root@proxy varnish<span class="sh_number">-5.2.1</span><span class="sh_symbol">]</span># <span class="sh_symbol">./</span>configure</li><li><span class="sh_symbol">[</span>root@proxy varnish<span class="sh_number">-5.2.1</span><span class="sh_symbol">]</span># make <span class="sh_symbol">&amp;&amp;</span> make install</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@proxy ~]# yum -y install gcc readline-devel	//安装软件依赖包
[root@proxy ~]# yum -y install ncurses-devel 		//安装软件依赖包
[root@proxy ~]# yum -y install pcre-devel			//安装软件依赖包
[root@proxy ~]# yum -y install \
python-docutils-0.11-0.2.20130715svn7687.el7.noarch.rpm 		//安装软件依赖包
 [root@proxy ~]# useradd -s /sbin/nologin varnish				//创建账户
[root@proxy ~]# tar -xf varnish-5.2.1.tar.gz
[root@proxy ~]# cd varnish-5.2.1
[root@proxy varnish-5.2.1]# ./configure
[root@proxy varnish-5.2.1]# make &amp;&amp; make install
</pre></div></div>
      <p>2）复制启动脚本及配置文件</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@proxy varnish<span class="sh_number">-5.2.1</span><span class="sh_symbol">]</span># cp  <span class="sh_normal">etc</span><span class="sh_symbol">/</span>example<span class="sh_symbol">.</span><span class="sh_normal">vcl   </span><span class="sh_symbol">/</span><span class="sh_normal">usr</span><span class="sh_symbol">/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span><span class="sh_keyword">default</span><span class="sh_symbol">.</span>vcl</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@proxy varnish-5.2.1]# cp  etc/example.vcl   /usr/local/etc/default.vcl
</pre></div></div>
      <p>3）修改代理配置文件</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@proxy <span class="sh_symbol">~]</span># <span class="sh_normal">vim  </span><span class="sh_symbol">/</span><span class="sh_normal">usr</span><span class="sh_symbol">/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span><span class="sh_keyword">default</span><span class="sh_symbol">.</span>vcl</li><li>backend <span class="sh_keyword">default</span> <span class="sh_cbracket">{</span></li><li>     <span class="sh_symbol">.</span>host <span class="sh_symbol">=</span> <span class="sh_string">"192.168.2.100"</span><span class="sh_symbol">;</span></li><li>     <span class="sh_symbol">.</span>port <span class="sh_symbol">=</span> <span class="sh_string">"80"</span><span class="sh_symbol">;</span></li><li> <span class="sh_cbracket">}</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@proxy ~]# vim  /usr/local/etc/default.vcl
backend default {
     .host = "192.168.2.100";
     .port = "80";
 }
</pre></div></div>
      <p>4）启动服务</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li> <span class="sh_symbol">[</span>root@proxy <span class="sh_symbol">~]</span># varnishd  <span class="sh_symbol">-</span><span class="sh_normal">f </span><span class="sh_symbol">/</span><span class="sh_normal">usr</span><span class="sh_symbol">/</span><span class="sh_normal">local</span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span><span class="sh_keyword">default</span><span class="sh_symbol">.</span>vcl</li><li><span class="sh_comment">//varnishd命令的其他选项说明如下：</span></li><li><span class="sh_comment">//varnishd –s malloc,128M&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;定义varnish使用内存作为缓存，空间为128M</span></li><li><span class="sh_comment">//varnishd –s file,/var/lib/varnish_storage.bin,1G 定义varnish使用文件作为缓存</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;"> [root@proxy ~]# varnishd  -f /usr/local/etc/default.vcl
//varnishd命令的其他选项说明如下：
//varnishd –s malloc,128M		定义varnish使用内存作为缓存，空间为128M
//varnishd –s file,/var/lib/varnish_storage.bin,1G 定义varnish使用文件作为缓存
</pre></div></div>
      <p class="number">步骤三：客户端测试</p>
      <p>1）客户端开启浏览器访问</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@client <span class="sh_symbol">~]</span># curl http<span class="sh_symbol">:</span><span class="sh_comment">//192.168.4.5</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@client ~]# curl http://192.168.4.5
</pre></div></div>
      <p class="number">步骤四：其他操作</p>
      <p>1）查看varnish日志</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@proxy <span class="sh_symbol">~]</span># varnishlog&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//varnish日志</span></li><li><span class="sh_symbol">[</span>root@proxy <span class="sh_symbol">~]</span># varnishncsa&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//访问日志</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@proxy ~]# varnishlog						//varnish日志
[root@proxy ~]# varnishncsa					//访问日志
</pre></div></div>
      <p>2）更新缓存数据，在后台web服务器更新页面内容后，用户访问代理服务器看到的还是之前的数据，说明缓存中的数据过期了需要更新（默认也会自动更新，但非实时更新）。</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/OPERATION/DAY05/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@proxy <span class="sh_symbol">~]</span># varnishadm  </li><li>varnish<span class="sh_symbol">&gt;</span> ban req<span class="sh_symbol">.</span>url <span class="sh_symbol">~</span> <span class="sh_symbol">.*</span></li><li><span class="sh_comment">//清空缓存数据，支持正则表达式</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@proxy ~]# varnishadm  
varnish&gt; ban req.url ~ .*
//清空缓存数据，支持正则表达式
</pre></div></div>
    </div>
  
</body></html>