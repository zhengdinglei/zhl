
<!-- saved from url=(0083)http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>CASE</title>
    
    <script type="text/javascript" src="./CASE_files/jquery.min.js">
    </script>
    <script type="text/javascript" src="./CASE_files/jquery.snippet.js">
    </script>
    <script type="text/javascript" src="./CASE_files/main.js">
    </script>
    <link type="text/css" href="./CASE_files/index.css" rel="Stylesheet">
    <link type="text/css" href="./CASE_files/jquery.snippet.css" rel="Stylesheet">
  </head>
  <body>
    <div class="source_style_case">
      <a name="page_top_case" id="top_anchor">
      </a><a id="link_top" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#page_top_case">Top</a>
      <h1>NSD ARCHITECTURE DAY03</h1>
      <ol class="index">
        <li>
          <a href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#case1">案例1：ES集群安装</a>
        </li>
        <li>
          <a href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#case2">案例2：ES集群安装配置</a>
        </li>
        <li>
          <a href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#case3">案例3：练习curl命令</a>
        </li>
        <li>
          <a href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#case4">案例4：练习插件</a>
        </li>
        <li>
          <a href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#case5">案例5：插入，增加，删除查询数据</a>
        </li>
        <li>
          <a href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#case6">案例6：安装Kibana</a>
        </li>
      </ol>
      <a name="case1">
      </a>
      <h2>1 案例1：ES集群安装</h2>
      <h3>1.1 问题</h3>
      <p>本案例要求：</p>
      <ul class="list">
        <li>准备1台虚拟机
</li>
        <li>部署elasticsearch第一个节点
</li>
        <li>访问9200端口查看是否安装成功
</li>
      </ul>
      <h3>1.2 方案</h3>
      <p>1）ELK是日志分析平台，不是一款软件,而是一整套解决方案,是三个软件产品的首字母缩写，ELK分别代表：</p>
      <p>Elasticsearch:负责日志检索和储存</p>
      <p>Logstash:负责日志的收集和分析、处理</p>
      <p>Kibana:负责日志的可视化</p>
      <p>2) ELK组件在海量日志系统的运维中,可用于解决分布式日志数据集中式查询和管理系统监控等，故障排查，安全信息和事件管理，报表功能</p>
      <p>部署Elasticsearch分布式集群安装，Kibana作为可视化平台，实时总结流量和数据的图表，Logstash用来收集处理日志，如表-1所示：</p>
      <div class="table">
        <p>表-1</p>
        <img src="./CASE_files/table001.png">
      </div>
      <h3>1.3 步骤</h3>
      <p>实现此案例需要按照如下步骤进行。</p>
      <p class="number">步骤一：先准备一台虚拟机</p>
      <p>1）更改主机名，配置IP，搭建第三方yum源(之前已经搭建过几次,这里不再赘述)</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@se1 <span class="sh_symbol">~]</span># echo se1 <span class="sh_symbol">&gt;</span> <span class="sh_regexp">/etc/</span>hostname </li><li><span class="sh_symbol">[</span>root@se1 <span class="sh_symbol">~]</span># <span class="sh_normal">vim </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span><span class="sh_normal">sysconfig</span><span class="sh_symbol">/</span>network<span class="sh_symbol">-</span><span class="sh_normal">scripts</span><span class="sh_symbol">/</span>ifcfg<span class="sh_symbol">-</span>eth0 </li><li># Generated by dracut initrd</li><li>DEVICE<span class="sh_symbol">=</span><span class="sh_string">"eth0"</span></li><li>ONBOOT<span class="sh_symbol">=</span><span class="sh_string">"yes"</span></li><li>IPV6INIT<span class="sh_symbol">=</span><span class="sh_string">"no"</span></li><li>IPV4_FAILURE_FATAL<span class="sh_symbol">=</span><span class="sh_string">"no"</span></li><li>NM_CONTROLLED<span class="sh_symbol">=</span><span class="sh_string">"no"</span></li><li>TYPE<span class="sh_symbol">=</span><span class="sh_string">"Ethernet"</span></li><li>BOOTPROTO<span class="sh_symbol">=</span><span class="sh_string">"static"</span></li><li>IPADDR<span class="sh_symbol">=</span><span class="sh_number">192.168.1.61</span></li><li>PREFIX<span class="sh_symbol">=</span><span class="sh_number">24</span></li><li>GATEWAY<span class="sh_symbol">=</span><span class="sh_number">192.168.1.254</span></li><li><span class="sh_symbol">[</span>root@se1 <span class="sh_symbol">~]</span># <span class="sh_normal">vim </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span>yum<span class="sh_symbol">.</span>repos<span class="sh_symbol">.</span><span class="sh_normal">d</span><span class="sh_symbol">/</span>local<span class="sh_symbol">.</span>repo </li><li><span class="sh_symbol">[</span>local_repo<span class="sh_symbol">]</span></li><li>name<span class="sh_symbol">=</span>CentOS<span class="sh_symbol">-</span>$releasever <span class="sh_symbol">-</span> Base</li><li>baseurl<span class="sh_symbol">=</span><span class="sh_string">"ftp://192.168.1.254/system"</span></li><li>enabled<span class="sh_symbol">=</span><span class="sh_number">1</span></li><li>gpgcheck<span class="sh_symbol">=</span><span class="sh_number">1</span></li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_symbol">[</span>elk<span class="sh_symbol">]</span></li><li>name<span class="sh_symbol">=</span>elk</li><li>baseurl<span class="sh_symbol">=</span><span class="sh_string">"ftp://192.168.1.254/elk"</span></li><li>enabled<span class="sh_symbol">=</span><span class="sh_number">1</span></li><li>gpgcheck<span class="sh_symbol">=</span><span class="sh_number">0</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@se1 ~]# echo se1 &gt; /etc/hostname 
[root@se1 ~]# vim /etc/sysconfig/network-scripts/ifcfg-eth0 
# Generated by dracut initrd
DEVICE="eth0"
ONBOOT="yes"
IPV6INIT="no"
IPV4_FAILURE_FATAL="no"
NM_CONTROLLED="no"
TYPE="Ethernet"
BOOTPROTO="static"
IPADDR=192.168.1.61
PREFIX=24
GATEWAY=192.168.1.254
[root@se1 ~]# vim /etc/yum.repos.d/local.repo 
[local_repo]
name=CentOS-$releasever - Base
baseurl="ftp://192.168.1.254/system"
enabled=1
gpgcheck=1

[elk]
name=elk
baseurl="ftp://192.168.1.254/elk"
enabled=1
gpgcheck=0

</pre></div></div>
      <p>2）部署elasticsearch第一个节点</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@se1 <span class="sh_symbol">~]</span># <span class="sh_normal">vim </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span>hosts</li><li><span class="sh_number">192.168.1.61</span> se1</li><li><span class="sh_number">192.168.1.62</span> se2</li><li><span class="sh_number">192.168.1.63</span> se3</li><li><span class="sh_number">192.168.1.64</span> se4</li><li><span class="sh_number">192.168.1.65</span> se5</li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_symbol">[</span>root@se1 <span class="sh_symbol">~]</span># yum <span class="sh_symbol">-</span>y install java<span class="sh_number">-1.8.0</span><span class="sh_symbol">-</span>openjdk<span class="sh_symbol">.</span>x86_64</li><li><span class="sh_symbol">[</span>root@se1 <span class="sh_symbol">~]</span># java <span class="sh_symbol">-</span>version</li><li>openjdk version <span class="sh_string">"1.8.0_131"</span></li><li>OpenJDK Runtime <span class="sh_function">Environment</span> <span class="sh_symbol">(</span>build <span class="sh_number">1.8</span><span class="sh_symbol">.</span>0_131<span class="sh_symbol">-</span>b12<span class="sh_symbol">)</span></li><li>OpenJDK <span class="sh_number">64</span><span class="sh_symbol">-</span>Bit Server <span class="sh_function">VM</span> <span class="sh_symbol">(</span>build <span class="sh_number">25.131</span><span class="sh_symbol">-</span>b12<span class="sh_symbol">,</span> mixed mode<span class="sh_symbol">)</span></li><li><span class="sh_symbol">[</span>root@se1 <span class="sh_symbol">~]</span># sestatus &nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//查看selinux状态</span></li><li>SELinux status<span class="sh_symbol">:</span>                 disabled</li><li><span class="sh_symbol">[</span>root@se1 <span class="sh_symbol">~]</span># yum <span class="sh_symbol">-</span>y install elasticsearch</li><li><span class="sh_symbol">[</span>root@se1 <span class="sh_symbol">~]</span># <span class="sh_normal">vim </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span><span class="sh_normal">elasticsearch</span><span class="sh_symbol">/</span>elasticsearch<span class="sh_symbol">.</span>yml</li><li><span class="sh_number">17</span> cluster<span class="sh_symbol">.</span>name<span class="sh_symbol">:</span> myelk&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//配置集群名字</span></li><li><span class="sh_number">23</span> node<span class="sh_symbol">.</span>name<span class="sh_symbol">:</span> se1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//当前主机名称</span></li><li><span class="sh_number">54</span> network<span class="sh_symbol">.</span>host<span class="sh_symbol">:</span> <span class="sh_number">0.0.0.0</span>&nbsp;&nbsp;&nbsp;&nbsp; <span class="sh_comment">// 0.0.0.0（监听所有地址）</span></li><li><span class="sh_number">68</span> discovery<span class="sh_symbol">.</span>zen<span class="sh_symbol">.</span>ping<span class="sh_symbol">.</span>unicast<span class="sh_symbol">.</span>hosts<span class="sh_symbol">:</span> <span class="sh_symbol">[</span><span class="sh_string">"se1"</span><span class="sh_symbol">,</span> <span class="sh_string">"se2"</span><span class="sh_symbol">,</span><span class="sh_string">"se3"</span><span class="sh_symbol">]</span>  </li><li><span class="sh_comment">//声明集群里的主机成员有谁，不需要全部写进去</span></li><li><span class="sh_symbol">[</span>root@se1 <span class="sh_symbol">~]</span># systemctl restart elasticsearch</li><li><span class="sh_symbol">[</span>root@se1 <span class="sh_symbol">~]</span># systemctl enable elasticsearch</li><li><span class="sh_symbol">[</span>root@se1 <span class="sh_symbol">~]</span># ss <span class="sh_symbol">-</span>antup <span class="sh_symbol">|</span> grep <span class="sh_number">9200</span></li><li>tcp    LISTEN     <span class="sh_number">0</span>      <span class="sh_number">50</span>       <span class="sh_symbol">:::</span><span class="sh_number">9200</span>                 <span class="sh_symbol">:::*</span>                   users<span class="sh_symbol">:((</span><span class="sh_string">"java"</span><span class="sh_symbol">,</span>pid<span class="sh_symbol">=</span><span class="sh_number">23231</span><span class="sh_symbol">,</span>fd<span class="sh_symbol">=</span><span class="sh_number">110</span><span class="sh_symbol">))</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@se1 ~]# vim /etc/hosts
192.168.1.61 se1
192.168.1.62 se2
192.168.1.63 se3
192.168.1.64 se4
192.168.1.65 se5

[root@se1 ~]# yum -y install java-1.8.0-openjdk.x86_64
[root@se1 ~]# java -version
openjdk version "1.8.0_131"
OpenJDK Runtime Environment (build 1.8.0_131-b12)
OpenJDK 64-Bit Server VM (build 25.131-b12, mixed mode)
[root@se1 ~]# sestatus 	//查看selinux状态
SELinux status:                 disabled
[root@se1 ~]# yum -y install elasticsearch
[root@se1 ~]# vim /etc/elasticsearch/elasticsearch.yml
17 cluster.name: myelk		//配置集群名字
23 node.name: se1		//当前主机名称
54 network.host: 0.0.0.0	 // 0.0.0.0（监听所有地址）
68 discovery.zen.ping.unicast.hosts: ["se1", "se2","se3"]  
//声明集群里的主机成员有谁，不需要全部写进去
[root@se1 ~]# systemctl restart elasticsearch
[root@se1 ~]# systemctl enable elasticsearch
[root@se1 ~]# ss -antup | grep 9200
tcp    LISTEN     0      50       :::9200                 :::*                   users:(("java",pid=23231,fd=110))

</pre></div></div>
      <p>3）访问9200端口查看是否安装成功，如图-1所示：</p>
      <div class="image">
        <img src="./CASE_files/image001.png">
        <p>图-1</p>
      </div>
      <a name="case2">
      </a>
      <h2>2 案例2：ES集群安装配置</h2>
      <h3>2.1 问题</h3>
      <p>本案例要求：</p>
      <ul class="list">
        <li>一共安装5台虚拟机
</li>
        <li>在所有机器中部署ES
</li>
        <li>启动服务查看验证集群状态
</li>
      </ul>
      <h3>2.2 步骤</h3>
      <p>实现此案例需要按照如下步骤进行。</p>
      <p class="number">步骤一：安装elasticsearch和java-1.8.0-openjdk，同步配置文件</p>
      <p>备注：在步骤一已经安装了一台elasticsearch，这里只需再准备四台即可</p>
      <p>1）更改对应的主机名、 ip地址以及搭建yum源（以案例1为例子）</p>
      <p>2）安装elasticsearch四台主机同样操作（以se2为例子）</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@se2 <span class="sh_symbol">~]</span># yum <span class="sh_symbol">-</span>y install java<span class="sh_number">-1.8.0</span><span class="sh_symbol">-</span>openjdk<span class="sh_symbol">.</span>x86_64</li><li><span class="sh_symbol">[</span>root@se2 <span class="sh_symbol">~]</span># yum <span class="sh_symbol">-</span>y install elasticsearch</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@se2 ~]# yum -y install java-1.8.0-openjdk.x86_64
[root@se2 ~]# yum -y install elasticsearch

</pre></div></div>
      <p>3）同步配置/etc/hosts和/etc/elasticsearch/elasticsearch.yml, 修改node.name字段（以se2为例子）</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@se1 <span class="sh_symbol">~]</span># <span class="sh_keyword">for</span> i <span class="sh_keyword">in</span> <span class="sh_cbracket">{</span><span class="sh_number">62</span><span class="sh_symbol">..</span><span class="sh_number">65</span><span class="sh_cbracket">}</span> <span class="sh_symbol">;</span> <span class="sh_keyword">do</span> <span class="sh_normal">scp </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span>hosts <span class="sh_number">192.168.1</span><span class="sh_symbol">.</span>$i<span class="sh_symbol">:</span><span class="sh_regexp">/etc/</span>hosts<span class="sh_symbol">;</span> done</li><li><span class="sh_symbol">[</span>root@se1 <span class="sh_symbol">~]</span># <span class="sh_keyword">for</span> i <span class="sh_keyword">in</span> <span class="sh_cbracket">{</span><span class="sh_number">62</span><span class="sh_symbol">..</span><span class="sh_number">65</span><span class="sh_cbracket">}</span> <span class="sh_symbol">;</span> <span class="sh_keyword">do</span> scp  <span class="sh_symbol">\</span> </li><li><span class="sh_regexp">/etc/</span><span class="sh_normal">elasticsearch</span><span class="sh_symbol">/</span>elasticsearch<span class="sh_symbol">.</span>yml <span class="sh_symbol">\</span></li><li><span class="sh_number">192.168.1</span><span class="sh_symbol">.</span>$i<span class="sh_symbol">:</span><span class="sh_regexp">/etc/</span><span class="sh_normal">elasticsearch</span><span class="sh_symbol">/</span>elasticsearch<span class="sh_symbol">.</span>yml<span class="sh_symbol">;</span> done</li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_symbol">[</span>root@se2 <span class="sh_symbol">~]</span># <span class="sh_normal">vim </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span><span class="sh_normal">elasticsearch</span><span class="sh_symbol">/</span>elasticsearch<span class="sh_symbol">.</span>yml</li><li>node<span class="sh_symbol">.</span>name<span class="sh_symbol">:</span> se2    <span class="sh_comment">//另外三台修改为对应se3，se4，se5</span></li><li><span class="sh_symbol">[</span>root@se2 <span class="sh_symbol">~]</span># systemctl restart elasticsearch</li><li><span class="sh_symbol">[</span>root@se2 <span class="sh_symbol">~]</span># systemctl enable elasticsearch</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@se1 ~]# for i in {62..65} ; do scp /etc/hosts 192.168.1.$i:/etc/hosts; done
[root@se1 ~]# for i in {62..65} ; do scp  \ 
/etc/elasticsearch/elasticsearch.yml \
192.168.1.$i:/etc/elasticsearch/elasticsearch.yml; done

[root@se2 ~]# vim /etc/elasticsearch/elasticsearch.yml
node.name: se2    //另外三台修改为对应se3，se4，se5
[root@se2 ~]# systemctl restart elasticsearch
[root@se2 ~]# systemctl enable elasticsearch

</pre></div></div>
      <p>4）访问测试，如图-2所示：</p>
      <p>可以访问61-65的任意一台主机， 集群的节点都是5台，若先启动的是se4或se5，这两个会自动成为各自的集群，解决办法，先启动集群里的se1或se2或se3其中的一台，或者把se4和se5重启，se4和se5会自动加进去</p>
      <p>ES 集群验证：返回字段解析：</p>
      <p>”status”: ”green“ 集群状态：绿色为正常、黄色表示有问题但不是很严重、红色表示严重故障</p>
      <p>”number_of_nodes”： 5, 表示集群中节点的数量</p>
      <div class="image">
        <img src="./CASE_files/image002.png">
        <p>图-2</p>
      </div>
      <a name="case3">
      </a>
      <h2>3 案例3：练习curl命令</h2>
      <h3>3.1 问题</h3>
      <p>本案例要求：</p>
      <ul class="list">
        <li>练习使用curl命令
</li>
        <li>理解GET POST
</li>
        <li>使用curl命令访问ES集群
</li>
      </ul>
      <h3>3.2 步骤</h3>
      <p>实现此案例需要按照如下步骤进行。</p>
      <p class="number">步骤一：curl命令的使用</p>
      <p>http的请求方法：</p>
      <p>常用方法 GET，POST，HEAD</p>
      <p>其他方法 OPTIONS，PUT，DELETE，TRACE和CONNECT</p>
      <p>ES常用：</p>
      <p>PUT     --增</p>
      <p>DELETE  --删</p>
      <p>POST    --改</p>
      <p>GET     --查</p>
      <p>系统命令curl：</p>
      <p>是一个利用URL规则在命令行下工作的文件传输工具,可以说是一款很强大的http命令行工具。它支持多种请求模式,自定义请求头等强大功能,是一款综合工具</p>
      <p>curl 常用参数介绍：</p>
      <p>-A 修改请求 agent</p>
      <p>-X 设置请求方法</p>
      <p>-i 显示返回头信息</p>
      <p>1）索引的分片信息，如图-1所示：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># curl <span class="sh_symbol">-</span>X GET http<span class="sh_symbol">:</span><span class="sh_comment">//192.168.1.61:9200/_cat&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@room9pc01 ~]# curl -X GET http://192.168.1.61:9200/_cat		
</pre></div></div>
      <div class="image">
        <img src="./CASE_files/image003.png">
        <p>图-1</p>
      </div>
      <p>2）显示health的详细信息，如图-2所示：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span>#  curl <span class="sh_symbol">-</span>X GET http<span class="sh_symbol">:</span><span class="sh_comment">//192.168.1.62:9200/_cat/health?v   </span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@room9pc01 ~]#  curl -X GET http://192.168.1.62:9200/_cat/health?v   
</pre></div></div>
      <div class="image">
        <img src="./CASE_files/image004.png">
        <p>图-2</p>
      </div>
      <p>3）查看nodes的帮助，如图-3所示：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># curl <span class="sh_symbol">-</span>X GET http<span class="sh_symbol">:</span><span class="sh_comment">//192.168.1.61:9200/_cat/nodes?help   </span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@room9pc01 ~]# curl -X GET http://192.168.1.61:9200/_cat/nodes?help   

</pre></div></div>
      <div class="image">
        <img src="./CASE_files/image005.png">
        <p>图-3</p>
      </div>
      <a name="case4">
      </a>
      <h2>4 案例4：练习插件</h2>
      <h3>4.1 问题</h3>
      <p>本案例要求：</p>
      <ul class="list">
        <li>在其中一台机器上部署插件
</li>
        <li>使用bigdesk查看集群状态
</li>
        <li>使用head创建index
</li>
        <li>使用kopf查看数据
</li>
      </ul>
      <h3>4.2 步骤</h3>
      <p>实现此案例需要按照如下步骤进行。</p>
      <p class="number">步骤一：部署插件</p>
      <p>插件装在哪一台机器上，只能在哪台机器上使用（这里安装在se5机器上面）</p>
      <p>1）使用远程 uri 路径可以直接安装</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@se5 <span class="sh_symbol">~]</span># <span class="sh_normal">cd </span><span class="sh_symbol">/</span><span class="sh_normal">usr</span><span class="sh_symbol">/</span><span class="sh_normal">share</span><span class="sh_symbol">/</span><span class="sh_normal">elasticsearch</span><span class="sh_symbol">/</span>bin</li><li><span class="sh_symbol">[</span>root@se5 bin<span class="sh_symbol">]</span># <span class="sh_symbol">./</span>plugin  install  <span class="sh_symbol">\</span> </li><li>ftp<span class="sh_symbol">:</span><span class="sh_comment">//192.168.1.254/elk/elasticsearch-head-master.zip&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//安装head插件</span></li><li><span class="sh_symbol">[</span>root@se5 bin<span class="sh_symbol">]</span># <span class="sh_symbol">./</span>plugin  install  <span class="sh_symbol">\</span> </li><li>ftp<span class="sh_symbol">:</span><span class="sh_comment">//192.168.1.254/elk/elasticsearch-kopf-master.zip&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//安装kopf插件</span></li><li><span class="sh_symbol">[</span>root@se5 bin<span class="sh_symbol">]</span># <span class="sh_symbol">[</span>root@se5 bin<span class="sh_symbol">]</span># <span class="sh_symbol">./</span>plugin install  <span class="sh_symbol">\</span></li><li> ftp<span class="sh_symbol">:</span><span class="sh_comment">//192.168.1.254/elk/bigdesk-master.zip</span></li><li><span class="sh_comment">//安装bigdesk插件 &nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span class="sh_symbol">[</span>root@se5 bin<span class="sh_symbol">]</span># <span class="sh_symbol">.</span><span class="sh_regexp">/plugin  list&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/</span><span class="sh_symbol">/</span>查看安装的插件</li><li>Installed plugins <span class="sh_keyword">in</span> <span class="sh_regexp">/usr/</span><span class="sh_normal">share</span><span class="sh_symbol">/</span><span class="sh_normal">elasticsearch</span><span class="sh_symbol">/</span>plugins<span class="sh_symbol">:</span></li><li>    <span class="sh_symbol">-</span> head</li><li>    <span class="sh_symbol">-</span> kopf</li><li>    <span class="sh_symbol">-</span> bigdesk</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@se5 ~]# cd /usr/share/elasticsearch/bin
[root@se5 bin]# ./plugin  install  \ 
ftp://192.168.1.254/elk/elasticsearch-head-master.zip		//安装head插件
[root@se5 bin]# ./plugin  install  \ 
ftp://192.168.1.254/elk/elasticsearch-kopf-master.zip		//安装kopf插件
[root@se5 bin]# [root@se5 bin]# ./plugin install  \
 ftp://192.168.1.254/elk/bigdesk-master.zip
//安装bigdesk插件 	
[root@se5 bin]# ./plugin  list		//查看安装的插件
Installed plugins in /usr/share/elasticsearch/plugins:
    - head
    - kopf
    - bigdesk
</pre></div></div>
      <p>2）访问head插件，如图-4所示：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span>#  firefox http<span class="sh_symbol">:</span><span class="sh_comment">//192.168.1.65:9200/_plugin/head</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@room9pc01 ~]#  firefox http://192.168.1.65:9200/_plugin/head
</pre></div></div>
      <div class="image">
        <img src="./CASE_files/image006.png">
        <p>图-4</p>
      </div>
      <p>3）访问kopf插件，如图-5所示：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span>#  http<span class="sh_symbol">:</span><span class="sh_comment">//192.168.1.65:9200/_plugin/kopf</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@room9pc01 ~]#  http://192.168.1.65:9200/_plugin/kopf
</pre></div></div>
      <div class="image">
        <img src="./CASE_files/image007.png">
        <p>图-5</p>
      </div>
      <p>4）访问bigdesk插件，如图-6所示：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span>#  http<span class="sh_symbol">:</span><span class="sh_comment">//192.168.1.65:9200/_plugin/bigdesk</span></li><li><p></p></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@room9pc01 ~]#  http://192.168.1.65:9200/_plugin/bigdesk
<p></p></pre></div></div>
      <div class="image">
        <img src="./CASE_files/image008.png">
        <p>图-6</p>
      </div>
      <p class="number">步骤二：使用head创建index</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@se5 bin<span class="sh_symbol">]</span># curl <span class="sh_symbol">-</span>X PUT <span class="sh_string">"http://192.168.1.65:9200/index"</span> <span class="sh_symbol">-</span>d <span class="sh_string">'</span></li><li><span class="sh_string">&gt; {</span></li><li><span class="sh_string">&gt;     "settings":{</span></li><li><span class="sh_string">&gt;     "index":{</span></li><li><span class="sh_string">&gt;     "number_of_shards":5,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//分片数</span></li><li><span class="sh_string">&gt;     "number_of_replicas":1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//副本数</span></li><li><span class="sh_string">&gt;    }</span></li><li><span class="sh_string">&gt;   }</span></li><li><span class="sh_string">&gt; }'</span></li><li><span class="sh_cbracket">{</span><span class="sh_string">"acknowledged"</span><span class="sh_symbol">:</span><span class="sh_keyword">true</span><span class="sh_cbracket">}</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@se5 bin]# curl -X PUT "http://192.168.1.65:9200/index" -d '
&gt; {
&gt;     "settings":{
&gt;     "index":{
&gt;     "number_of_shards":5,		//分片数
&gt;     "number_of_replicas":1		//副本数
&gt;    }
&gt;   }
&gt; }'
{"acknowledged":true}
</pre></div></div>
      <p>步骤三：使用kopf查看数据，如图-7所示：</p>
      <div class="image">
        <img src="./CASE_files/image009.png">
        <p>图-7</p>
      </div>
      <a name="case5">
      </a>
      <h2>5 案例5：插入，增加，删除查询数据</h2>
      <h3>5.1 问题</h3>
      <p>本案例要求：</p>
      <ul class="list">
        <li>使用curl命令连接使用ES数据库
</li>
        <li>使用PUT方法增加数据
</li>
        <li>使用POST修改数据
</li>
        <li>使用GET查询数据
</li>
        <li>使用DELETE删除数据
</li>
      </ul>
      <h3>5.2 步骤</h3>
      <p>实现此案例需要按照如下步骤进行。</p>
      <p class="number">步骤一：增加数据</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@se5 <span class="sh_symbol">~]</span># locale</li><li><span class="sh_symbol">[</span>root@se5 <span class="sh_symbol">~]</span># LANG<span class="sh_symbol">=</span>en_US<span class="sh_symbol">.</span>UTF<span class="sh_number">-8</span>  <span class="sh_comment">//设置编码</span></li><li><span class="sh_symbol">[</span>root@se5 <span class="sh_symbol">~]</span># curl <span class="sh_symbol">-</span>X PUT <span class="sh_string">"http://192.168.1.65:9200/taindex/teacher/1"</span> <span class="sh_symbol">-</span>d <span class="sh_string">'{</span></li><li><span class="sh_string">"职业":"诗人",</span></li><li><span class="sh_string">"名字":"李白",</span></li><li><span class="sh_string">"称号":"诗仙",</span></li><li><span class="sh_string">"年代":"唐"</span></li><li><span class="sh_string">}'</span></li><li><span class="sh_cbracket">{</span><span class="sh_string">"_index"</span><span class="sh_symbol">:</span><span class="sh_string">"taindex"</span><span class="sh_symbol">,</span><span class="sh_string">"_type"</span><span class="sh_symbol">:</span><span class="sh_string">"teacher"</span><span class="sh_symbol">,</span><span class="sh_string">"_id"</span><span class="sh_symbol">:</span><span class="sh_string">"1"</span><span class="sh_symbol">,</span><span class="sh_string">"_version"</span><span class="sh_symbol">:</span><span class="sh_number">2</span><span class="sh_symbol">,</span><span class="sh_string">"_shards"</span><span class="sh_symbol">:</span><span class="sh_cbracket">{</span><span class="sh_string">"total"</span><span class="sh_symbol">:</span><span class="sh_number">2</span><span class="sh_symbol">,</span><span class="sh_string">"successful"</span><span class="sh_symbol">:</span><span class="sh_number">2</span><span class="sh_symbol">,</span><span class="sh_string">"failed"</span><span class="sh_symbol">:</span><span class="sh_number">0</span><span class="sh_cbracket">}</span><span class="sh_symbol">,</span><span class="sh_string">"created"</span><span class="sh_symbol">:</span><span class="sh_keyword">false</span><span class="sh_cbracket">}</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@se5 ~]# locale
[root@se5 ~]# LANG=en_US.UTF-8  //设置编码
[root@se5 ~]# curl -X PUT "http://192.168.1.65:9200/taindex/teacher/1" -d '{
"职业":"诗人",
"名字":"李白",
"称号":"诗仙",
"年代":"唐"
}'
{"_index":"taindex","_type":"teacher","_id":"1","_version":2,"_shards":{"total":2,"successful":2,"failed":0},"created":false}
</pre></div></div>
      <p class="number">步骤二：修改数据</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@se5 <span class="sh_symbol">~]</span># curl <span class="sh_symbol">-</span>X PUT <span class="sh_string">"http://192.168.1.65:9200/taindex/teacher/1"</span> <span class="sh_symbol">-</span>d <span class="sh_string">'{</span></li><li><span class="sh_string"> "doc":{</span></li><li><span class="sh_string"> "年代": "唐代"</span></li><li><span class="sh_string"> }</span></li><li><span class="sh_string"> }'</span></li><li><span class="sh_cbracket">{</span><span class="sh_string">"_index"</span><span class="sh_symbol">:</span><span class="sh_string">"taindex"</span><span class="sh_symbol">,</span><span class="sh_string">"_type"</span><span class="sh_symbol">:</span><span class="sh_string">"teacher"</span><span class="sh_symbol">,</span><span class="sh_string">"_id"</span><span class="sh_symbol">:</span><span class="sh_string">"1"</span><span class="sh_symbol">,</span><span class="sh_string">"_version"</span><span class="sh_symbol">:</span><span class="sh_number">3</span><span class="sh_symbol">,</span><span class="sh_string">"_shards"</span><span class="sh_symbol">:</span><span class="sh_cbracket">{</span><span class="sh_string">"total"</span><span class="sh_symbol">:</span><span class="sh_number">2</span><span class="sh_symbol">,</span><span class="sh_string">"successful"</span><span class="sh_symbol">:</span><span class="sh_number">2</span><span class="sh_symbol">,</span><span class="sh_string">"failed"</span><span class="sh_symbol">:</span><span class="sh_number">0</span><span class="sh_cbracket">}</span><span class="sh_symbol">,</span><span class="sh_string">"created"</span><span class="sh_symbol">:</span><span class="sh_keyword">false</span><span class="sh_cbracket">}</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@se5 ~]# curl -X PUT "http://192.168.1.65:9200/taindex/teacher/1" -d '{
 "doc":{
 "年代": "唐代"
 }
 }'
{"_index":"taindex","_type":"teacher","_id":"1","_version":3,"_shards":{"total":2,"successful":2,"failed":0},"created":false}
</pre></div></div>
      <p class="number">步骤三：查询数据</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@se5 <span class="sh_symbol">~]</span>#  curl <span class="sh_symbol">-</span>X GET <span class="sh_string">"http://192.168.1.65:9200/taindex/teacher/3?pretty"</span></li><li><span class="sh_cbracket">{</span></li><li>  <span class="sh_string">"_index"</span> <span class="sh_symbol">:</span> <span class="sh_string">"taindex"</span><span class="sh_symbol">,</span></li><li>  <span class="sh_string">"_type"</span> <span class="sh_symbol">:</span> <span class="sh_string">"teacher"</span><span class="sh_symbol">,</span></li><li>  <span class="sh_string">"_id"</span> <span class="sh_symbol">:</span> <span class="sh_string">"3"</span><span class="sh_symbol">,</span></li><li>  <span class="sh_string">"found"</span> <span class="sh_symbol">:</span> <span class="sh_keyword">false</span></li><li><span class="sh_cbracket">}</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@se5 ~]#  curl -X GET "http://192.168.1.65:9200/taindex/teacher/3?pretty"
{
  "_index" : "taindex",
  "_type" : "teacher",
  "_id" : "3",
  "found" : false
}
</pre></div></div>
      <p class="number">步骤四：删除数据</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@se5 <span class="sh_symbol">~]</span># curl <span class="sh_symbol">-</span>X DELETE <span class="sh_string">"http://192.168.1.65:9200/taindex/teacher/3?pretty"</span></li><li><span class="sh_cbracket">{</span></li><li>  <span class="sh_string">"found"</span> <span class="sh_symbol">:</span> <span class="sh_keyword">false</span><span class="sh_symbol">,</span></li><li>  <span class="sh_string">"_index"</span> <span class="sh_symbol">:</span> <span class="sh_string">"taindex"</span><span class="sh_symbol">,</span></li><li>  <span class="sh_string">"_type"</span> <span class="sh_symbol">:</span> <span class="sh_string">"teacher"</span><span class="sh_symbol">,</span></li><li>  <span class="sh_string">"_id"</span> <span class="sh_symbol">:</span> <span class="sh_string">"3"</span><span class="sh_symbol">,</span></li><li>  <span class="sh_string">"_version"</span> <span class="sh_symbol">:</span> <span class="sh_number">1</span><span class="sh_symbol">,</span></li><li>  <span class="sh_string">"_shards"</span> <span class="sh_symbol">:</span> <span class="sh_cbracket">{</span></li><li>    <span class="sh_string">"total"</span> <span class="sh_symbol">:</span> <span class="sh_number">2</span><span class="sh_symbol">,</span></li><li>    <span class="sh_string">"successful"</span> <span class="sh_symbol">:</span> <span class="sh_number">2</span><span class="sh_symbol">,</span></li><li>    <span class="sh_string">"failed"</span> <span class="sh_symbol">:</span> <span class="sh_number">0</span></li><li>  <span class="sh_cbracket">}</span></li><li><span class="sh_cbracket">}</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@se5 ~]# curl -X DELETE "http://192.168.1.65:9200/taindex/teacher/3?pretty"
{
  "found" : false,
  "_index" : "taindex",
  "_type" : "teacher",
  "_id" : "3",
  "_version" : 1,
  "_shards" : {
    "total" : 2,
    "successful" : 2,
    "failed" : 0
  }
}
</pre></div></div>
      <p class="number">步骤五：删除索引</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@se5 bin<span class="sh_symbol">]</span># curl <span class="sh_symbol">-</span>X DELETE http<span class="sh_symbol">:</span><span class="sh_comment">//192.168.1.65:9200/taindex/   </span></li><li><span class="sh_comment">//删除索引</span></li><li><span class="sh_cbracket">{</span><span class="sh_string">"acknowledged"</span><span class="sh_symbol">:</span><span class="sh_keyword">true</span><span class="sh_cbracket">}</span></li><li><span class="sh_symbol">[</span>root@se5 bin<span class="sh_symbol">]</span># curl <span class="sh_symbol">-</span>X DELETE http<span class="sh_symbol">:</span><span class="sh_comment">//192.168.1.65:9200/*&nbsp;&nbsp;&nbsp;&nbsp;  //删除所有索引</span></li><li><span class="sh_cbracket">{</span><span class="sh_string">"acknowledged"</span><span class="sh_symbol">:</span><span class="sh_keyword">true</span><span class="sh_cbracket">}</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@se5 bin]# curl -X DELETE http://192.168.1.65:9200/taindex/   
//删除索引
{"acknowledged":true}
[root@se5 bin]# curl -X DELETE http://192.168.1.65:9200/*	  //删除所有索引
{"acknowledged":true}
</pre></div></div>
      <a name="case6">
      </a>
      <h2>6 案例6：安装Kibana</h2>
      <h3>6.1 问题</h3>
      <p>本案例要求：</p>
      <ul class="list">
        <li>安装Kibana
</li>
        <li>配置启动服务查看5601端口是否正常
</li>
        <li>通过web页面访问Kibana
</li>
      </ul>
      <h3>6.2 步骤</h3>
      <p>实现此案例需要按照如下步骤进行</p>
      <p class="number">步骤一：安装kibana</p>
      <p>1）在另一台主机，配置ip为192.168.1.66，配置yum源，更改主机名</p>
      <p>2）安装kibana</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@kibana <span class="sh_symbol">~]</span># yum <span class="sh_symbol">-</span>y install kibana</li><li><span class="sh_symbol">[</span>root@kibana <span class="sh_symbol">~]</span># rpm <span class="sh_symbol">-</span>qc kibana</li><li><span class="sh_regexp">/opt/</span><span class="sh_normal">kibana</span><span class="sh_symbol">/</span><span class="sh_normal">config</span><span class="sh_symbol">/</span>kibana<span class="sh_symbol">.</span>yml</li><li><span class="sh_symbol">[</span>root@kibana <span class="sh_symbol">~]</span># <span class="sh_normal">vim </span><span class="sh_symbol">/</span><span class="sh_normal">opt</span><span class="sh_symbol">/</span><span class="sh_normal">kibana</span><span class="sh_symbol">/</span><span class="sh_normal">config</span><span class="sh_symbol">/</span>kibana<span class="sh_symbol">.</span>yml</li><li>  <span class="sh_number">2</span> server<span class="sh_symbol">.</span>port<span class="sh_symbol">:</span> <span class="sh_number">5601</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li><span class="sh_comment">//若把端口改为80，可以成功启动kibana，但ss时没有端口，没有监听80端口，服务里面写死了，不能用80端口，只能是5601这个端口</span></li><li>  <span class="sh_number">5</span> server<span class="sh_symbol">.</span>host<span class="sh_symbol">:</span> <span class="sh_string">"0.0.0.0"</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//服务器监听地址</span></li><li><span class="sh_number">15</span> elasticsearch<span class="sh_symbol">.</span>url<span class="sh_symbol">:</span> http<span class="sh_symbol">:</span><span class="sh_comment">//192.168.1.61:9200&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span class="sh_comment">//声明地址，从哪里查，集群里面随便选一个</span></li><li><span class="sh_number">23</span> kibana<span class="sh_symbol">.</span>index<span class="sh_symbol">:</span> <span class="sh_string">".kibana"</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//kibana自己创建的索引</span></li><li><span class="sh_number">26</span> kibana<span class="sh_symbol">.</span>defaultAppId<span class="sh_symbol">:</span> <span class="sh_string">"discover"</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//打开kibana页面时，默认打开的页面discover</span></li><li><span class="sh_number">53</span> elasticsearch<span class="sh_symbol">.</span>pingTimeout<span class="sh_symbol">:</span> <span class="sh_number">1500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//ping检测超时时间</span></li><li><span class="sh_number">57</span> elasticsearch<span class="sh_symbol">.</span>requestTimeout<span class="sh_symbol">:</span> <span class="sh_number">30000</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//请求超时</span></li><li><span class="sh_number">64</span> elasticsearch<span class="sh_symbol">.</span>startupTimeout<span class="sh_symbol">:</span> <span class="sh_number">5000</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//启动超时</span></li><li><span class="sh_symbol">[</span>root@kibana <span class="sh_symbol">~]</span># systemctl restart kibana</li><li><span class="sh_symbol">[</span>root@kibana <span class="sh_symbol">~]</span># systemctl enable  kibana</li><li>Created symlink <span class="sh_normal">from </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span><span class="sh_normal">systemd</span><span class="sh_symbol">/</span><span class="sh_normal">system</span><span class="sh_symbol">/</span>multi<span class="sh_symbol">-</span>user<span class="sh_symbol">.</span>target<span class="sh_symbol">.</span><span class="sh_normal">wants</span><span class="sh_symbol">/</span>kibana<span class="sh_symbol">.</span>service <span class="sh_normal">to </span><span class="sh_symbol">/</span><span class="sh_normal">usr</span><span class="sh_symbol">/</span><span class="sh_normal">lib</span><span class="sh_symbol">/</span><span class="sh_normal">systemd</span><span class="sh_symbol">/</span><span class="sh_normal">system</span><span class="sh_symbol">/</span>kibana<span class="sh_symbol">.</span>service<span class="sh_symbol">.</span></li><li><span class="sh_symbol">[</span>root@kibana <span class="sh_symbol">~]</span># ss <span class="sh_symbol">-</span>antup <span class="sh_symbol">|</span> grep <span class="sh_number">5601</span>  <span class="sh_comment">//查看监听端口</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@kibana ~]# yum -y install kibana
[root@kibana ~]# rpm -qc kibana
/opt/kibana/config/kibana.yml
[root@kibana ~]# vim /opt/kibana/config/kibana.yml
  2 server.port: 5601		
//若把端口改为80，可以成功启动kibana，但ss时没有端口，没有监听80端口，服务里面写死了，不能用80端口，只能是5601这个端口
  5 server.host: "0.0.0.0"		//服务器监听地址
15 elasticsearch.url: http://192.168.1.61:9200	
//声明地址，从哪里查，集群里面随便选一个
23 kibana.index: ".kibana"	//kibana自己创建的索引
26 kibana.defaultAppId: "discover"	//打开kibana页面时，默认打开的页面discover
53 elasticsearch.pingTimeout: 1500	//ping检测超时时间
57 elasticsearch.requestTimeout: 30000	//请求超时
64 elasticsearch.startupTimeout: 5000	//启动超时
[root@kibana ~]# systemctl restart kibana
[root@kibana ~]# systemctl enable  kibana
Created symlink from /etc/systemd/system/multi-user.target.wants/kibana.service to /usr/lib/systemd/system/kibana.service.
[root@kibana ~]# ss -antup | grep 5601  //查看监听端口
</pre></div></div>
      <p>3）浏览器访问kibana，如图-8所示：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@kibana <span class="sh_symbol">~]</span># firefox <span class="sh_number">192.168.1.66</span><span class="sh_symbol">:</span><span class="sh_number">5601</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@kibana ~]# firefox 192.168.1.66:5601
</pre></div></div>
      <div class="image">
        <img src="./CASE_files/image010.png">
        <p>图-8</p>
      </div>
      <p>4）点击Status，查看是否安装成功，全部是绿色的对钩,说明安装成功，如图-9所示：</p>
      <div class="image">
        <img src="./CASE_files/image011.png">
      </div>
      <div class="image">
        <img src="./CASE_files/image012.png">
        <p>图-9</p>
      </div>
      <p>5）用head插件访问会有.kibana的索引信息，如图-10所示：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/ARCHITECTURE/DAY03/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@se5 <span class="sh_symbol">~]</span># firefox http<span class="sh_symbol">:</span><span class="sh_comment">//192.168.1.65:9200/_plugin/head/</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@se5 ~]# firefox http://192.168.1.65:9200/_plugin/head/
</pre></div></div>
      <div class="image">
        <img src="./CASE_files/image013.png">
        <p>图-10</p>
      </div>
    </div>
  
</body></html>