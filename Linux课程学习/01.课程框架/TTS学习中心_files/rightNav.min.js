$(function(){
var allEle = $(':header[class*="headline"]');
var headLen = allEle.length;
var ddArr = [];
allEle.each(function(c) {
	var g, b, d, a = "",
		h, e;
	b = $(this).find(".headline-content").text();
	if ($(this).hasClass("headline-1")) {
		e = g = $(this).find(".anchor-1").eq(0).attr("name");
		h = "sideCatalog-item1"
	} else {
		e = $(this).find(".anchor-2").eq(0).attr("name");
		g = e.replace("-", ".");
		h = "sideCatalog-item2"
	}
	d = "sideToolbar-item-0-" + e;
	if (c == 0) {
		a = "highlight"
	}
	var f = '<dd id="' + d + '" class="' + h + " " + a + '">' + '<span class="sideCatalog-index1">' + g + "</span>" + '<a class="nslog:1026" onclick="return false;" title="part' + e + '" href="#' + e + '">' + b + "</a>" + '<span class="sideCatalog-dot"></span>' + "</dd>";
	ddArr.push(f)
});
$("#sideCatalog-catalog dl").html(ddArr.join(""));
var slideTop = $(window).height() - $(".slide").height();
//$(".slide").css("top", slideTop);
var slideInnerHeight = $("#sideCatalog-catalog dl").height();
var slideOutHeight = $("#sideCatalog-catalog").height();
var enableTop = slideInnerHeight - slideOutHeight;
var step = 50;
$("#sideCatalog-down").bind("click", function() {
	if ($(this).hasClass("sideCatalog-down-enable")) {
		if ((enableTop - Math.abs(parseInt($("#sideCatalog-catalog dl").css("top")))) > step) {
			$("#sideCatalog-catalog dl").stop().animate({
				"top": "-=" + step
			}, "fast");
			$("#sideCatalog-up").removeClass("sideCatalog-up-disable").addClass("sideCatalog-up-enable")
		} else {
			$("#sideCatalog-catalog dl").stop().animate({
				"top": -enableTop
			}, "fast");
			$(this).removeClass("sideCatalog-down-enable").addClass("sideCatalog-down-disable")
		}
	} else {
		return false
	}
});
$("#sideCatalog-up").bind("click", function() {
	if ($(this).hasClass("sideCatalog-up-enable")) {
		if (Math.abs(parseInt($("#sideCatalog-catalog dl").css("top"))) > step) {
			$("#sideCatalog-catalog dl").stop().animate({
				"top": "+=" + step
			}, "fast");
			$("#sideCatalog-down").removeClass("sideCatalog-down-disable").addClass("sideCatalog-down-enable")
		} else {
			$("#sideCatalog-catalog dl").stop().animate({
				"top": "0"
			}, "fast");
			$(this).removeClass("sideCatalog-up-enable").addClass("sideCatalog-up-disable")
		}
	} else {
		return false
	}
});
$("#sideCatalog-catalog dl").delegate("dd", "click", function() {
	var a = $("#sideCatalog-catalog dl dd").index($(this));
	scrollSlide($(this), a);
	var c = $(this).find("a").stop().attr("href").lastIndexOf("#");
	var b = $(this).find("a").stop().attr("href").substring(c + 1);
	var d = $('a[name="' + b + '"]').offset().top;
	$("body,html").animate({
		scrollTop: d
	}, "fast")
});
$(window).scroll(function() {
 var left_content_top=$(".container.wipper-960-190").offset().top+40,
     left_content_width=$(".col-960.md2017110202lty").width()+25;
    if($(document).scrollTop()>left_content_top&&$(window).width()>1200){
        $('.col-190.md2017111501lty').css({"top":"10px","position":"fixed","left":($(window).width()-1200)/2+left_content_width+"px"});
    }else if($(document).scrollTop()>left_content_top&&$(window).width()<1200){
        $('.col-190.md2017111501lty').css({"top":"10px","position":"fixed","left":left_content_width+"px"});
        if($(document).scrollLeft()>0){
            $('.col-190.md2017111501lty').css({"top":"10px","position":"fixed","left":(left_content_width-$(document).scrollLeft())+"px"});
        }
    }else{
        $('.col-190.md2017111501lty').css({"position":"static","top":"auto","left":"auto"});
    }
    
	for (var b = headLen - 1; b >= 0; b--) {
	    if((b==headLen-1)&&$(document).scrollTop()>=($(document).height()-$(window).height())){
            $("#sideCatalog-catalog dl dd").eq(headLen-1).addClass("highlight").siblings("dd").removeClass("highlight");
            scrollSlide($("#sideCatalog-catalog dl dd").eq(headLen-1), headLen-1);
            return false;
	    }
	    if($(this).scrollTop() >= (allEle.eq(b).offset().top-79)){
	        var a = b;
            $("#sideCatalog-catalog dl dd").eq(a).addClass("highlight").siblings("dd").removeClass("highlight");
            scrollSlide($("#sideCatalog-catalog dl dd").eq(a), a);
            return false;
		} else {
			$("#sideCatalog-catalog dl dd").eq(0).addClass("highlight").siblings("dd").removeClass("highlight")
		}
	}
});
$(window).resize(function(){
   var left_content_top=$(".container.wipper-960-190").offset().top+40,
        left_content_width=$(".col-960.md2017110202lty").width()+25;
    if($(document).scrollTop()>left_content_top&&$(window).width()>1200){
        $('.col-190.md2017111501lty').css({"top":"10px","position":"fixed","left":($(window).width()-1200)/2+left_content_width+"px"});
    }else if($(document).scrollTop()>left_content_top&&$(window).width()<1200){
        $('.col-190.md2017111501lty').css({"top":"10px","position":"fixed","left":left_content_width+"px"});
        if($(document).scrollLeft()>0){
            $('.col-190.md2017111501lty').css({"top":"10px","position":"fixed","left":(left_content_width-$(document).scrollLeft())+"px"});
        }
    }else{
        $('.col-190.md2017111501lty').css({"position":"static","top":"auto","left":"auto"});
    }
})

function scrollSlide(c, a) {
	if (a < 5) {
		$("#sideCatalog-catalog dl").stop().animate({
			"top": "0"
		}, "fast");
		$("#sideCatalog-down").removeClass("sideCatalog-down-disable").addClass("sideCatalog-down-enable");
		$("#sideCatalog-up").removeClass("sideCatalog-up-enable").addClass("sideCatalog-up-disable")
	} else {
		if (a >= headLen) {
			$("#sideCatalog-catalog dl").stop().animate({
				"top": -enableTop
			}, "fast");
			$("#sideCatalog-down").removeClass("sideCatalog-down-enable").addClass("sideCatalog-down-disable");
			$("#sideCatalog-up").removeClass("sideCatalog-up-disable").addClass("sideCatalog-up-enable")
		} else {
			var b = parseInt($("#sideCatalog-catalog dl").css("top")) + slideOutHeight / 2 - (c.offset().top - $("#sideCatalog-catalog").offset().top);
			$("#sideCatalog-catalog dl").stop().animate({
				"top": b
			}, "fast");
			$("#sideCatalog-down").removeClass("sideCatalog-down-disable").addClass("sideCatalog-down-enable");
			$("#sideCatalog-up").removeClass("sideCatalog-up-disable").addClass("sideCatalog-up-enable")
		}
	}
}
$("#sideToolbar-up").bind("click", function() {
	$("body,html").animate({
		scrollTop: 0
	}, "fast")
});
$("#sideCatalogBtn").bind("click", function() {
	if ($(this).hasClass("sideCatalogBtnDisable")) {
		$(this).removeClass("sideCatalogBtnDisable");
		$("#sideCatalog").css("visibility", "visible")
	} else {
		$(this).addClass("sideCatalogBtnDisable");
		$("#sideCatalog").css("visibility", "hidden")
	}
});
})