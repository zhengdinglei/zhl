
<!-- saved from url=(0079)http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>CASE</title>
    
    <script type="text/javascript" src="./CASE_files/jquery.min.js">
    </script>
    <script type="text/javascript" src="./CASE_files/jquery.snippet.js">
    </script>
    <script type="text/javascript" src="./CASE_files/main.js">
    </script>
    <link type="text/css" href="./CASE_files/index.css" rel="Stylesheet">
    <link type="text/css" href="./CASE_files/jquery.snippet.css" rel="Stylesheet">
  </head>
  <body>
    <div class="source_style_case">
      <a name="page_top_case" id="top_anchor">
      </a><a id="link_top" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#page_top_case">Top</a>
      <h1>NSD PROJECT1 DAY06</h1>
      <ol class="index">
        <li>
          <a href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#case1">案例1：配置目前网络环境</a>
        </li>
        <li>
          <a href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#case2">案例2：网络升级</a>
        </li>
        <li>
          <a href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#case3">实现此案例需要按照如下步骤进行</a>
        </li>
        <li>
          <a href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#case4">
          </a>
        </li>
      </ol>
      <a name="case1">
      </a>
      <h2>1 案例1：配置目前网络环境</h2>
      <h3>1.1 问题</h3>
      <p>一家新创建的IT公司，公司位于北京有80多台服务器</p>
      <p>目前网络环境使用技术，通过端口映射技术将web服务器发布给Internet：</p>
      <p>三层交换：汇聚接入层交换机</p>
      <p>默认路由：实现到互联网数以万计网络访问的简化配置</p>
      <p>静态路由：实现公司内部网络互通</p>
      <p>NAT端口映射：实现企业内部Web服务器的发布</p>
      <h3>1.2 方案</h3>
      <p>通过端口映射技术将web服务器发布给Internet，公司现有网络环境拓扑如图-1所</p>
      <div class="image">
        <img src="./CASE_files/image001.png">
        <p>图-1</p>
      </div>
      <a name="case2">
      </a>
      <h2>2 案例2：网络升级</h2>
      <h3>2.1 问题</h3>
      <p>现有网络问题分析：</p>
      <p>接入层交换机只与同一个三层交换机相连，存在单点故障而影响网络通信。</p>
      <p>互联网连接单一服务商</p>
      <p>现有网络需求：</p>
      <p>随着企业发展，为了保证网络的高可用性，需要使用很多的冗余技术。</p>
      <p>保证局域网络不会因为线路故障而导致的网络故障。</p>
      <p>保证客户端机器不会因为使用单一网关而出现的单点失败。</p>
      <p>保证到互联网的高可用接入使用冗余互联网连接。</p>
      <p>提高网络链路带宽。</p>
      <h3>2.2 方案</h3>
      <p>基于项目的需求，需要用到如下技术：</p>
      <p>STP：解决二层环路带来的广播风暴并链路冗余问题</p>
      <p>以太网通道：提高网络链路带宽</p>
      <p>OSPF路由协议：实现网络路径的自动学习</p>
      <p>HSRP：实现网关冗余</p>
      <p>重新规划后的网络拓扑如图-2：</p>
      <div class="image">
        <img src="./CASE_files/image002.png">
        <p>图-2</p>
      </div>
      <h3>2.3 步骤</h3>
      <a name="case3">
      </a>
      <h2>3 实现此案例需要按照如下步骤进行</h2>
      <p class="number">步骤一：二层交换机配置</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>分别创建VLAN10、<span class="sh_number">20</span>、<span class="sh_number">30</span>、<span class="sh_number">40</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">分别创建VLAN10、20、30、40
</pre></div></div>
      <p>sw1将f0/5接口加入vlan10</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#<span class="sh_keyword">interface</span> fastEthernet <span class="sh_number">0</span><span class="sh_symbol">/</span><span class="sh_number">5</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#switchport access vlan <span class="sh_number">10</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">Switch(config)#interface fastEthernet 0/5
Switch(config-if)#switchport access vlan 10
</pre></div></div>
      <p>sw2将f0/5接口加入vlan20</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#<span class="sh_keyword">interface</span> fastEthernet <span class="sh_number">0</span><span class="sh_symbol">/</span><span class="sh_number">5</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#switchport access vlan <span class="sh_number">20</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">Switch(config)#interface fastEthernet 0/5
Switch(config-if)#switchport access vlan 20
</pre></div></div>
      <p>sw3将f0/5接口加入vlan30</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#<span class="sh_keyword">interface</span> fastEthernet <span class="sh_number">0</span><span class="sh_symbol">/</span><span class="sh_number">5</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#switchport access vlan <span class="sh_number">30</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">Switch(config)#interface fastEthernet 0/5
Switch(config-if)#switchport access vlan 30
</pre></div></div>
      <p>sw4将f0/5接口加入vlan40</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#<span class="sh_keyword">interface</span> fastEthernet <span class="sh_number">0</span><span class="sh_symbol">/</span><span class="sh_number">5</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#switchport access vlan <span class="sh_number">40</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">Switch(config)#interface fastEthernet 0/5
Switch(config-if)#switchport access vlan 40
</pre></div></div>
      <p>每台设备捆绑以太通道，将f0/1与f0/2捆绑为通道1，f0/3与f0/4捆绑为通道2</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#<span class="sh_keyword">interface</span> range <span class="sh_normal">f0</span><span class="sh_symbol">/</span><span class="sh_number">1-2</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">-</span>range<span class="sh_symbol">)</span>#channel<span class="sh_symbol">-</span>group <span class="sh_number">1</span> mode on </li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#<span class="sh_keyword">interface</span> range <span class="sh_normal">f0</span><span class="sh_symbol">/</span><span class="sh_number">3-4</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">-</span>range<span class="sh_symbol">)</span>#channel<span class="sh_symbol">-</span>group <span class="sh_number">2</span> mode on </li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">Switch(config)#interface range f0/1-2
Switch(config-if-range)#channel-group 1 mode on 

Switch(config)#interface range f0/3-4
Switch(config-if-range)#channel-group 2 mode on 
</pre></div></div>
      <p>查看以太通道汇总信息</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>Switch#show etherchannel summary</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">Switch#show etherchannel summary
</pre></div></div>
      <p>依次进入所有二层交换机的以太通道接口，配置中继链路</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#<span class="sh_keyword">interface</span> port<span class="sh_symbol">-</span>channel <span class="sh_number">1</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#switchport mode trunk</li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#<span class="sh_keyword">interface</span> port<span class="sh_symbol">-</span>channel <span class="sh_number">2</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#switchport mode trunk</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">Switch(config)#interface port-channel 1
Switch(config-if)#switchport mode trunk

Switch(config)#interface port-channel 2
Switch(config-if)#switchport mode trunk
</pre></div></div>
      <p>==========================================================</p>
      <p class="number">步骤二：三层交换机基本配置</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>每台设备分别创建VLAN10、<span class="sh_number">20</span>、<span class="sh_number">30</span>、<span class="sh_number">40</span></li><li><span class="sh_number">1-2</span>口捆绑为通道<span class="sh_number">1</span></li><li><span class="sh_number">3-4</span>口捆绑为通道<span class="sh_number">2</span></li><li><span class="sh_number">5-6</span>口捆绑为通道<span class="sh_number">3</span></li><li><span class="sh_number">7-8</span>口捆绑为通道<span class="sh_number">4</span></li><li><span class="sh_number">9-10</span>口捆绑为通道<span class="sh_number">5</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">每台设备分别创建VLAN10、20、30、40
1-2口捆绑为通道1
3-4口捆绑为通道2
5-6口捆绑为通道3
7-8口捆绑为通道4
9-10口捆绑为通道5
</pre></div></div>
      <p>依次进入三层交换机的4个通道接口，配置中继链路（两台三层交换机配置相同）</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#<span class="sh_keyword">interface</span> port<span class="sh_symbol">-</span>channel <span class="sh_number">1</span> </li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span># switchport trunk encapsulation dot1q</li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#switchport mode trunk</li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#<span class="sh_keyword">interface</span> port<span class="sh_symbol">-</span>channel <span class="sh_number">2</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span># switchport trunk encapsulation dot1q</li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#switchport mode trunk</li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#<span class="sh_keyword">interface</span> port<span class="sh_symbol">-</span>channel <span class="sh_number">3</span> </li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span># switchport trunk encapsulation dot1q</li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#switchport mode trunk</li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#<span class="sh_keyword">interface</span> port<span class="sh_symbol">-</span>channel <span class="sh_number">4</span> </li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span># switchport trunk encapsulation dot1q</li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#switchport mode trunk</li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#<span class="sh_keyword">interface</span> port<span class="sh_symbol">-</span>channel <span class="sh_number">5</span> </li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span># switchport trunk encapsulation dot1q</li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#switchport mode trunk</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">Switch(config)#interface port-channel 1 
Switch(config-if)# switchport trunk encapsulation dot1q
Switch(config-if)#switchport mode trunk

Switch(config)#interface port-channel 2
Switch(config-if)# switchport trunk encapsulation dot1q
Switch(config-if)#switchport mode trunk

Switch(config)#interface port-channel 3 
Switch(config-if)# switchport trunk encapsulation dot1q
Switch(config-if)#switchport mode trunk

Switch(config)#interface port-channel 4 
Switch(config-if)# switchport trunk encapsulation dot1q
Switch(config-if)#switchport mode trunk

Switch(config)#interface port-channel 5 
Switch(config-if)# switchport trunk encapsulation dot1q
Switch(config-if)#switchport mode trunk

</pre></div></div>
      <p>配置三层交换机vlan10、20、30、40的ip地址</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#<span class="sh_keyword">interface</span> vlan <span class="sh_number">10</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#ip address <span class="sh_number">192.168.10.252</span> <span class="sh_number">255.255.255.0</span></li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#<span class="sh_keyword">interface</span> vlan <span class="sh_number">20</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#ip address <span class="sh_number">192.168.20.252</span> <span class="sh_number">255.255.255.0</span></li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#<span class="sh_keyword">interface</span> vlan <span class="sh_number">30</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#ip address <span class="sh_number">192.168.30.252</span> <span class="sh_number">255.255.255.0</span></li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#<span class="sh_keyword">interface</span> vlan <span class="sh_number">40</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#ip address <span class="sh_number">192.168.40.252</span> <span class="sh_number">255.255.255.0</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">Switch(config)#interface vlan 10
Switch(config-if)#ip address 192.168.10.252 255.255.255.0

Switch(config)#interface vlan 20
Switch(config-if)#ip address 192.168.20.252 255.255.255.0

Switch(config)#interface vlan 30
Switch(config-if)#ip address 192.168.30.252 255.255.255.0

Switch(config)#interface vlan 40
Switch(config-if)#ip address 192.168.40.252 255.255.255.0

</pre></div></div>
      <p>注意：另外一台三层交换机配置的ip地址是253</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#<span class="sh_keyword">interface</span> vlan <span class="sh_number">10</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#ip address <span class="sh_number">192.168.10.253</span> <span class="sh_number">255.255.255.0</span></li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#<span class="sh_keyword">interface</span> vlan <span class="sh_number">20</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#ip address <span class="sh_number">192.168.20.253</span> <span class="sh_number">255.255.255.0</span></li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#<span class="sh_keyword">interface</span> vlan <span class="sh_number">30</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#ip address <span class="sh_number">192.168.30.253</span> <span class="sh_number">255.255.255.0</span></li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#<span class="sh_keyword">interface</span> vlan <span class="sh_number">40</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#ip address <span class="sh_number">192.168.40.253</span> <span class="sh_number">255.255.255.0</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">Switch(config)#interface vlan 10
Switch(config-if)#ip address 192.168.10.253 255.255.255.0

Switch(config)#interface vlan 20
Switch(config-if)#ip address 192.168.20.253 255.255.255.0

Switch(config)#interface vlan 30
Switch(config-if)#ip address 192.168.30.253 255.255.255.0

Switch(config)#interface vlan 40
Switch(config-if)#ip address 192.168.40.253 255.255.255.0
</pre></div></div>
      <p>===========================================================</p>
      <p class="number">步骤三：三层交换机高级配置</p>
      <p>配置生成树协议，产生负载均衡效果。</p>
      <p>MS1配置PVST+  使其成为vlan10、20的主根 vlan30、40的次根</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#spanning<span class="sh_symbol">-</span>tree vlan <span class="sh_number">10</span> root primary </li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#spanning<span class="sh_symbol">-</span>tree vlan <span class="sh_number">20</span> root primary </li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#spanning<span class="sh_symbol">-</span>tree vlan <span class="sh_number">30</span> root secondary </li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#spanning<span class="sh_symbol">-</span>tree vlan <span class="sh_number">40</span> root secondary </li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">Switch(config)#spanning-tree vlan 10 root primary 
Switch(config)#spanning-tree vlan 20 root primary 
Switch(config)#spanning-tree vlan 30 root secondary 
Switch(config)#spanning-tree vlan 40 root secondary 
</pre></div></div>
      <p>MS2配置PVST+  使其成为vlan30、40的主根 vlan10、20的次根</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#spanning<span class="sh_symbol">-</span>tree vlan <span class="sh_number">30</span> root primary </li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#spanning<span class="sh_symbol">-</span>tree vlan <span class="sh_number">40</span> root primary </li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#spanning<span class="sh_symbol">-</span>tree vlan <span class="sh_number">10</span> root secondary </li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#spanning<span class="sh_symbol">-</span>tree vlan <span class="sh_number">20</span> root secondary </li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">Switch(config)#spanning-tree vlan 30 root primary 
Switch(config)#spanning-tree vlan 40 root primary 
Switch(config)#spanning-tree vlan 10 root secondary 
Switch(config)#spanning-tree vlan 20 root secondary 
</pre></div></div>
      <p>配置热备份路由协议，完善负载均衡效果。</p>
      <p>MS1配置HSRP  使其成为vlan10、20的活跃路由器 vlan30、40的备份路由器</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#<span class="sh_keyword">interface</span> vlan <span class="sh_number">10</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#standby <span class="sh_number">10</span> ip <span class="sh_number">192.168.10.254</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#standby <span class="sh_number">10</span> priority <span class="sh_number">105</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#standby <span class="sh_number">10</span> preempt </li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#<span class="sh_keyword">interface</span> vlan <span class="sh_number">20</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#standby <span class="sh_number">20</span> ip <span class="sh_number">192.168.20.254</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#standby <span class="sh_number">20</span> priority <span class="sh_number">105</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#standby <span class="sh_number">20</span> preempt</li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#<span class="sh_keyword">interface</span> vlan <span class="sh_number">30</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#standby <span class="sh_number">30</span> ip <span class="sh_number">192.168.30.254</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#<span class="sh_keyword">interface</span> vlan <span class="sh_number">40</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#standby <span class="sh_number">40</span> ip <span class="sh_number">192.168.40.254</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">Switch(config)#interface vlan 10
Switch(config-if)#standby 10 ip 192.168.10.254
Switch(config-if)#standby 10 priority 105
Switch(config-if)#standby 10 preempt 
Switch(config)#interface vlan 20
Switch(config-if)#standby 20 ip 192.168.20.254
Switch(config-if)#standby 20 priority 105
Switch(config-if)#standby 20 preempt
Switch(config)#interface vlan 30
Switch(config-if)#standby 30 ip 192.168.30.254
Switch(config)#interface vlan 40
Switch(config-if)#standby 40 ip 192.168.40.254
</pre></div></div>
      <p>查看热备份状态</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>Switch#show standby brief</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">Switch#show standby brief
</pre></div></div>
      <p>MS2配置HSRP  使其成为vlan30、40的活跃路由器 vlan10、20的备份路由器</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#<span class="sh_keyword">interface</span> vlan <span class="sh_number">30</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#standby <span class="sh_number">30</span> ip <span class="sh_number">192.168.30.254</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#standby <span class="sh_number">30</span> priority <span class="sh_number">105</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#standby <span class="sh_number">30</span> preempt </li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#<span class="sh_keyword">interface</span> vlan <span class="sh_number">40</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#standby <span class="sh_number">40</span> ip <span class="sh_number">192.168.40.254</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#standby <span class="sh_number">40</span> priority <span class="sh_number">105</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#standby <span class="sh_number">40</span> preempt</li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#<span class="sh_keyword">interface</span> vlan <span class="sh_number">10</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#standby <span class="sh_number">10</span> ip <span class="sh_number">192.168.10.254</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#<span class="sh_keyword">interface</span> vlan <span class="sh_number">20</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#standby <span class="sh_number">20</span> ip <span class="sh_number">192.168.20.254</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">Switch(config)#interface vlan 30
Switch(config-if)#standby 30 ip 192.168.30.254
Switch(config-if)#standby 30 priority 105
Switch(config-if)#standby 30 preempt 
Switch(config)#interface vlan 40
Switch(config-if)#standby 40 ip 192.168.40.254
Switch(config-if)#standby 40 priority 105
Switch(config-if)#standby 40 preempt
Switch(config)#interface vlan 10
Switch(config-if)#standby 10 ip 192.168.10.254
Switch(config)#interface vlan 20
Switch(config-if)#standby 20 ip 192.168.20.254
</pre></div></div>
      <p>开启两台三层交换机的路由功能，并设置每个服务器所在vlan的网关</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#ip routing</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">Switch(config)#ip routing
</pre></div></div>
      <p>然后测试目前网络是否可以达成全网互通。</p>
      <p class="number">步骤四：动态路由配置</p>
      <p>按图-3为路由器与三层交换机相连的接口配置ip</p>
      <div class="image">
        <img src="./CASE_files/image003.png">
        <p>图-3</p>
      </div>
      <p>配置动态路由协议，使所有内网互通。</p>
      <p>在ms1中开启ospf动态路由，并宣告直连网段</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#router ospf <span class="sh_number">1</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span>router<span class="sh_symbol">)</span>#network <span class="sh_number">192.168.10.0</span> <span class="sh_number">0.0.0.255</span> area <span class="sh_number">0</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span>router<span class="sh_symbol">)</span>#network <span class="sh_number">192.168.20.0</span> <span class="sh_number">0.0.0.255</span> area <span class="sh_number">0</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span>router<span class="sh_symbol">)</span>#network <span class="sh_number">192.168.30.0</span> <span class="sh_number">0.0.0.255</span> area <span class="sh_number">0</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span>router<span class="sh_symbol">)</span>#network <span class="sh_number">192.168.40.0</span> <span class="sh_number">0.0.0.255</span> area <span class="sh_number">0</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span>router<span class="sh_symbol">)</span>#network <span class="sh_number">192.168.50.0</span> <span class="sh_number">0.0.0.255</span> area <span class="sh_number">0</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span>router<span class="sh_symbol">)</span>#network <span class="sh_number">192.168.60.0</span> <span class="sh_number">0.0.0.255</span> area <span class="sh_number">0</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">Switch(config)#router ospf 1
Switch(config-router)#network 192.168.10.0 0.0.0.255 area 0
Switch(config-router)#network 192.168.20.0 0.0.0.255 area 0
Switch(config-router)#network 192.168.30.0 0.0.0.255 area 0
Switch(config-router)#network 192.168.40.0 0.0.0.255 area 0
Switch(config-router)#network 192.168.50.0 0.0.0.255 area 0
Switch(config-router)#network 192.168.60.0 0.0.0.255 area 0
</pre></div></div>
      <p>在ms2中开启ospf动态路由，并宣告直连网段</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#router ospf <span class="sh_number">1</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span>router<span class="sh_symbol">)</span>#network <span class="sh_number">192.168.10.0</span> <span class="sh_number">0.0.0.255</span> area <span class="sh_number">0</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span>router<span class="sh_symbol">)</span>#network <span class="sh_number">192.168.20.0</span> <span class="sh_number">0.0.0.255</span> area <span class="sh_number">0</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span>router<span class="sh_symbol">)</span>#network <span class="sh_number">192.168.30.0</span> <span class="sh_number">0.0.0.255</span> area <span class="sh_number">0</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span>router<span class="sh_symbol">)</span>#network <span class="sh_number">192.168.40.0</span> <span class="sh_number">0.0.0.255</span> area <span class="sh_number">0</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span>router<span class="sh_symbol">)</span>#network <span class="sh_number">192.168.70.0</span> <span class="sh_number">0.0.0.255</span> area <span class="sh_number">0</span></li><li><span class="sh_function">Switch</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span>router<span class="sh_symbol">)</span>#network <span class="sh_number">192.168.80.0</span> <span class="sh_number">0.0.0.255</span> area <span class="sh_number">0</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">Switch(config)#router ospf 1
Switch(config-router)#network 192.168.10.0 0.0.0.255 area 0
Switch(config-router)#network 192.168.20.0 0.0.0.255 area 0
Switch(config-router)#network 192.168.30.0 0.0.0.255 area 0
Switch(config-router)#network 192.168.40.0 0.0.0.255 area 0
Switch(config-router)#network 192.168.70.0 0.0.0.255 area 0
Switch(config-router)#network 192.168.80.0 0.0.0.255 area 0
</pre></div></div>
      <p>在r1中开启ospf动态路由，并宣告直连网段</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_function">Router</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#router ospf <span class="sh_number">1</span></li><li><span class="sh_function">Router</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span>router<span class="sh_symbol">)</span>#network <span class="sh_number">192.168.50.0</span> <span class="sh_number">0.0.0.255</span> area <span class="sh_number">0</span></li><li><span class="sh_function">Router</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span>router<span class="sh_symbol">)</span>#network <span class="sh_number">192.168.70.0</span> <span class="sh_number">0.0.0.255</span> area <span class="sh_number">0</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">Router(config)#router ospf 1
Router(config-router)#network 192.168.50.0 0.0.0.255 area 0
Router(config-router)#network 192.168.70.0 0.0.0.255 area 0
</pre></div></div>
      <p>在r2中开启ospf动态路由，并宣告直连网段</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_function">Router</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#router ospf <span class="sh_number">1</span></li><li><span class="sh_function">Router</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span>router<span class="sh_symbol">)</span>#network <span class="sh_number">192.168.60.0</span> <span class="sh_number">0.0.0.255</span> area <span class="sh_number">0</span></li><li><span class="sh_function">Router</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span>router<span class="sh_symbol">)</span>#network <span class="sh_number">192.168.80.0</span> <span class="sh_number">0.0.0.255</span> area <span class="sh_number">0</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">Router(config)#router ospf 1
Router(config-router)#network 192.168.60.0 0.0.0.255 area 0
Router(config-router)#network 192.168.80.0 0.0.0.255 area 0
</pre></div></div>
      <p>查看所有三层设备路由表，应该是统一状态</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>show ip route</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">show ip route
</pre></div></div>
      <p class="number">步骤五：NAT配置</p>
      <p>配置r1与r2的nat功能，使内网服务器40.1映射到外网100.0.0.3，并在接口中开启</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_function">Router</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#ip nat inside source <span class="sh_keyword">static</span> <span class="sh_number">192.168.40.1</span> <span class="sh_number">100.0.0.3</span></li><li><span class="sh_function">Router</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#<span class="sh_keyword">in</span> <span class="sh_normal">g0</span><span class="sh_symbol">/</span><span class="sh_number">2</span></li><li><span class="sh_function">Router</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#ip nat outside </li><li><span class="sh_function">Router</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">)</span>#<span class="sh_keyword">in</span> range <span class="sh_normal">g0</span><span class="sh_symbol">/</span><span class="sh_number">0-1</span></li><li><span class="sh_function">Router</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span><span class="sh_keyword">if</span><span class="sh_symbol">-</span>range<span class="sh_symbol">)</span>#ip nat inside </li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">Router(config)#ip nat inside source static 192.168.40.1 100.0.0.3
Router(config)#in g0/2
Router(config-if)#ip nat outside 
Router(config-if)#in range g0/0-1
Router(config-if-range)#ip nat inside 

</pre></div></div>
      <p>在r1与r2中配置默认路由之后，使用ospf宣告自己是默认信息源（表示自己有通往外网的默认路由）</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/PROJECT1/DAY06/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_function">Router</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#ip route <span class="sh_number">0.0.0.0</span> <span class="sh_number">0.0.0.0</span> <span class="sh_number">100.0.0.10</span></li><li><span class="sh_function">Router</span><span class="sh_symbol">(</span>config<span class="sh_symbol">)</span>#router ospf <span class="sh_number">1</span></li><li><span class="sh_function">Router</span><span class="sh_symbol">(</span>config<span class="sh_symbol">-</span>router<span class="sh_symbol">)</span>#<span class="sh_keyword">default</span><span class="sh_symbol">-</span>information originate </li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">Router(config)#ip route 0.0.0.0 0.0.0.0 100.0.0.10
Router(config)#router ospf 1
Router(config-router)#default-information originate 
</pre></div></div>
      <p>三层交换机如果看不到从路由器学习来的O*默认路由就去检查路由器G0/2地址是否配置，之后验证从外网可以访问内网的web服务，可以访问证明项目升级成功。</p>
      <a name="case4">
      </a>
      <h2>4 </h2>
    </div>
  
</body></html>