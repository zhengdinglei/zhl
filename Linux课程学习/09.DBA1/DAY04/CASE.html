
<!-- saved from url=(0075)http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>CASE</title>
    
    <script type="text/javascript" src="./CASE_files/jquery.min.js">
    </script>
    <script type="text/javascript" src="./CASE_files/jquery.snippet.js">
    </script>
    <script type="text/javascript" src="./CASE_files/main.js">
    </script>
    <link type="text/css" href="./CASE_files/index.css" rel="Stylesheet">
    <link type="text/css" href="./CASE_files/jquery.snippet.css" rel="Stylesheet">
  </head>
  <body>
    <div class="source_style_case">
      <a name="page_top_case" id="top_anchor">
      </a><a id="link_top" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#page_top_case">Top</a>
      <h1>NSD DBA1 DAY04</h1>
      <ol class="index">
        <li>
          <a href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#case1">MySQL管理工具</a>
        </li>
        <li>
          <a href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#case2">密码恢复及设置</a>
        </li>
        <li>
          <a href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#case3">用户授权及撤销</a>
        </li>
      </ol>
      <a name="case1">
      </a>
      <h2>1 MySQL管理工具</h2>
      <h3>1.1 问题</h3>
      <ul class="list">
        <li>部署LAMP+phpMyAdmin平台 
</li>
      </ul>
      <h3>1.2 方案</h3>
      <p>1. 安装httpd、mysql、php-mysql及相关包</p>
      <p>2. 启动httpd服务程序</p>
      <p>3. 解压phpMyAdmin包，部署到网站目录</p>
      <p>4. 配置config.inc.php，指定MySQL主机地址</p>
      <p>5. 创建授权用户</p>
      <p>6. 浏览器访问、登录使用</p>
      <p>今天课程需要使用1台RHEL7虚拟机，其中一台作为数据服务器（192.168.4.6）、另外一台作为测试用的Linux客户机（192.168.4.254），如图-1所示。</p>
      <div class="image">
        <img src="./CASE_files/image001.png">
        <p>图-1</p>
      </div>
      <h3>1.3 步骤</h3>
      <p>实现此案例需要按照如下步骤进行。</p>
      <p class="number">步骤一：准备软件的运行环境 lamp</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@mysql6<span class="sh_symbol">~]</span># rpm <span class="sh_symbol">-</span>q httpd  php  php<span class="sh_symbol">-</span>mysql    <span class="sh_comment">//检测是否安装软件包</span></li><li>未安装软件包 httpd </li><li>未安装软件包 php </li><li>未安装软件包 php<span class="sh_symbol">-</span>mysql</li><li><span class="sh_symbol">[</span>root@mysql6<span class="sh_symbol">~]</span># yum  <span class="sh_symbol">-</span>y   install   httpd     php    php<span class="sh_symbol">-</span>mysql  <span class="sh_comment">//装包</span></li><li><span class="sh_symbol">[</span>root@mysql6<span class="sh_symbol">~]</span># systemctl  start  httpd       <span class="sh_comment">//启动服务</span></li><li><span class="sh_symbol">[</span>root@mysql6<span class="sh_symbol">~]</span># systemctl  enable httpd      <span class="sh_comment">//设置开机自启</span></li><li>Created symlink <span class="sh_normal">from </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span><span class="sh_normal">systemd</span><span class="sh_symbol">/</span><span class="sh_normal">system</span><span class="sh_symbol">/</span>multi<span class="sh_symbol">-</span>user<span class="sh_symbol">.</span>target<span class="sh_symbol">.</span><span class="sh_normal">wants</span><span class="sh_symbol">/</span>httpd<span class="sh_symbol">.</span>service <span class="sh_normal">to </span><span class="sh_symbol">/</span><span class="sh_normal">usr</span><span class="sh_symbol">/</span><span class="sh_normal">lib</span><span class="sh_symbol">/</span><span class="sh_normal">systemd</span><span class="sh_symbol">/</span><span class="sh_normal">system</span><span class="sh_symbol">/</span>httpd<span class="sh_symbol">.</span>service<span class="sh_symbol">.</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@mysql6~]# rpm -q httpd  php  php-mysql    //检测是否安装软件包
未安装软件包 httpd 
未安装软件包 php 
未安装软件包 php-mysql
[root@mysql6~]# yum  -y   install   httpd     php    php-mysql  //装包
[root@mysql6~]# systemctl  start  httpd       //启动服务
[root@mysql6~]# systemctl  enable httpd      //设置开机自启
Created symlink from /etc/systemd/system/multi-user.target.wants/httpd.service to /usr/lib/systemd/system/httpd.service.
</pre></div></div>
      <p class="number">步骤二：测试运行环境</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@mysql6<span class="sh_symbol">~]</span># <span class="sh_normal">vim  </span><span class="sh_symbol">/</span><span class="sh_keyword">var</span><span class="sh_regexp">/www/</span><span class="sh_normal">html</span><span class="sh_symbol">/</span>test<span class="sh_symbol">.</span>php     <span class="sh_comment">//编辑页面测试文件</span></li><li><span class="sh_symbol">[</span>root@mysql6<span class="sh_symbol">~]</span># <span class="sh_normal">cat </span><span class="sh_symbol">/</span><span class="sh_keyword">var</span><span class="sh_regexp">/www/</span><span class="sh_normal">html</span><span class="sh_symbol">/</span>test<span class="sh_symbol">.</span>php      <span class="sh_comment">//查看页面测试文件</span></li><li><span class="sh_symbol">&lt;?</span>php</li><li>$x<span class="sh_symbol">=</span><span class="sh_function">mysql_connect</span><span class="sh_symbol">(</span><span class="sh_string">"localhost"</span><span class="sh_symbol">,</span><span class="sh_string">"root"</span><span class="sh_symbol">,</span><span class="sh_string">"123456"</span><span class="sh_symbol">);</span></li><li><span class="sh_keyword">if</span><span class="sh_symbol">(</span>$x<span class="sh_symbol">)</span><span class="sh_cbracket">{</span>   echo <span class="sh_string">"ok"</span><span class="sh_symbol">;</span>    <span class="sh_cbracket">}</span><span class="sh_keyword">else</span><span class="sh_cbracket">{</span>    echo <span class="sh_string">"no"</span><span class="sh_symbol">;</span>    <span class="sh_cbracket">}</span><span class="sh_symbol">;</span></li><li><span class="sh_symbol">?&gt;</span></li><li><span class="sh_symbol">[</span>root@mysql6<span class="sh_symbol">~]</span># yum  <span class="sh_symbol">-</span>y   install  elinks     <span class="sh_comment">//安装测试网页工具</span></li><li><span class="sh_symbol">[</span>root@mysql6<span class="sh_symbol">~]</span>#  elinks   <span class="sh_symbol">--</span>dump   http<span class="sh_symbol">:</span><span class="sh_comment">//localhost/test.php</span></li><li>   Ok                                                <span class="sh_comment">//验证测试页面成功</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@mysql6~]# vim  /var/www/html/test.php     //编辑页面测试文件
[root@mysql6~]# cat /var/www/html/test.php      //查看页面测试文件
&lt;?php
$x=mysql_connect("localhost","root","123456");
if($x){   echo "ok";    }else{    echo "no";    };
?&gt;
[root@mysql6~]# yum  -y   install  elinks     //安装测试网页工具
[root@mysql6~]#  elinks   --dump   http://localhost/test.php
   Ok                                                //验证测试页面成功
</pre></div></div>
      <p class="number">步骤三：安装软件包</p>
      <p>1）物理机传输解压包给虚拟机192.168.4.6</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@room9pc桌面<span class="sh_symbol">]</span># scp phpMyAdmin<span class="sh_number">-2.11.11</span><span class="sh_symbol">-</span>all<span class="sh_symbol">-</span>languages<span class="sh_symbol">.</span>tar<span class="sh_symbol">.</span>gz <span class="sh_number">192.168.4.6</span><span class="sh_symbol">:</span><span class="sh_regexp">/root/</span></li><li>root@<span class="sh_number">192.168.4.6</span><span class="sh_string">'s password: </span></li><li><span class="sh_string">phpMyAdmin-2.11.11-a 100% 4218KB 122.5MB/s   00:00</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@room9pc桌面]# scp phpMyAdmin-2.11.11-all-languages.tar.gz 192.168.4.6:/root/
root@192.168.4.6's password: 
phpMyAdmin-2.11.11-a 100% 4218KB 122.5MB/s   00:00
</pre></div></div>
      <p>2）虚拟机192.168.4.6解压phpMyAdmin-2.11.11-all-languages.tar.gz压缩包</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@mysql6<span class="sh_symbol">~]</span># tar <span class="sh_symbol">-</span>zxf phpMyAdmin<span class="sh_number">-2.11.11</span><span class="sh_symbol">-</span>all<span class="sh_symbol">-</span>languages<span class="sh_symbol">.</span>tar<span class="sh_symbol">.</span>gz <span class="sh_symbol">-</span><span class="sh_normal">C </span><span class="sh_symbol">/</span><span class="sh_keyword">var</span><span class="sh_regexp">/www/</span><span class="sh_normal">html</span><span class="sh_symbol">/</span>   <span class="sh_comment">//-C 表示改变至目录</span></li><li><span class="sh_symbol">[</span>root@mysql6<span class="sh_symbol">~]</span># <span class="sh_normal">cd </span><span class="sh_symbol">/</span><span class="sh_keyword">var</span><span class="sh_regexp">/www/</span><span class="sh_normal">html</span><span class="sh_symbol">/</span></li><li><span class="sh_symbol">[</span>root@mysql6<span class="sh_symbol">~]</span># mv phpMyAdmin<span class="sh_number">-2.11.11</span><span class="sh_symbol">-</span>all<span class="sh_symbol">-</span>languages  phpmyadmin <span class="sh_comment">//改变目录名</span></li><li><span class="sh_symbol">[</span>root@mysql6<span class="sh_symbol">~]</span>#  chown  <span class="sh_symbol">-</span>R  apache<span class="sh_symbol">:</span>apache  <span class="sh_normal">phpmyadmin</span><span class="sh_symbol">/</span> <span class="sh_comment">//改变phpmyadmin目录权限</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@mysql6~]# tar -zxf phpMyAdmin-2.11.11-all-languages.tar.gz -C /var/www/html/   //-C 表示改变至目录
[root@mysql6~]# cd /var/www/html/
[root@mysql6~]# mv phpMyAdmin-2.11.11-all-languages  phpmyadmin //改变目录名
[root@mysql6~]#  chown  -R  apache:apache  phpmyadmin/ //改变phpmyadmin目录权限

</pre></div></div>
      <p class="number">步骤四：修改软件的配置文件定义管理的数据库服务器</p>
      <p>切换到部署后的phpmyadmin程序目录，拷贝配置文件，并修改配置以正确指定MySQL服务器的地址</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@mysql6html<span class="sh_symbol">]</span># cd  phpmyadmin</li><li><span class="sh_symbol">[</span>root@mysql6 phpmyadmin<span class="sh_symbol">]</span># cp   config<span class="sh_symbol">.</span>sample<span class="sh_symbol">.</span>inc<span class="sh_symbol">.</span>php   config<span class="sh_symbol">.</span>inc<span class="sh_symbol">.</span>php  </li><li><span class="sh_comment">//备份主配置文件</span></li><li><span class="sh_symbol">[</span>root@mysql6 phpmyadmin<span class="sh_symbol">]</span># vim   config<span class="sh_symbol">.</span>inc<span class="sh_symbol">.</span>php  <span class="sh_comment">//编辑主配置文件</span></li><li><span class="sh_number">17</span> $cfg<span class="sh_symbol">[</span><span class="sh_string">'blowfish_secret'</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_string">'plj123'</span><span class="sh_symbol">;</span>     <span class="sh_comment">//给cookie做认证的值，可以随便填写</span></li><li><span class="sh_number">31</span> $cfg<span class="sh_symbol">[</span><span class="sh_string">'Servers'</span><span class="sh_symbol">][</span>$i<span class="sh_symbol">][</span><span class="sh_string">'host'</span><span class="sh_symbol">]</span> <span class="sh_symbol">=</span> <span class="sh_string">'localhost'</span><span class="sh_symbol">;</span>  <span class="sh_comment">//指定主机名，定义连接哪台服务器</span></li><li><span class="sh_symbol">:</span>wq                   </li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@mysql6html]# cd  phpmyadmin
[root@mysql6 phpmyadmin]# cp   config.sample.inc.php   config.inc.php  
//备份主配置文件
[root@mysql6 phpmyadmin]# vim   config.inc.php  //编辑主配置文件
17 $cfg['blowfish_secret'] = 'plj123';     //给cookie做认证的值，可以随便填写
31 $cfg['Servers'][$i]['host'] = 'localhost';  //指定主机名，定义连接哪台服务器
:wq                   
</pre></div></div>
      <p class="number">步骤五：在客户端访问软件 管理数据库服务器</p>
      <p>1）在客户端访问软件,打开浏览器输入http://192.168.4.6/phpmyadmin(数据库服务器地址) 访问软件，如图-2所示，用户名是root，密码是123456</p>
      <div class="image">
        <img src="./CASE_files/image002.png">
        <p>图-2</p>
      </div>
      <p>2）登入成功后，如图-3示，即可在授权范围内对MySQL数据库进行管理。</p>
      <p>/</p><p>图-3</p><p></p>
      <a name="case2">
      </a>
      <h2>2 密码恢复及设置</h2>
      <h3>2.1 问题</h3>
      <p>本案例要求密码恢复及设置，完成以下任务操作：</p>
      <ul class="list">
        <li>恢复MySQL管理列表
</li>
        <li>正常设置管理密码
</li>
      </ul>
      <h3>2.2 步骤</h3>
      <p>实现此案例需要按照如下步骤进行。</p>
      <p class="number">步骤一：重置MySQL管理密码</p>
      <p>1）首先停止已运行的MySQL服务程序</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@dbsvr1 <span class="sh_symbol">~]</span># systemctl  stop mysqld<span class="sh_symbol">.</span>service   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//停止服务</span></li><li><span class="sh_symbol">[</span>root@dbsvr1 <span class="sh_symbol">~]</span># systemctl  status mysqld<span class="sh_symbol">.</span>service  &nbsp;&nbsp;&nbsp;&nbsp;    <span class="sh_comment">//确认状态</span></li><li>mysqld<span class="sh_symbol">.</span>service <span class="sh_symbol">-</span> MySQL Server</li><li>   Loaded<span class="sh_symbol">:</span> <span class="sh_function">loaded</span> <span class="sh_symbol">(</span><span class="sh_regexp">/usr/</span><span class="sh_normal">lib</span><span class="sh_symbol">/</span><span class="sh_normal">systemd</span><span class="sh_symbol">/</span><span class="sh_normal">system</span><span class="sh_symbol">/</span>mysqld<span class="sh_symbol">.</span>service<span class="sh_symbol">;</span> enabled<span class="sh_symbol">)</span></li><li>   Active<span class="sh_symbol">:</span> <span class="sh_function">inactive</span> <span class="sh_symbol">(</span>dead<span class="sh_symbol">)</span> since 五 <span class="sh_number">2017-04-07</span> <span class="sh_number">23</span><span class="sh_symbol">:</span><span class="sh_number">01</span><span class="sh_symbol">:</span><span class="sh_number">38</span> CST<span class="sh_symbol">;</span> 21s ago</li><li>     Docs<span class="sh_symbol">:</span> man<span class="sh_symbol">:</span><span class="sh_function">mysqld</span><span class="sh_symbol">(</span><span class="sh_number">8</span><span class="sh_symbol">)</span></li><li>           http<span class="sh_symbol">:</span><span class="sh_comment">//dev.mysql.com/doc/refman/en/using-systemd.html</span></li><li>  Process<span class="sh_symbol">:</span> <span class="sh_number">20260</span> ExecStart<span class="sh_symbol">=</span><span class="sh_regexp">/usr/</span><span class="sh_normal">sbin</span><span class="sh_symbol">/</span>mysqld <span class="sh_symbol">--</span>daemonize <span class="sh_symbol">--</span>pid<span class="sh_symbol">-</span>file<span class="sh_symbol">=</span><span class="sh_regexp">/var/</span><span class="sh_normal">run</span><span class="sh_symbol">/</span><span class="sh_normal">mysqld</span><span class="sh_symbol">/</span>mysqld<span class="sh_symbol">.</span>pid $<span class="sh_function">MYSQLD_OPTS</span> <span class="sh_symbol">(</span>code<span class="sh_symbol">=</span>exited<span class="sh_symbol">,</span> status<span class="sh_symbol">=</span><span class="sh_number">0</span><span class="sh_symbol">/</span>SUCCESS<span class="sh_symbol">)</span></li><li>  Process<span class="sh_symbol">:</span> <span class="sh_number">20238</span> ExecStartPre<span class="sh_symbol">=</span><span class="sh_regexp">/usr/</span><span class="sh_normal">bin</span><span class="sh_symbol">/</span><span class="sh_function">mysqld_pre_systemd</span> <span class="sh_symbol">(</span>code<span class="sh_symbol">=</span>exited<span class="sh_symbol">,</span> status<span class="sh_symbol">=</span><span class="sh_number">0</span><span class="sh_symbol">/</span>SUCCESS<span class="sh_symbol">)</span></li><li> Main PID<span class="sh_symbol">:</span> <span class="sh_number">20262</span> <span class="sh_symbol">(</span>code<span class="sh_symbol">=</span>exited<span class="sh_symbol">,</span> status<span class="sh_symbol">=</span><span class="sh_number">0</span><span class="sh_symbol">/</span>SUCCESS<span class="sh_symbol">)</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@dbsvr1 ~]# systemctl  stop mysqld.service   		//停止服务
[root@dbsvr1 ~]# systemctl  status mysqld.service  	    //确认状态
mysqld.service - MySQL Server
   Loaded: loaded (/usr/lib/systemd/system/mysqld.service; enabled)
   Active: inactive (dead) since 五 2017-04-07 23:01:38 CST; 21s ago
     Docs: man:mysqld(8)
           http://dev.mysql.com/doc/refman/en/using-systemd.html
  Process: 20260 ExecStart=/usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid $MYSQLD_OPTS (code=exited, status=0/SUCCESS)
  Process: 20238 ExecStartPre=/usr/bin/mysqld_pre_systemd (code=exited, status=0/SUCCESS)
 Main PID: 20262 (code=exited, status=0/SUCCESS)
</pre></div></div>
      <p>2）然后跳过授权表启动MySQL服务程序</p>
      <p>这一步主要利用mysqld的 --skip-grant-tables选项</p>
      <p>修改my.cnf配置，添加 skip_grant_tables=1启动设置：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@dbsvr1 <span class="sh_symbol">~]</span># <span class="sh_normal">vim </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span>my<span class="sh_symbol">.</span>cnf</li><li><span class="sh_symbol">[</span>mysqld<span class="sh_symbol">]</span></li><li>skip_grant_tables<span class="sh_symbol">=</span><span class="sh_number">1</span></li><li><span class="sh_symbol">..</span> <span class="sh_symbol">..</span></li><li><span class="sh_symbol">[</span>root@dbsvr1 <span class="sh_symbol">~]</span># systemctl  restart mysqld<span class="sh_symbol">.</span>service</li><li><span class="sh_symbol">[</span>root@dbsvr1 <span class="sh_symbol">~]</span># service mysql status</li><li>mysqld<span class="sh_symbol">.</span>service <span class="sh_symbol">-</span> MySQL Server</li><li>   Loaded<span class="sh_symbol">:</span> <span class="sh_function">loaded</span> <span class="sh_symbol">(</span><span class="sh_regexp">/usr/</span><span class="sh_normal">lib</span><span class="sh_symbol">/</span><span class="sh_normal">systemd</span><span class="sh_symbol">/</span><span class="sh_normal">system</span><span class="sh_symbol">/</span>mysqld<span class="sh_symbol">.</span>service<span class="sh_symbol">;</span> enabled<span class="sh_symbol">)</span></li><li>   Active<span class="sh_symbol">:</span> <span class="sh_function">active</span> <span class="sh_symbol">(</span>running<span class="sh_symbol">)</span> since 五 <span class="sh_number">2017-04-07</span> <span class="sh_number">23</span><span class="sh_symbol">:</span><span class="sh_number">40</span><span class="sh_symbol">:</span><span class="sh_number">20</span> CST<span class="sh_symbol">;</span> 40s ago</li><li>     Docs<span class="sh_symbol">:</span> man<span class="sh_symbol">:</span><span class="sh_function">mysqld</span><span class="sh_symbol">(</span><span class="sh_number">8</span><span class="sh_symbol">)</span></li><li>           http<span class="sh_symbol">:</span><span class="sh_comment">//dev.mysql.com/doc/refman/en/using-systemd.html</span></li><li>  Process<span class="sh_symbol">:</span> <span class="sh_number">11698</span> ExecStart<span class="sh_symbol">=</span><span class="sh_regexp">/usr/</span><span class="sh_normal">sbin</span><span class="sh_symbol">/</span>mysqld <span class="sh_symbol">--</span>daemonize <span class="sh_symbol">--</span>pid<span class="sh_symbol">-</span>file<span class="sh_symbol">=</span><span class="sh_regexp">/var/</span><span class="sh_normal">run</span><span class="sh_symbol">/</span><span class="sh_normal">mysqld</span><span class="sh_symbol">/</span>mysqld<span class="sh_symbol">.</span>pid $<span class="sh_function">MYSQLD_OPTS</span> <span class="sh_symbol">(</span>code<span class="sh_symbol">=</span>exited<span class="sh_symbol">,</span> status<span class="sh_symbol">=</span><span class="sh_number">0</span><span class="sh_symbol">/</span>SUCCESS<span class="sh_symbol">)</span></li><li>  Process<span class="sh_symbol">:</span> <span class="sh_number">11676</span> ExecStartPre<span class="sh_symbol">=</span><span class="sh_regexp">/usr/</span><span class="sh_normal">bin</span><span class="sh_symbol">/</span><span class="sh_function">mysqld_pre_systemd</span> <span class="sh_symbol">(</span>code<span class="sh_symbol">=</span>exited<span class="sh_symbol">,</span> status<span class="sh_symbol">=</span><span class="sh_number">0</span><span class="sh_symbol">/</span>SUCCESS<span class="sh_symbol">)</span></li><li> Main PID<span class="sh_symbol">:</span> <span class="sh_number">11701</span> <span class="sh_symbol">(</span>mysqld<span class="sh_symbol">)</span></li><li>   CGroup<span class="sh_symbol">:</span> <span class="sh_regexp">/system.slice/m</span>ysqld<span class="sh_symbol">.</span>service</li><li>           └─<span class="sh_number">11701</span><span class="sh_normal"> </span><span class="sh_symbol">/</span><span class="sh_normal">usr</span><span class="sh_symbol">/</span><span class="sh_normal">sbin</span><span class="sh_symbol">/</span>mysqld <span class="sh_symbol">--</span>daemonize <span class="sh_symbol">--</span>pid<span class="sh_symbol">-</span>file<span class="sh_symbol">=</span><span class="sh_regexp">/var/</span><span class="sh_normal">run</span><span class="sh_symbol">/</span><span class="sh_normal">mysqld</span><span class="sh_symbol">/</span>mysqld<span class="sh_symbol">.</span>p<span class="sh_symbol">...</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@dbsvr1 ~]# vim /etc/my.cnf
[mysqld]
skip_grant_tables=1
.. ..
[root@dbsvr1 ~]# systemctl  restart mysqld.service
[root@dbsvr1 ~]# service mysql status
mysqld.service - MySQL Server
   Loaded: loaded (/usr/lib/systemd/system/mysqld.service; enabled)
   Active: active (running) since 五 2017-04-07 23:40:20 CST; 40s ago
     Docs: man:mysqld(8)
           http://dev.mysql.com/doc/refman/en/using-systemd.html
  Process: 11698 ExecStart=/usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid $MYSQLD_OPTS (code=exited, status=0/SUCCESS)
  Process: 11676 ExecStartPre=/usr/bin/mysqld_pre_systemd (code=exited, status=0/SUCCESS)
 Main PID: 11701 (mysqld)
   CGroup: /system.slice/mysqld.service
           └─11701 /usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.p...
</pre></div></div>
      <p>3）使用mysql命令连接到MySQL服务，重设root的密码</p>
      <p>由于前一步启动的MySQL服务跳过了授权表，所以可以root从本机直接登录</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@dbsvr1 <span class="sh_symbol">~]</span># mysql <span class="sh_symbol">-</span>u root</li><li>Enter password<span class="sh_symbol">:</span>                                 <span class="sh_comment">//直接回车即可</span></li><li>Welcome to the MySQL monitor<span class="sh_symbol">.</span>  Commands end <span class="sh_keyword">with</span> <span class="sh_symbol">;</span> or <span class="sh_symbol">\</span>g<span class="sh_symbol">.</span></li><li>Your MySQL connection id is <span class="sh_number">4</span></li><li>Server version<span class="sh_symbol">:</span> <span class="sh_number">5.7.17</span> MySQL Community <span class="sh_function">Server</span> <span class="sh_symbol">(</span>GPL<span class="sh_symbol">)</span></li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_function">Copyright</span> <span class="sh_symbol">(</span>c<span class="sh_symbol">)</span> <span class="sh_number">2000</span><span class="sh_symbol">,</span> <span class="sh_number">2016</span><span class="sh_symbol">,</span> Oracle <span class="sh_normal">and</span><span class="sh_symbol">/</span>or its affiliates<span class="sh_symbol">.</span> All rights reserved<span class="sh_symbol">.</span></li><li><span style="display:none;">&nbsp;</span></li><li>Oracle is a registered trademark of Oracle Corporation <span class="sh_normal">and</span><span class="sh_symbol">/</span>or its</li><li>affiliates<span class="sh_symbol">.</span> Other names may be trademarks of their respective</li><li>owners<span class="sh_symbol">.</span></li><li><span style="display:none;">&nbsp;</span></li><li>Type <span class="sh_string">'help;'</span> or <span class="sh_string">'</span><span class="sh_specialchar">\h</span><span class="sh_string">'</span> <span class="sh_keyword">for</span> help<span class="sh_symbol">.</span> Type <span class="sh_string">'</span><span class="sh_specialchar">\c</span><span class="sh_string">'</span> to clear the current input statement<span class="sh_symbol">.</span></li><li><span style="display:none;">&nbsp;</span></li><li>mysql<span class="sh_symbol">&gt;</span> </li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@dbsvr1 ~]# mysql -u root
Enter password:                                 //直接回车即可
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 4
Server version: 5.7.17 MySQL Community Server (GPL)

Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt; 
</pre></div></div>
      <p>进入 mysql&gt; 环境后，通过修改mysql库中user表的相关记录，重设root用户从本机登录的密码：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span> UPDATE mysql<span class="sh_symbol">.</span>user SET authentication_string<span class="sh_symbol">=</span><span class="sh_function">PASSWORD</span><span class="sh_symbol">(</span><span class="sh_string">'1234567'</span><span class="sh_symbol">)</span></li><li>    <span class="sh_symbol">-&gt;</span> WHERE user<span class="sh_symbol">=</span><span class="sh_string">'root'</span> AND host<span class="sh_symbol">=</span><span class="sh_string">'localhost'</span><span class="sh_symbol">;</span>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//重设root的密码</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">1</span> row affected<span class="sh_symbol">,</span> <span class="sh_number">1</span> <span class="sh_function">warning</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li><li>Rows matched<span class="sh_symbol">:</span> <span class="sh_number">1</span>  Changed<span class="sh_symbol">:</span> <span class="sh_number">1</span>  Warnings<span class="sh_symbol">:</span> <span class="sh_number">1</span></li><li>mysql<span class="sh_symbol">&gt;</span> FLUSH PRIVILEGES<span class="sh_symbol">;</span>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//刷新授权表</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">0</span> rows <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.01</span> sec<span class="sh_symbol">)</span></li><li>mysql<span class="sh_symbol">&gt;</span> exit  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//退出mysql&gt; 环境</span></li><li>Bye</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt; UPDATE mysql.user SET authentication_string=PASSWORD('1234567')
    -&gt; WHERE user='root' AND host='localhost';  			//重设root的密码
Query OK, 1 row affected, 1 warning (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 1
mysql&gt; FLUSH PRIVILEGES;  								//刷新授权表
Query OK, 0 rows affected (0.01 sec)
mysql&gt; exit  											//退出mysql&gt; 环境
Bye
</pre></div></div>
      <p>通过执行“FLUSH PRIVILEGES;”可使授权表立即生效，对于正常运行的MySQL服务，也可以用上述方法来修改密码，不用重启服务。本例中因为是恢复密码，最好重启MySQL服务程序，所以上述“FLUSH PRIVILEGES;”操作可跳过。</p>
      <p>4）重新以正常方式启动MySQL服务程序，验证新密码</p>
      <p>如果前面是修改/etc/my.cnf配置的方法来跳过授权表，则重置root密码后，应去除相应的设置以恢复正常：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@dbsvr1 <span class="sh_symbol">~]</span># <span class="sh_normal">vim </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span>my<span class="sh_symbol">.</span>cnf</li><li><span class="sh_symbol">[</span>mysqld<span class="sh_symbol">]</span></li><li>#skip_grant_tables<span class="sh_symbol">=</span><span class="sh_number">1</span>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//注释掉或删除此行</span></li><li><span class="sh_symbol">..</span> <span class="sh_symbol">..</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@dbsvr1 ~]# vim /etc/my.cnf
[mysqld]
#skip_grant_tables=1  							//注释掉或删除此行
.. ..
</pre></div></div>
      <p>按正常方式，通过mysql脚本重启服务即可：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@dbsvr1 <span class="sh_symbol">~]</span># systemctl  restart mysqld<span class="sh_symbol">.</span>service</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@dbsvr1 ~]# systemctl  restart mysqld.service
</pre></div></div>
      <p>验证无密码登录时，将会被拒绝：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@dbsvr1 <span class="sh_symbol">~]</span># mysql <span class="sh_symbol">-</span>u root</li><li>Enter password<span class="sh_symbol">:</span>                            <span class="sh_comment">//没有跳过授权表回车会报错</span></li><li>ERROR <span class="sh_number">1045</span> <span class="sh_symbol">(</span><span class="sh_number">28000</span><span class="sh_symbol">):</span> Access denied <span class="sh_keyword">for</span> user <span class="sh_string">'root'</span>@<span class="sh_string">'localhost'</span> <span class="sh_symbol">(</span>using password<span class="sh_symbol">:</span> NO<span class="sh_symbol">)</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@dbsvr1 ~]# mysql -u root
Enter password:                            //没有跳过授权表回车会报错
ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: NO)
</pre></div></div>
      <p>只有提供重置后的新密码，才能成功登入：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@dbsvr1 <span class="sh_symbol">~]</span># mysql <span class="sh_symbol">-</span>u root –p</li><li>Enter password<span class="sh_symbol">:</span></li><li>Welcome to the MySQL monitor<span class="sh_symbol">.</span>  Commands end <span class="sh_keyword">with</span> <span class="sh_symbol">;</span> or <span class="sh_symbol">\</span>g<span class="sh_symbol">.</span></li><li>Your MySQL connection id is <span class="sh_number">4</span></li><li>Server version<span class="sh_symbol">:</span> <span class="sh_number">5.7.17</span> MySQL Community <span class="sh_function">Server</span> <span class="sh_symbol">(</span>GPL<span class="sh_symbol">)</span></li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_function">Copyright</span> <span class="sh_symbol">(</span>c<span class="sh_symbol">)</span> <span class="sh_number">2000</span><span class="sh_symbol">,</span> <span class="sh_number">2016</span><span class="sh_symbol">,</span> Oracle <span class="sh_normal">and</span><span class="sh_symbol">/</span>or its affiliates<span class="sh_symbol">.</span> All rights reserved<span class="sh_symbol">.</span></li><li><span style="display:none;">&nbsp;</span></li><li>Oracle is a registered trademark of Oracle Corporation <span class="sh_normal">and</span><span class="sh_symbol">/</span>or its</li><li>affiliates<span class="sh_symbol">.</span> Other names may be trademarks of their respective</li><li>owners<span class="sh_symbol">.</span></li><li><span style="display:none;">&nbsp;</span></li><li>Type <span class="sh_string">'help;'</span> or <span class="sh_string">'</span><span class="sh_specialchar">\h</span><span class="sh_string">'</span> <span class="sh_keyword">for</span> help<span class="sh_symbol">.</span> Type <span class="sh_string">'</span><span class="sh_specialchar">\c</span><span class="sh_string">'</span> to clear the current input statement<span class="sh_symbol">.</span></li><li><span style="display:none;">&nbsp;</span></li><li>mysql<span class="sh_symbol">&gt;</span> </li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@dbsvr1 ~]# mysql -u root –p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 4
Server version: 5.7.17 MySQL Community Server (GPL)

Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt; 
</pre></div></div>
      <p class="number">步骤二：正常设置MySQL管理密码</p>
      <p>正常的前提是：已知当前MySQL管理用户（root）的密码。</p>
      <p>1）方法1，在Shell命令行下设置</p>
      <p>使用mysqladmin管理工具，需要验证旧的密码。比如，以下操作将会把root的密码设置为 1234567：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@dbsvr1 <span class="sh_symbol">~]</span># mysqladmin <span class="sh_symbol">-</span>u root <span class="sh_symbol">-</span>p password <span class="sh_string">'1234567'</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li>Enter password<span class="sh_symbol">:</span>                                   <span class="sh_comment">//验证原来的密码</span></li><li>mysqladmin<span class="sh_symbol">:</span> <span class="sh_symbol">[</span>Warning<span class="sh_symbol">]</span> Using a password on the command line <span class="sh_keyword">interface</span> can be insecure<span class="sh_symbol">.</span></li><li>Warning<span class="sh_symbol">:</span> Since password will be sent to server <span class="sh_keyword">in</span> plain text<span class="sh_symbol">,</span> use ssl connection to ensure password safety<span class="sh_symbol">.</span>                              <span class="sh_comment">//提示明文修改不安全，并不是报错</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@dbsvr1 ~]# mysqladmin -u root -p password '1234567'					
Enter password:                                   //验证原来的密码
mysqladmin: [Warning] Using a password on the command line interface can be insecure.
Warning: Since password will be sent to server in plain text, use ssl connection to ensure password safety.                              //提示明文修改不安全，并不是报错
</pre></div></div>
      <p>2）方法2，以root登入mysql&gt; 后，使用SET PASSWORD指令设置</p>
      <p>这个与新安装MySQL-server后首次修改密码时要求的方式相同，平时也可以用：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span> SET PASSWORD FOR root@localhost<span class="sh_symbol">=</span><span class="sh_function">PASSWORD</span><span class="sh_symbol">(</span><span class="sh_string">'1234567'</span><span class="sh_symbol">);</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">0</span> rows affected<span class="sh_symbol">,</span> <span class="sh_number">1</span> <span class="sh_function">warning</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt; SET PASSWORD FOR root@localhost=PASSWORD('1234567');
Query OK, 0 rows affected, 1 warning (0.00 sec)
</pre></div></div>
      <p>3）方法3，以root登入mysql&gt; 后，使用GRANT授权工具设置</p>
      <p>这个是最常见的用户授权方式（下一节会做更多授权的练习）：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span> GRANT all ON <span class="sh_symbol">*.*</span> TO root@localhost IDENTIFIED BY <span class="sh_string">'1234567'</span><span class="sh_symbol">;</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">0</span> rows affected<span class="sh_symbol">,</span> <span class="sh_number">1</span> <span class="sh_function">warning</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt; GRANT all ON *.* TO root@localhost IDENTIFIED BY '1234567';
Query OK, 0 rows affected, 1 warning (0.00 sec)
</pre></div></div>
      <p>4）方法4，以root登入mysql&gt; 后，使用UPDATE更新相应的表记录</p>
      <p>这种方法与恢复密码时的操作相同：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span> UPDATE mysql<span class="sh_symbol">.</span>user SET authentication_string<span class="sh_symbol">=</span><span class="sh_function">PASSWORD</span><span class="sh_symbol">(</span><span class="sh_string">'1234567'</span><span class="sh_symbol">)</span></li><li>    <span class="sh_symbol">-&gt;</span> WHERE user<span class="sh_symbol">=</span><span class="sh_string">'root'</span> AND host<span class="sh_symbol">=</span><span class="sh_string">'localhost'</span><span class="sh_symbol">;</span>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//重设root的密码</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">0</span> rows affected<span class="sh_symbol">,</span> <span class="sh_number">1</span> <span class="sh_function">warning</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li><li>Rows matched<span class="sh_symbol">:</span> <span class="sh_number">1</span>  Changed<span class="sh_symbol">:</span> <span class="sh_number">0</span>  Warnings<span class="sh_symbol">:</span> <span class="sh_number">1</span></li><li>mysql<span class="sh_symbol">&gt;</span> FLUSH PRIVILEGES<span class="sh_symbol">;</span>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//刷新授权表</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">0</span> rows <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt; UPDATE mysql.user SET authentication_string=PASSWORD('1234567')
    -&gt; WHERE user='root' AND host='localhost';  		//重设root的密码
Query OK, 0 rows affected, 1 warning (0.00 sec)
Rows matched: 1  Changed: 0  Warnings: 1
mysql&gt; FLUSH PRIVILEGES;  								//刷新授权表
Query OK, 0 rows affected (0.00 sec)
</pre></div></div>
      <p>在上述方法中，需要特别注意：当MySQL服务程序以 skip-grant-tables 选项启动时，如果未执行“FLUSH PRIVILEGES;”操作，是无法通过SET PASSWORD或者GRANT方式来设置密码的。比如，验证这两种方式时，都会看到ERROR 1290的出错提示：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span> SET PASSWORD FOR root@localhost<span class="sh_symbol">=</span><span class="sh_function">PASSWORD</span><span class="sh_symbol">(</span><span class="sh_string">'1234567'</span><span class="sh_symbol">);</span></li><li>ERROR <span class="sh_number">1290</span> <span class="sh_symbol">(</span>HY000<span class="sh_symbol">):</span> The MySQL server is running <span class="sh_keyword">with</span> the <span class="sh_symbol">--</span>skip<span class="sh_symbol">-</span>grant<span class="sh_symbol">-</span>tables option so it cannot execute <span class="sh_keyword">this</span> statement</li><li><span style="display:none;">&nbsp;</span></li><li>mysql<span class="sh_symbol">&gt;</span> GRANT all ON <span class="sh_symbol">*.*</span> TO root@localhost IDENTIFIED BY <span class="sh_string">'1234567'</span><span class="sh_symbol">;</span></li><li>ERROR <span class="sh_number">1290</span> <span class="sh_symbol">(</span>HY000<span class="sh_symbol">):</span> The MySQL server is running <span class="sh_keyword">with</span> the <span class="sh_symbol">--</span>skip<span class="sh_symbol">-</span>grant<span class="sh_symbol">-</span>tables option so it cannot execute <span class="sh_keyword">this</span> statement</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt; SET PASSWORD FOR root@localhost=PASSWORD('1234567');
ERROR 1290 (HY000): The MySQL server is running with the --skip-grant-tables option so it cannot execute this statement

mysql&gt; GRANT all ON *.* TO root@localhost IDENTIFIED BY '1234567';
ERROR 1290 (HY000): The MySQL server is running with the --skip-grant-tables option so it cannot execute this statement
</pre></div></div>
      <a name="case3">
      </a>
      <h2>3 用户授权及撤销</h2>
      <h3>3.1 问题</h3>
      <ul class="list">
        <li>允许root从192.168.4.0/24网段 访问，对所有库/表有完全权限，密码为tarena
</li>
        <li>添加一个管理账号dba007，完全控制及授权
</li>
        <li>撤销root从本机访问的权限，然后恢复
</li>
        <li>允许webuser从任意客户机登录，只对webdb库有完全权限，密码为 888888
</li>
        <li>撤销webuser的完全权限，改为查询权限
</li>
      </ul>
      <h3>3.2 方案</h3>
      <p>使用2台RHEL 7虚拟机，如图-1所示。其中192.168.4.10是MySQL服务器，授权及撤销操作均在此服务器上执行；而192.168.4.120作为测试客户机，需要安装好MySQL-client软件包，以便提供mysql命令。</p>
      <div class="image">
        <img src="./CASE_files/image003.png">
        <p>图-1</p>
      </div>
      <p>同时，MySQL服务器本身（192.168.4.10）也可以作为测试客户机。</p>
      <h3>3.3 步骤</h3>
      <p>实现此案例需要按照如下步骤进行。</p>
      <p class="number">步骤一：用户授权及撤销</p>
      <p>1）允许root从192.168.4.0/24访问，对所有库表有完全权限，密码为tarena。</p>
      <p>授权之前，从192.168.4.0/24网段的客户机访问时，将会被拒绝：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@host120 <span class="sh_symbol">~]</span># mysql <span class="sh_symbol">-</span>u root <span class="sh_symbol">-</span>p <span class="sh_symbol">-</span>h <span class="sh_number">192.168.4.10</span></li><li>Enter password<span class="sh_symbol">:</span>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//输入正确的密码</span></li><li>ERROR <span class="sh_number">2003</span> <span class="sh_symbol">(</span>HY000<span class="sh_symbol">):</span> Host <span class="sh_string">'192.168.4.120'</span> is not allowed to connect to <span class="sh_keyword">this</span> MySQL server</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@host120 ~]# mysql -u root -p -h 192.168.4.10
Enter password:  								//输入正确的密码
ERROR 2003 (HY000): Host '192.168.4.120' is not allowed to connect to this MySQL server
</pre></div></div>
      <p>授权操作，此处可设置与从localhost访问时不同的密码：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span> GRANT all ON <span class="sh_symbol">*.*</span> TO root@<span class="sh_string">'192.168.4.%'</span> IDENTIFIED BY <span class="sh_string">'tarena'</span><span class="sh_symbol">;</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">0</span> rows <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt; GRANT all ON *.* TO root@'192.168.4.%' IDENTIFIED BY 'tarena';
Query OK, 0 rows affected (0.00 sec)
</pre></div></div>
      <p>再次从192.168.4.0/24网段的客户机访问时，输入正确的密码后可登入：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@host120 <span class="sh_symbol">~]</span># mysql <span class="sh_symbol">-</span>u root <span class="sh_symbol">-</span>p <span class="sh_symbol">-</span>h <span class="sh_number">192.168.4.10</span></li><li>Enter password<span class="sh_symbol">:</span></li><li>Welcome to the MySQL monitor<span class="sh_symbol">.</span>  Commands end <span class="sh_keyword">with</span> <span class="sh_symbol">;</span> or <span class="sh_symbol">\</span>g<span class="sh_symbol">.</span></li><li>Your MySQL connection id is <span class="sh_number">20</span></li><li>Server version<span class="sh_symbol">:</span> <span class="sh_number">5.7.17</span> MySQL Community <span class="sh_function">Server</span> <span class="sh_symbol">(</span>GPL<span class="sh_symbol">)</span></li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_function">Copyright</span> <span class="sh_symbol">(</span>c<span class="sh_symbol">)</span> <span class="sh_number">2000</span><span class="sh_symbol">,</span> <span class="sh_number">2016</span><span class="sh_symbol">,</span> Oracle <span class="sh_normal">and</span><span class="sh_symbol">/</span>or its affiliates<span class="sh_symbol">.</span> All rights reserved<span class="sh_symbol">.</span></li><li><span style="display:none;">&nbsp;</span></li><li>Oracle is a registered trademark of Oracle Corporation <span class="sh_normal">and</span><span class="sh_symbol">/</span>or its</li><li>affiliates<span class="sh_symbol">.</span> Other names may be trademarks of their respective</li><li>owners<span class="sh_symbol">.</span></li><li><span style="display:none;">&nbsp;</span></li><li>Type <span class="sh_string">'help;'</span> or <span class="sh_string">'</span><span class="sh_specialchar">\h</span><span class="sh_string">'</span> <span class="sh_keyword">for</span> help<span class="sh_symbol">.</span> Type <span class="sh_string">'</span><span class="sh_specialchar">\c</span><span class="sh_string">'</span> to clear the current input statement<span class="sh_symbol">.</span></li><li><span style="display:none;">&nbsp;</span></li><li>mysql<span class="sh_symbol">&gt;</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@host120 ~]# mysql -u root -p -h 192.168.4.10
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 20
Server version: 5.7.17 MySQL Community Server (GPL)

Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt;
</pre></div></div>
      <p>从网络登入后，测试新建一个库、查看所有库：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span> CREATE DATABASE rootdb<span class="sh_symbol">;</span>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//创建新库rootdb</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">1</span> row <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.06</span> sec<span class="sh_symbol">)</span></li><li><span style="display:none;">&nbsp;</span></li><li>mysql<span class="sh_symbol">&gt;</span> SHOW DATABASES<span class="sh_symbol">;</span></li><li><span class="sh_symbol">+--------------------+</span></li><li><span class="sh_symbol">|</span> Database           <span class="sh_symbol">|</span></li><li><span class="sh_symbol">+--------------------+</span></li><li><span class="sh_symbol">|</span> information_schema <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> home               <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> mysql              <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> performance_schema <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> rootdb             <span class="sh_symbol">|</span>                         <span class="sh_comment">//新建的rootdb库</span></li><li><span class="sh_symbol">|</span> sys                <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> userdb             <span class="sh_symbol">|</span></li><li><span class="sh_symbol">+--------------------+</span></li><li><span class="sh_number">7</span> rows <span class="sh_keyword">in</span> <span class="sh_function">set</span> <span class="sh_symbol">(</span><span class="sh_number">0.01</span> sec<span class="sh_symbol">)</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt; CREATE DATABASE rootdb;  				//创建新库rootdb
Query OK, 1 row affected (0.06 sec)

mysql&gt; SHOW DATABASES;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| home               |
| mysql              |
| performance_schema |
| rootdb             |                         //新建的rootdb库
| sys                |
| userdb             |
+--------------------+
7 rows in set (0.01 sec)
</pre></div></div>
      <p>2）在Mysql服务器上建立一个管理账号dba007，对所有库完全控制，并赋予其授权的权限</p>
      <p>新建账号并授权：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span> GRANT all ON <span class="sh_symbol">*.*</span> TO dba007@localhost</li><li>    <span class="sh_symbol">-&gt;</span> IDENTIFIED BY <span class="sh_string">'1234567'</span></li><li>    <span class="sh_symbol">-&gt;</span> WITH GRANT OPTION<span class="sh_symbol">;</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">0</span> rows <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt; GRANT all ON *.* TO dba007@localhost
    -&gt; IDENTIFIED BY '1234567'
    -&gt; WITH GRANT OPTION;
Query OK, 0 rows affected (0.00 sec)
</pre></div></div>
      <p>查看dba007的权限：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span> SHOW GRANTS FOR dba007@localhost<span class="sh_symbol">;</span></li><li><span class="sh_symbol">+-----------------------------------------------------------------------+</span></li><li><span class="sh_symbol">|</span> Grants <span class="sh_keyword">for</span> dba007@localhost                                           <span class="sh_symbol">|</span></li><li><span class="sh_symbol">+-----------------------------------------------------------------------+</span></li><li><span class="sh_symbol">|</span> GRANT ALL PRIVILEGES ON <span class="sh_symbol">*.*</span> TO <span class="sh_string">'dba007'</span>@<span class="sh_string">'localhost'</span> WITH GRANT OPTION <span class="sh_symbol">|</span></li><li><span class="sh_symbol">+-----------------------------------------------------------------------+</span></li><li><span class="sh_number">1</span> row <span class="sh_keyword">in</span> <span class="sh_function">set</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt; SHOW GRANTS FOR dba007@localhost;
+-----------------------------------------------------------------------+
| Grants for dba007@localhost                                           |
+-----------------------------------------------------------------------+
| GRANT ALL PRIVILEGES ON *.* TO 'dba007'@'localhost' WITH GRANT OPTION |
+-----------------------------------------------------------------------+
1 row in set (0.00 sec)
</pre></div></div>
      <p>3）撤销root从本机访问的权限，然后恢复</p>
      <p class="emphasiz">注意：如果没有事先建立其他管理账号，请不要轻易撤销root用户的本地访问权限，否则恢复起来会比较困难，甚至不得不重装数据库。</p>
      <p>撤销root对数据库的操作权限：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span> REVOKE all ON <span class="sh_symbol">*.*</span> FROM root@localhost<span class="sh_symbol">;</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">0</span> rows <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li><li>mysql<span class="sh_symbol">&gt;</span> SHOW GRANTS FOR root@localhost<span class="sh_symbol">;</span></li><li><span class="sh_symbol">+--------------------------------------------------------------+</span></li><li><span class="sh_symbol">|</span> Grants <span class="sh_keyword">for</span> root@localhost                                    <span class="sh_symbol">|</span></li><li><span class="sh_symbol">+--------------------------------------------------------------+</span></li><li><span class="sh_symbol">|</span> GRANT USAGE ON <span class="sh_symbol">*.*</span> TO <span class="sh_string">'root'</span>@<span class="sh_string">'localhost'</span> WITH GRANT OPTION   <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> GRANT PROXY ON <span class="sh_string">''</span>@<span class="sh_string">''</span> TO <span class="sh_string">'root'</span>@<span class="sh_string">'localhost'</span> WITH GRANT OPTION <span class="sh_symbol">|</span></li><li><span class="sh_symbol">+--------------------------------------------------------------+</span></li><li><span class="sh_number">2</span> rows <span class="sh_keyword">in</span> <span class="sh_function">set</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt; REVOKE all ON *.* FROM root@localhost;
Query OK, 0 rows affected (0.00 sec)
mysql&gt; SHOW GRANTS FOR root@localhost;
+--------------------------------------------------------------+
| Grants for root@localhost                                    |
+--------------------------------------------------------------+
| GRANT USAGE ON *.* TO 'root'@'localhost' WITH GRANT OPTION   |
| GRANT PROXY ON ''@'' TO 'root'@'localhost' WITH GRANT OPTION |
+--------------------------------------------------------------+
2 rows in set (0.00 sec)
</pre></div></div>
      <p>验证撤销后的权限效果：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span> exit  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//退出当前MySQL连接</span></li><li>Bye</li><li><span class="sh_symbol">[</span>root@dbsvr1 <span class="sh_symbol">~]</span># mysql <span class="sh_symbol">-</span>u root <span class="sh_symbol">-</span>p  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//重新以root从本地登入</span></li><li>Enter password<span class="sh_symbol">:</span></li><li>Welcome to the MySQL monitor<span class="sh_symbol">.</span>  Commands end <span class="sh_keyword">with</span> <span class="sh_symbol">;</span> or <span class="sh_symbol">\</span>g<span class="sh_symbol">.</span></li><li>Your MySQL connection id is <span class="sh_number">6</span></li><li>Server version<span class="sh_symbol">:</span> <span class="sh_number">5.6.15</span> MySQL Community <span class="sh_function">Server</span> <span class="sh_symbol">(</span>GPL<span class="sh_symbol">)</span></li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_function">Copyright</span> <span class="sh_symbol">(</span>c<span class="sh_symbol">)</span> <span class="sh_number">2000</span><span class="sh_symbol">,</span> <span class="sh_number">2013</span><span class="sh_symbol">,</span> Oracle <span class="sh_normal">and</span><span class="sh_symbol">/</span>or its affiliates<span class="sh_symbol">.</span> All rights reserved<span class="sh_symbol">.</span></li><li><span style="display:none;">&nbsp;</span></li><li>Oracle is a registered trademark of Oracle Corporation <span class="sh_normal">and</span><span class="sh_symbol">/</span>or its</li><li>affiliates<span class="sh_symbol">.</span> Other names may be trademarks of their respective</li><li>owners<span class="sh_symbol">.</span></li><li><span style="display:none;">&nbsp;</span></li><li>Type <span class="sh_string">'help;'</span> or <span class="sh_string">'</span><span class="sh_specialchar">\h</span><span class="sh_string">'</span> <span class="sh_keyword">for</span> help<span class="sh_symbol">.</span> Type <span class="sh_string">'</span><span class="sh_specialchar">\c</span><span class="sh_string">'</span> to clear the current input statement<span class="sh_symbol">.</span></li><li><span style="display:none;">&nbsp;</span></li><li>mysql<span class="sh_symbol">&gt;</span> CREATE DATABASE newdb2014<span class="sh_symbol">;</span>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//尝试新建库失败</span></li><li>ERROR <span class="sh_number">1044</span> <span class="sh_symbol">(</span><span class="sh_number">42000</span><span class="sh_symbol">):</span> Access denied <span class="sh_keyword">for</span> user <span class="sh_string">'root'</span>@<span class="sh_string">'localhost'</span> to database <span class="sh_string">'newdb2014'</span></li><li>mysql<span class="sh_symbol">&gt;</span> DROP DATABASE rootdb<span class="sh_symbol">;</span>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//尝试删除库失败</span></li><li>ERROR <span class="sh_number">1044</span> <span class="sh_symbol">(</span><span class="sh_number">42000</span><span class="sh_symbol">):</span> Access denied <span class="sh_keyword">for</span> user <span class="sh_string">'root'</span>@<span class="sh_string">'localhost'</span> to database <span class="sh_string">'rootdb'</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt; exit  									//退出当前MySQL连接
Bye
[root@dbsvr1 ~]# mysql -u root -p  				//重新以root从本地登入
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 6
Server version: 5.6.15 MySQL Community Server (GPL)

Copyright (c) 2000, 2013, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt; CREATE DATABASE newdb2014;  				//尝试新建库失败
ERROR 1044 (42000): Access denied for user 'root'@'localhost' to database 'newdb2014'
mysql&gt; DROP DATABASE rootdb;  						//尝试删除库失败
ERROR 1044 (42000): Access denied for user 'root'@'localhost' to database 'rootdb'
</pre></div></div>
      <p>尝试以当前的root用户恢复权限，也会失败（无权更新授权表）：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span> GRANT all ON <span class="sh_symbol">*.*</span> TO root@localhost IDENTIFIED BY <span class="sh_string">'1234567'</span><span class="sh_symbol">;</span></li><li>ERROR <span class="sh_number">1045</span> <span class="sh_symbol">(</span><span class="sh_number">28000</span><span class="sh_symbol">):</span> Access denied <span class="sh_keyword">for</span> user <span class="sh_string">'root'</span>@<span class="sh_string">'localhost'</span> <span class="sh_symbol">(</span>using password<span class="sh_symbol">:</span> YES<span class="sh_symbol">)</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt; GRANT all ON *.* TO root@localhost IDENTIFIED BY '1234567';
ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: YES)
</pre></div></div>
      <p>怎么办呢？</p>
      <p>退出当前MySQL连接，以上一步添加的管理账号dba007登入：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span> exit  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//退出当前MySQL连接</span></li><li>Bye</li><li><span class="sh_symbol">[</span>root@dbsvr1 <span class="sh_symbol">~]</span># mysql <span class="sh_symbol">-</span>u dba007 <span class="sh_symbol">-</span>p   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//以另一个管理账号登入</span></li><li>Enter password<span class="sh_symbol">:</span></li><li>Welcome to the MySQL monitor<span class="sh_symbol">.</span>  Commands end <span class="sh_keyword">with</span> <span class="sh_symbol">;</span> or <span class="sh_symbol">\</span>g<span class="sh_symbol">.</span></li><li>Your MySQL connection id is <span class="sh_number">24</span></li><li>Server version<span class="sh_symbol">:</span> <span class="sh_number">5.7.17</span> MySQL Community <span class="sh_function">Server</span> <span class="sh_symbol">(</span>GPL<span class="sh_symbol">)</span></li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_function">Copyright</span> <span class="sh_symbol">(</span>c<span class="sh_symbol">)</span> <span class="sh_number">2000</span><span class="sh_symbol">,</span> <span class="sh_number">2016</span><span class="sh_symbol">,</span> Oracle <span class="sh_normal">and</span><span class="sh_symbol">/</span>or its affiliates<span class="sh_symbol">.</span> All rights reserved<span class="sh_symbol">.</span></li><li><span style="display:none;">&nbsp;</span></li><li>Oracle is a registered trademark of Oracle Corporation <span class="sh_normal">and</span><span class="sh_symbol">/</span>or its</li><li>affiliates<span class="sh_symbol">.</span> Other names may be trademarks of their respective</li><li>owners<span class="sh_symbol">.</span></li><li><span style="display:none;">&nbsp;</span></li><li>Type <span class="sh_string">'help;'</span> or <span class="sh_string">'</span><span class="sh_specialchar">\h</span><span class="sh_string">'</span> <span class="sh_keyword">for</span> help<span class="sh_symbol">.</span> Type <span class="sh_string">'</span><span class="sh_specialchar">\c</span><span class="sh_string">'</span> to clear the current input statement<span class="sh_symbol">.</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt; exit  										//退出当前MySQL连接
Bye
[root@dbsvr1 ~]# mysql -u dba007 -p   				//以另一个管理账号登入
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 24
Server version: 5.7.17 MySQL Community Server (GPL)

Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
</pre></div></div>
      <p>由管理账号dba007重新为root添加本地访问权限：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span> GRANT all ON <span class="sh_symbol">*.*</span> TO root@localhost IDENTIFIED BY <span class="sh_string">'1234567'</span><span class="sh_symbol">;</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">0</span> rows <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li><li>mysql<span class="sh_symbol">&gt;</span> SHOW GRANTS FOR root@localhost<span class="sh_symbol">;</span>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//查看恢复结果</span></li><li><span class="sh_symbol">+---------------------------------------------------------------------+</span></li><li><span class="sh_symbol">|</span> Grants <span class="sh_keyword">for</span> root@localhost                                           <span class="sh_symbol">|</span></li><li><span class="sh_symbol">+---------------------------------------------------------------------+</span></li><li><span class="sh_symbol">|</span> GRANT ALL PRIVILEGES ON <span class="sh_symbol">*.*</span> TO <span class="sh_string">'root'</span>@<span class="sh_string">'localhost'</span> WITH GRANT OPTION <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> GRANT PROXY ON <span class="sh_string">''</span>@<span class="sh_string">''</span> TO <span class="sh_string">'root'</span>@<span class="sh_string">'localhost'</span> WITH GRANT OPTION        <span class="sh_symbol">|</span></li><li><span class="sh_symbol">+---------------------------------------------------------------------+</span></li><li><span class="sh_number">2</span> rows <span class="sh_keyword">in</span> <span class="sh_function">set</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt; GRANT all ON *.* TO root@localhost IDENTIFIED BY '1234567';
Query OK, 0 rows affected (0.00 sec)
mysql&gt; SHOW GRANTS FOR root@localhost;  			//查看恢复结果
+---------------------------------------------------------------------+
| Grants for root@localhost                                           |
+---------------------------------------------------------------------+
| GRANT ALL PRIVILEGES ON *.* TO 'root'@'localhost' WITH GRANT OPTION |
| GRANT PROXY ON ''@'' TO 'root'@'localhost' WITH GRANT OPTION        |
+---------------------------------------------------------------------+
2 rows in set (0.00 sec)
</pre></div></div>
      <p>退出，再重新以root登入，测试一下看看，权限又恢复了吧：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span> exit  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//退出当前MySQL连接</span></li><li>Bye</li><li><span class="sh_symbol">[</span>root@dbsvr1 <span class="sh_symbol">~]</span># mysql <span class="sh_symbol">-</span>u root <span class="sh_symbol">-</span>p &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//重新以root登入</span></li><li>Enter password<span class="sh_symbol">:</span></li><li>Welcome to the MySQL monitor<span class="sh_symbol">.</span>  Commands end <span class="sh_keyword">with</span> <span class="sh_symbol">;</span> or <span class="sh_symbol">\</span>g<span class="sh_symbol">.</span></li><li>Your MySQL connection id is <span class="sh_number">25</span></li><li>Server version<span class="sh_symbol">:</span> <span class="sh_number">5.7.17</span> MySQL Community <span class="sh_function">Server</span> <span class="sh_symbol">(</span>GPL<span class="sh_symbol">)</span></li><li><span style="display:none;">&nbsp;</span></li><li><span class="sh_function">Copyright</span> <span class="sh_symbol">(</span>c<span class="sh_symbol">)</span> <span class="sh_number">2000</span><span class="sh_symbol">,</span> <span class="sh_number">2016</span><span class="sh_symbol">,</span> Oracle <span class="sh_normal">and</span><span class="sh_symbol">/</span>or its affiliates<span class="sh_symbol">.</span> All rights reserved<span class="sh_symbol">.</span></li><li><span style="display:none;">&nbsp;</span></li><li>Oracle is a registered trademark of Oracle Corporation <span class="sh_normal">and</span><span class="sh_symbol">/</span>or its</li><li>affiliates<span class="sh_symbol">.</span> Other names may be trademarks of their respective</li><li>owners<span class="sh_symbol">.</span></li><li><span style="display:none;">&nbsp;</span></li><li>Type <span class="sh_string">'help;'</span> or <span class="sh_string">'</span><span class="sh_specialchar">\h</span><span class="sh_string">'</span> <span class="sh_keyword">for</span> help<span class="sh_symbol">.</span> Type <span class="sh_string">'</span><span class="sh_specialchar">\c</span><span class="sh_string">'</span> to clear the current input statement<span class="sh_symbol">.</span></li><li><span style="display:none;">&nbsp;</span></li><li>mysql<span class="sh_symbol">&gt;</span> CREATE DATABASE newdb2014<span class="sh_symbol">;</span>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//成功创建新库</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">1</span> row <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt; exit  									//退出当前MySQL连接
Bye
[root@dbsvr1 ~]# mysql -u root -p 				//重新以root登入
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 25
Server version: 5.7.17 MySQL Community Server (GPL)

Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt; CREATE DATABASE newdb2014;  				//成功创建新库
Query OK, 1 row affected (0.00 sec)
</pre></div></div>
      <p>4）允许webuser从任意客户机登录，只对webdb库有完全权限，密码为 888888</p>
      <p>添加授权：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span> GRANT all ON webdb<span class="sh_symbol">.*</span> TO webuser@<span class="sh_string">'%'</span> IDENTIFIED BY <span class="sh_string">'888888'</span><span class="sh_symbol">;</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">0</span> rows <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt; GRANT all ON webdb.* TO webuser@'%' IDENTIFIED BY '888888';
Query OK, 0 rows affected (0.00 sec)
</pre></div></div>
      <p>查看授权结果：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span> SHOW GRANTS FOR webuser@<span class="sh_string">'%'</span><span class="sh_symbol">;</span></li><li><span class="sh_symbol">+----------------------------------------------------+</span></li><li><span class="sh_symbol">|</span> Grants <span class="sh_keyword">for</span> webuser@<span class="sh_symbol">%</span>                               <span class="sh_symbol">|</span></li><li><span class="sh_symbol">+----------------------------------------------------+</span></li><li><span class="sh_symbol">|</span> GRANT USAGE ON <span class="sh_symbol">*.*</span> TO <span class="sh_string">'webuser'</span>@<span class="sh_string">'%'</span>                <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> GRANT ALL PRIVILEGES ON `webdb`<span class="sh_symbol">.*</span> TO <span class="sh_string">'webuser'</span>@<span class="sh_string">'%'</span> <span class="sh_symbol">|</span></li><li><span class="sh_symbol">+----------------------------------------------------+</span></li><li><span class="sh_number">2</span> rows <span class="sh_keyword">in</span> <span class="sh_function">set</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt; SHOW GRANTS FOR webuser@'%';
+----------------------------------------------------+
| Grants for webuser@%                               |
+----------------------------------------------------+
| GRANT USAGE ON *.* TO 'webuser'@'%'                |
| GRANT ALL PRIVILEGES ON `webdb`.* TO 'webuser'@'%' |
+----------------------------------------------------+
2 rows in set (0.00 sec)
</pre></div></div>
      <p>5）撤销webuser的完全权限，改为查询权限</p>
      <p>撤销所有权限：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span> REVOKE all ON webdb<span class="sh_symbol">.*</span> FROM webuser@<span class="sh_string">'%'</span><span class="sh_symbol">;</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">0</span> rows <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt; REVOKE all ON webdb.* FROM webuser@'%';
Query OK, 0 rows affected (0.00 sec)
</pre></div></div>
      <p>只赋予查询权限：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span> GRANT select ON webdb<span class="sh_symbol">.*</span> TO webuser@<span class="sh_string">'%'</span><span class="sh_symbol">;</span></li><li>Query OK<span class="sh_symbol">,</span> <span class="sh_number">0</span> rows <span class="sh_function">affected</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt; GRANT select ON webdb.* TO webuser@'%';
Query OK, 0 rows affected (0.00 sec)
</pre></div></div>
      <p>确认授权更改结果：</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/DBA1/DAY04/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li>mysql<span class="sh_symbol">&gt;</span> SHOW GRANTS FOR webuser@<span class="sh_string">'%'</span><span class="sh_symbol">;</span></li><li><span class="sh_symbol">+--------------------------------------------+</span></li><li><span class="sh_symbol">|</span> Grants <span class="sh_keyword">for</span> webuser@<span class="sh_symbol">%</span>                       <span class="sh_symbol">|</span></li><li><span class="sh_symbol">+--------------------------------------------+</span></li><li><span class="sh_symbol">|</span> GRANT USAGE ON <span class="sh_symbol">*.*</span> TO <span class="sh_string">'webuser'</span>@<span class="sh_string">'%'</span>        <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> GRANT SELECT ON `webdb`<span class="sh_symbol">.*</span> TO <span class="sh_string">'webuser'</span>@<span class="sh_string">'%'</span> <span class="sh_symbol">|</span></li><li><span class="sh_symbol">+--------------------------------------------+</span></li><li><span class="sh_number">2</span> rows <span class="sh_keyword">in</span> <span class="sh_function">set</span> <span class="sh_symbol">(</span><span class="sh_number">0.00</span> sec<span class="sh_symbol">)</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">mysql&gt; SHOW GRANTS FOR webuser@'%';
+--------------------------------------------+
| Grants for webuser@%                       |
+--------------------------------------------+
| GRANT USAGE ON *.* TO 'webuser'@'%'        |
| GRANT SELECT ON `webdb`.* TO 'webuser'@'%' |
+--------------------------------------------+
2 rows in set (0.00 sec)
</pre></div></div>
    </div>
  
</body></html>