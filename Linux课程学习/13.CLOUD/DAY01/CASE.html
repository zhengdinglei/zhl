
<!-- saved from url=(0076)http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>CASE</title>
    
    <script type="text/javascript" src="./CASE_files/jquery.min.js">
    </script>
    <script type="text/javascript" src="./CASE_files/jquery.snippet.js">
    </script>
    <script type="text/javascript" src="./CASE_files/main.js">
    </script>
    <link type="text/css" href="./CASE_files/index.css" rel="Stylesheet">
    <link type="text/css" href="./CASE_files/jquery.snippet.css" rel="Stylesheet">
  </head>
  <body>
    <div class="source_style_case">
      <a name="page_top_case" id="top_anchor">
      </a><a id="link_top" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#page_top_case">Top</a>
      <h1>NSD CLOUD DAY01</h1>
      <ol class="index">
        <li>
          <a href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#case1">案例1：virsh基本管理操作</a>
        </li>
        <li>
          <a href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#case2">案例2：qemu-img基本操作管理</a>
        </li>
        <li>
          <a href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#case3">案例3：创建一个虚拟网络</a>
        </li>
        <li>
          <a href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#case4">案例4：xml管理</a>
        </li>
        <li>
          <a href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#case5">案例5：安装虚拟机</a>
        </li>
        <li>
          <a href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#case6">案例6：离线访问虚拟机问题</a>
        </li>
      </ol>
      <a name="case1">
      </a>
      <h2>1 案例1：virsh基本管理操作</h2>
      <h3>1.1 问题</h3>
      <p>本案例要求熟悉virsh的基本操作，可以熟练运用：</p>
      <ul class="list">
        <li>列出当前正在运行的虚拟机
</li>
        <li>查看虚拟机的信息
</li>
        <li>管理虚拟机
</li>
        <li>设置虚拟机开机自动运行
</li>
      </ul>
      <h3>1.2 步骤</h3>
      <p>实现此案例需要按照如下步骤进行。</p>
      <p class="number">步骤一：virsh基本操作</p>
      <p>1）列出当前正在运行的虚拟机</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li> <span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># virsh list </li><li> Id    Name                           State</li><li><span class="sh_symbol">----------------------------------------------------</span></li><li> <span class="sh_number">1</span>     node1                          running</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;"> [root@room9pc01 ~]# virsh list 
 Id    Name                           State
----------------------------------------------------
 1     node1                          running
</pre></div></div>
      <p>2）查看虚拟机的信息</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># virsh dominfo node1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//查看node1的信息</span></li><li>Id<span class="sh_symbol">:</span>             <span class="sh_number">1</span></li><li>Name<span class="sh_symbol">:</span>           node1</li><li>UUID<span class="sh_symbol">:</span>           20e15d2f<span class="sh_symbol">-</span>ea30<span class="sh_symbol">-</span>4aa3<span class="sh_symbol">-</span>96dc<span class="sh_symbol">-</span>91aab6283b10</li><li>OS Type<span class="sh_symbol">:</span>        hvm</li><li>State<span class="sh_symbol">:</span>          running</li><li><span class="sh_function">CPU</span><span class="sh_symbol">(</span>s<span class="sh_symbol">):</span>         <span class="sh_number">2</span></li><li>CPU time<span class="sh_symbol">:</span>       <span class="sh_number">92</span><span class="sh_symbol">.</span>8s</li><li>Max memory<span class="sh_symbol">:</span>     <span class="sh_number">2048000</span> KiB</li><li>Used memory<span class="sh_symbol">:</span>    <span class="sh_number">2048000</span> KiB</li><li>Persistent<span class="sh_symbol">:</span>     yes</li><li>Autostart<span class="sh_symbol">:</span>      disable</li><li>Managed save<span class="sh_symbol">:</span>   no</li><li>Security model<span class="sh_symbol">:</span> none</li><li>Security DOI<span class="sh_symbol">:</span>   <span class="sh_number">0</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@room9pc01 ~]# virsh dominfo node1					//查看node1的信息
Id:             1
Name:           node1
UUID:           20e15d2f-ea30-4aa3-96dc-91aab6283b10
OS Type:        hvm
State:          running
CPU(s):         2
CPU time:       92.8s
Max memory:     2048000 KiB
Used memory:    2048000 KiB
Persistent:     yes
Autostart:      disable
Managed save:   no
Security model: none
Security DOI:   0
</pre></div></div>
      <p class="number">步骤二：管理虚拟机</p>
      <p>1）启动虚拟机</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># virsh start node1</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@room9pc01 ~]# virsh start node1
</pre></div></div>
      <p>2）重启虚拟机</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># virsh reboot node1</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@room9pc01 ~]# virsh reboot node1
</pre></div></div>
      <p>3）强制关闭虚拟机</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># virsh destroy node1</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@room9pc01 ~]# virsh destroy node1
</pre></div></div>
      <p>4）设置虚拟机开机自动运行</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># virsh autostart node1</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@room9pc01 ~]# virsh autostart node1
</pre></div></div>
      <a name="case2">
      </a>
      <h2>2 案例2：qemu-img基本操作管理</h2>
      <h3>2.1 问题</h3>
      <p>本案例要求：</p>
      <ul class="list">
        <li>创建一个新的镜像盘文件
</li>
        <li>使用后端模板文件创建一个新的镜像盘文件
</li>
        <li>查看镜像盘文件的信息
</li>
      </ul>
      <h3>2.2 步骤</h3>
      <p>实现此案例需要按照如下步骤进行。</p>
      <p class="number">步骤一：创建一个新的镜像盘文件</p>
      <p>qemu-img命令格式：qemu-img  命令  参数   块文件名称   大小</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># qemu<span class="sh_symbol">-</span>img create   <span class="sh_symbol">-</span>f qcow2 disk<span class="sh_symbol">.</span>img 50G    <span class="sh_comment">//qcow2为创建的格式</span></li><li>Formatting <span class="sh_string">'disk.img'</span><span class="sh_symbol">,</span> fmt<span class="sh_symbol">=</span>qcow2 size<span class="sh_symbol">=</span><span class="sh_number">53687091200</span> encryption<span class="sh_symbol">=</span>off cluster_size<span class="sh_symbol">=</span><span class="sh_number">65536</span> lazy_refcounts<span class="sh_symbol">=</span>off</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@room9pc01 ~]# qemu-img create   -f qcow2 disk.img 50G    //qcow2为创建的格式
Formatting 'disk.img', fmt=qcow2 size=53687091200 encryption=off cluster_size=65536 lazy_refcounts=off
</pre></div></div>
      <p>2）使用后端模板文件创建一个新的镜像盘文件</p>
      <p>备注：-b使用后端模板文件</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># qemu<span class="sh_symbol">-</span>img create <span class="sh_symbol">-</span>b disk<span class="sh_symbol">.</span>img <span class="sh_symbol">-</span>f qcow2 disk1<span class="sh_symbol">.</span>img</li><li>Formatting <span class="sh_string">'disk1.img'</span><span class="sh_symbol">,</span> fmt<span class="sh_symbol">=</span>qcow2 size<span class="sh_symbol">=</span><span class="sh_number">53687091200</span> backing_file<span class="sh_symbol">=</span><span class="sh_string">'disk.img'</span> encryption<span class="sh_symbol">=</span>off cluster_size<span class="sh_symbol">=</span><span class="sh_number">65536</span> lazy_refcounts<span class="sh_symbol">=</span>off</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@room9pc01 ~]# qemu-img create -b disk.img -f qcow2 disk1.img
Formatting 'disk1.img', fmt=qcow2 size=53687091200 backing_file='disk.img' encryption=off cluster_size=65536 lazy_refcounts=off
</pre></div></div>
      <p>3）使用后端模板文件创建一个16G的镜像盘文件</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li> <span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># qemu<span class="sh_symbol">-</span>img create <span class="sh_symbol">-</span>b disk<span class="sh_symbol">.</span>img <span class="sh_symbol">-</span>f qcow2 disk2<span class="sh_symbol">.</span>img  16G</li><li>Formatting <span class="sh_string">'disk1.img'</span><span class="sh_symbol">,</span> fmt<span class="sh_symbol">=</span>qcow2 size<span class="sh_symbol">=</span><span class="sh_number">53687091200</span> backing_file<span class="sh_symbol">=</span><span class="sh_string">'disk.img'</span> encryption<span class="sh_symbol">=</span>off cluster_size<span class="sh_symbol">=</span><span class="sh_number">65536</span> lazy_refcounts<span class="sh_symbol">=</span>off</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;"> [root@room9pc01 ~]# qemu-img create -b disk.img -f qcow2 disk2.img  16G
Formatting 'disk1.img', fmt=qcow2 size=53687091200 backing_file='disk.img' encryption=off cluster_size=65536 lazy_refcounts=off

</pre></div></div>
      <p class="number">步骤二：查看镜像文件的信息</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># qemu<span class="sh_symbol">-</span>img  info disk1<span class="sh_symbol">.</span>img </li><li>image<span class="sh_symbol">:</span> disk<span class="sh_symbol">.</span>img</li><li>file format<span class="sh_symbol">:</span> qcow2</li><li>virtual size<span class="sh_symbol">:</span> 50<span class="sh_function">G</span> <span class="sh_symbol">(</span><span class="sh_number">53687091200</span> bytes<span class="sh_symbol">)</span></li><li>disk size<span class="sh_symbol">:</span> 196K</li><li>cluster_size<span class="sh_symbol">:</span> <span class="sh_number">65536</span></li><li>Format specific information<span class="sh_symbol">:</span></li><li>    compat<span class="sh_symbol">:</span> <span class="sh_number">1.1</span></li><li>    lazy refcounts<span class="sh_symbol">:</span> <span class="sh_keyword">false</span> <span class="sh_symbol">|</span> help_topic   <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> innodb_index_stats        <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> innodb_table_stats        <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> ndb_binlog_index          <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> plugin                     <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> proc                       <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> procs_priv                 <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> proxies_priv               <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> server_cost                <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> servers                    <span class="sh_symbol">|</span></li><li><span class="sh_symbol">|</span> slave_master_info         <span class="sh_symbol">|</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@room9pc01 ~]# qemu-img  info disk1.img 
image: disk.img
file format: qcow2
virtual size: 50G (53687091200 bytes)
disk size: 196K
cluster_size: 65536
Format specific information:
    compat: 1.1
    lazy refcounts: false | help_topic   |
| innodb_index_stats        |
| innodb_table_stats        |
| ndb_binlog_index          |
| plugin                     |
| proc                       |
| procs_priv                 |
| proxies_priv               |
| server_cost                |
| servers                    |
| slave_master_info         |
</pre></div></div>
      <a name="case3">
      </a>
      <h2>3 案例3：创建一个虚拟网络</h2>
      <h3>3.1 问题</h3>
      <p>创建一个虚拟网络，为之后的自定义安装虚拟机做准备：</p>
      <ul class="list">
        <li>创建一个名为vbr的虚拟网络
</li>
        <li>设置vbr的ip为192.168.1.254
</li>
        <li>配置vbr虚拟网络的dhcp分配地址范围100-200
</li>
        <li>启动vbr虚拟网络并用ifconfig验证
</li>
        <li>设置vbr虚拟网络开机自启动
</li>
      </ul>
      <h3>3.2 步骤</h3>
      <p>实现此案例需要按照如下步骤进行。</p>
      <p class="number">步骤一：创建一个名为vbr的虚拟网络</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># <span class="sh_normal">vim  </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span><span class="sh_normal">libvirt</span><span class="sh_symbol">/</span><span class="sh_normal">qemu</span><span class="sh_symbol">/</span><span class="sh_normal">networks</span><span class="sh_symbol">/</span>vbr<span class="sh_symbol">.</span>xml</li><li><span class="sh_symbol">&lt;</span>network<span class="sh_symbol">&gt;</span></li><li>  <span class="sh_symbol">&lt;</span>name<span class="sh_symbol">&gt;</span>vbr<span class="sh_symbol">&lt;</span><span class="sh_regexp">/name&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/</span><span class="sh_symbol">/</span>vbr为虚拟网络的名字</li><li>  <span class="sh_symbol">&lt;</span>bridge name<span class="sh_symbol">=</span><span class="sh_string">"vbr"</span><span class="sh_symbol">/&gt;</span></li><li>  <span class="sh_symbol">&lt;</span>forward mode<span class="sh_symbol">=</span><span class="sh_string">"nat"</span><span class="sh_symbol">/&gt;</span></li><li>  <span class="sh_symbol">&lt;</span>ip address<span class="sh_symbol">=</span><span class="sh_string">"192.168.1.254"</span> netmask<span class="sh_symbol">=</span><span class="sh_string">"255.255.255.0"</span><span class="sh_symbol">&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//ip为192.168.1.254</span></li><li>    <span class="sh_symbol">&lt;</span>dhcp<span class="sh_symbol">&gt;</span></li><li>      <span class="sh_symbol">&lt;</span>range start<span class="sh_symbol">=</span><span class="sh_string">"192.168.1.100"</span> end<span class="sh_symbol">=</span><span class="sh_string">"192.168.1.200"</span><span class="sh_regexp">/&gt;     /</span><span class="sh_symbol">/</span>ip范围是<span class="sh_number">100-200</span></li><li>    <span class="sh_symbol">&lt;/</span>dhcp<span class="sh_symbol">&gt;</span></li><li>  <span class="sh_symbol">&lt;/</span>ip<span class="sh_symbol">&gt;</span></li><li><span class="sh_symbol">&lt;/</span>network<span class="sh_symbol">&gt;</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@room9pc01 ~]# vim  /etc/libvirt/qemu/networks/vbr.xml
&lt;network&gt;
  &lt;name&gt;vbr&lt;/name&gt;				//vbr为虚拟网络的名字
  &lt;bridge name="vbr"/&gt;
  &lt;forward mode="nat"/&gt;
  &lt;ip address="192.168.1.254" netmask="255.255.255.0"&gt;		//ip为192.168.1.254
    &lt;dhcp&gt;
      &lt;range start="192.168.1.100" end="192.168.1.200"/&gt;     //ip范围是100-200
    &lt;/dhcp&gt;
  &lt;/ip&gt;
&lt;/network&gt;
</pre></div></div>
      <p class="number">步骤二：启动vbr虚拟网络并用ifconfig验证</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># virsh net<span class="sh_symbol">-</span>define vbr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//定义vbr虚拟网络</span></li><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># virsh net<span class="sh_symbol">-</span>start vbr      <span class="sh_comment">//启动vbr虚拟网络</span></li><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># ifconfig&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//igconfig验证 </span></li><li>vbr<span class="sh_symbol">:</span> flags<span class="sh_symbol">=</span><span class="sh_number">4163</span><span class="sh_symbol">&lt;</span>UP<span class="sh_symbol">,</span>BROADCAST<span class="sh_symbol">,</span>RUNNING<span class="sh_symbol">,</span>MULTICAST<span class="sh_symbol">&gt;</span>  mtu <span class="sh_number">1500</span></li><li>        inet <span class="sh_number">192.168.1.254</span>  netmask <span class="sh_number">255.255.255.0</span>  broadcast <span class="sh_number">192.168.1.255</span></li><li>        ether <span class="sh_number">52</span><span class="sh_symbol">:</span><span class="sh_number">54</span><span class="sh_symbol">:</span><span class="sh_number">00</span><span class="sh_symbol">:</span>b7<span class="sh_symbol">:</span>1c<span class="sh_symbol">:</span><span class="sh_number">10</span>  txqueuelen <span class="sh_number">1000</span>  <span class="sh_symbol">(</span>Ethernet<span class="sh_symbol">)</span></li><li>        RX packets <span class="sh_number">2460</span>  bytes <span class="sh_number">176958</span> <span class="sh_symbol">(</span><span class="sh_number">172.8</span> KiB<span class="sh_symbol">)</span></li><li>        RX errors <span class="sh_number">0</span>  dropped <span class="sh_number">0</span>  overruns <span class="sh_number">0</span>  frame <span class="sh_number">0</span></li><li>        TX packets <span class="sh_number">1948</span>  bytes <span class="sh_number">532542</span> <span class="sh_symbol">(</span><span class="sh_number">520.0</span> KiB<span class="sh_symbol">)</span></li><li>        TX errors <span class="sh_number">0</span>  dropped <span class="sh_number">0</span> overruns <span class="sh_number">0</span>  carrier <span class="sh_number">0</span>  collisions <span class="sh_number">0</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@room9pc01 ~]# virsh net-define vbr		//定义vbr虚拟网络
[root@room9pc01 ~]# virsh net-start vbr      //启动vbr虚拟网络
[root@room9pc01 ~]# ifconfig				//igconfig验证 
vbr: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
        inet 192.168.1.254  netmask 255.255.255.0  broadcast 192.168.1.255
        ether 52:54:00:b7:1c:10  txqueuelen 1000  (Ethernet)
        RX packets 2460  bytes 176958 (172.8 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 1948  bytes 532542 (520.0 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</pre></div></div>
      <p class="number">步骤三：设置vbr虚拟网络开机自启动</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># virsh net<span class="sh_symbol">-</span>autostart vbr</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@room9pc01 ~]# virsh net-autostart vbr
</pre></div></div>
      <a name="case4">
      </a>
      <h2>4 案例4：xml管理</h2>
      <h3>4.1 问题</h3>
      <p>熟悉xml文件，并对虚拟机的配置进行调整：</p>
      <ul class="list">
        <li>导出一个虚拟机的xml配置文件
</li>
        <li>编辑xml文件
</li>
        <li>重新定义虚拟机
</li>
        <li>删除此虚拟机
</li>
      </ul>
      <h3>4.2 步骤</h3>
      <p>实现此案例需要按照如下步骤进行。</p>
      <p class="number">步骤一：导出虚拟机xml的配置文件</p>
      <p>1）查看xml配置文件</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># <span class="sh_normal">cd </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span><span class="sh_normal">libvirt</span><span class="sh_symbol">/</span><span class="sh_normal">qemu</span><span class="sh_symbol">/</span></li><li><span class="sh_symbol">[</span>root@room9pc01 qemu<span class="sh_symbol">]</span># virsh  dumpxml  node1</li><li><span class="sh_symbol">[</span>root@room9pc01 qemu<span class="sh_symbol">]</span># virsh  dumpxml  node1 <span class="sh_symbol">&gt;</span> node<span class="sh_symbol">.</span>xml     </li><li><span class="sh_comment">//导出虚拟机node1的配置文件为node.xml</span></li><li><span class="sh_symbol">[</span>root@room9pc01 qemu<span class="sh_symbol">]</span># ls</li><li>node<span class="sh_symbol">.</span>xml</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@room9pc01 ~]# cd /etc/libvirt/qemu/
[root@room9pc01 qemu]# virsh  dumpxml  node1
[root@room9pc01 qemu]# virsh  dumpxml  node1 &gt; node.xml     
//导出虚拟机node1的配置文件为node.xml
[root@room9pc01 qemu]# ls
node.xml
</pre></div></div>
      <p>virsh命令： virsh edit 虚拟机名</p>
      <p>备注：可以修改name，memory，disk、network等字段</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@room9pc01 qemu<span class="sh_symbol">]</span># virsh edit node1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li><span class="sh_symbol">&lt;</span>domain type<span class="sh_symbol">=</span><span class="sh_string">'kvm'</span><span class="sh_symbol">&gt;</span></li><li>  <span class="sh_symbol">&lt;</span>name<span class="sh_symbol">&gt;</span>node1<span class="sh_symbol">&lt;</span><span class="sh_regexp">/name&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/</span><span class="sh_symbol">/</span>node1为虚拟机的名称，可以随意修改</li><li>  <span class="sh_symbol">&lt;</span>uuid<span class="sh_symbol">&gt;</span>76d5dc2c<span class="sh_symbol">-</span>5eef<span class="sh_number">-4e30</span><span class="sh_symbol">-</span>8b6c<span class="sh_symbol">-</span>e58851814f84<span class="sh_symbol">&lt;</span><span class="sh_regexp">/uuid&gt;  /</span><span class="sh_symbol">/</span>uuid可以去掉</li><li>  <span class="sh_symbol">&lt;</span>memory unit<span class="sh_symbol">=</span><span class="sh_string">'KiB'</span><span class="sh_symbol">&gt;</span><span class="sh_number">2048000</span><span class="sh_symbol">&lt;</span><span class="sh_regexp">/memory&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/</span><span class="sh_symbol">/</span>内存大小可以调整</li><li>  <span class="sh_symbol">&lt;</span>currentMemory unit<span class="sh_symbol">=</span><span class="sh_string">'KiB'</span><span class="sh_symbol">&gt;</span><span class="sh_number">2048000</span><span class="sh_symbol">&lt;/</span>currentMemory<span class="sh_symbol">&gt;</span></li><li>  <span class="sh_symbol">&lt;</span>disk type<span class="sh_symbol">=</span><span class="sh_string">'file'</span> device<span class="sh_symbol">=</span><span class="sh_string">'disk'</span><span class="sh_symbol">&gt;</span></li><li>      <span class="sh_symbol">&lt;</span>source file<span class="sh_symbol">=</span><span class="sh_string">'/var/lib/libvirt/images/rhel7.2.qcow2'</span><span class="sh_regexp">/&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/</span><span class="sh_symbol">/</span>后端盘路径</li><li>   <span class="sh_symbol">..</span> <span class="sh_symbol">..</span></li><li>  <span class="sh_symbol">&lt;</span><span class="sh_keyword">interface</span> type<span class="sh_symbol">=</span><span class="sh_string">'network'</span><span class="sh_symbol">&gt;</span></li><li>      <span class="sh_symbol">&lt;</span>mac address<span class="sh_symbol">=</span><span class="sh_string">'52:54:00:91:52:e4'</span><span class="sh_symbol">/&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li><span class="sh_comment">//mac地址和带有address字样的全部去掉</span></li><li>   <span class="sh_symbol">..</span> <span class="sh_symbol">..</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@room9pc01 qemu]# virsh edit node1			
&lt;domain type='kvm'&gt;
  &lt;name&gt;node1&lt;/name&gt;						//node1为虚拟机的名称，可以随意修改
  &lt;uuid&gt;76d5dc2c-5eef-4e30-8b6c-e58851814f84&lt;/uuid&gt;  //uuid可以去掉
  &lt;memory unit='KiB'&gt;2048000&lt;/memory&gt;				//内存大小可以调整
  &lt;currentMemory unit='KiB'&gt;2048000&lt;/currentMemory&gt;
  &lt;disk type='file' device='disk'&gt;
      &lt;source file='/var/lib/libvirt/images/rhel7.2.qcow2'/&gt;		//后端盘路径
   .. ..
  &lt;interface type='network'&gt;
      &lt;mac address='52:54:00:91:52:e4'/&gt;			
//mac地址和带有address字样的全部去掉
   .. ..
</pre></div></div>
      <p class="number">步骤二：重新定义虚拟机</p>
      <p>1）重新定义虚拟机</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@room9pc01 qemu<span class="sh_symbol">]</span># virsh define node1<span class="sh_symbol">.</span>xml</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@room9pc01 qemu]# virsh define node1.xml
</pre></div></div>
      <p>2）取消定义的虚拟机</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@room9pc01 qemu<span class="sh_symbol">]</span># virsh undefine node1</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@room9pc01 qemu]# virsh undefine node1
</pre></div></div>
      <a name="case5">
      </a>
      <h2>5 案例5：安装虚拟机</h2>
      <h3>5.1 问题</h3>
      <p>本案例要求可以成功安装一个自定义虚拟机：</p>
      <ul class="list">
        <li>配置一个网络yum，并安装一个虚拟机
</li>
        <li>制作一个虚拟机模板，包括配置yum，网卡等
</li>
        <li>
</li>
      </ul>
      <h3>5.2 步骤</h3>
      <p>实现此案例需要按照如下步骤进行。</p>
      <p class="number">步骤一：配置网络yum源</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># yum <span class="sh_symbol">-</span>y install vsftpd</li><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># <span class="sh_normal">vim </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span><span class="sh_normal">vsftpd</span><span class="sh_symbol">/</span>vsftpd<span class="sh_symbol">.</span>conf </li><li>listen<span class="sh_symbol">=</span>YES</li><li>listen_ipv6<span class="sh_symbol">=</span>NO</li><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># systemctl restart vsftpd</li><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># <span class="sh_normal">mkdir </span><span class="sh_symbol">/</span><span class="sh_keyword">var</span><span class="sh_regexp">/ftp/</span>centos</li><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># <span class="sh_normal">mount </span><span class="sh_symbol">/</span><span class="sh_normal">iso</span><span class="sh_symbol">/</span>CentOS<span class="sh_number">-7</span><span class="sh_symbol">-</span>x86_64<span class="sh_symbol">-</span>DVD<span class="sh_number">-1708</span><span class="sh_symbol">.</span><span class="sh_normal">iso  </span><span class="sh_symbol">/</span><span class="sh_keyword">var</span><span class="sh_regexp">/ftp/</span><span class="sh_normal">centos</span><span class="sh_symbol">/</span></li><li>mount<span class="sh_symbol">:</span> <span class="sh_regexp">/dev/</span>loop1 写保护，将以只读方式挂载</li><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># <span class="sh_normal">vim </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span>yum<span class="sh_symbol">.</span>repos<span class="sh_symbol">.</span><span class="sh_normal">d</span><span class="sh_symbol">/</span>dvd<span class="sh_symbol">.</span>repo</li><li><span class="sh_symbol">[</span>dvd<span class="sh_symbol">]</span></li><li>name<span class="sh_symbol">=</span>dvd</li><li>baseurl<span class="sh_symbol">=</span>ftp<span class="sh_symbol">:</span><span class="sh_comment">//192.168.1.254/centos</span></li><li>enabled<span class="sh_symbol">=</span><span class="sh_number">1</span></li><li>gpgcheck<span class="sh_symbol">=</span><span class="sh_number">0</span></li><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># yum clean all</li><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># yum repolist</li><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># <span class="sh_normal">cd </span><span class="sh_symbol">/</span><span class="sh_keyword">var</span><span class="sh_regexp">/lib/</span><span class="sh_normal">libvirt</span><span class="sh_symbol">/</span><span class="sh_normal">images</span><span class="sh_symbol">/</span></li><li><span class="sh_symbol">[</span>root@room9pc01 images<span class="sh_symbol">]</span># qemu<span class="sh_symbol">-</span>img create <span class="sh_symbol">-</span>f qcow2 node<span class="sh_symbol">.</span>qcow2 16G</li><li>Formatting <span class="sh_string">'node.qcow2'</span><span class="sh_symbol">,</span>fmt<span class="sh_symbol">=</span>qcow2 size<span class="sh_symbol">=</span><span class="sh_number">17179869184</span> encryption<span class="sh_symbol">=</span>off cluster_size<span class="sh_symbol">=</span><span class="sh_number">65536</span> lazy_refcounts<span class="sh_symbol">=</span>off </li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@room9pc01 ~]# yum -y install vsftpd
[root@room9pc01 ~]# vim /etc/vsftpd/vsftpd.conf 
listen=YES
listen_ipv6=NO
[root@room9pc01 ~]# systemctl restart vsftpd
[root@room9pc01 ~]# mkdir /var/ftp/centos
[root@room9pc01 ~]# mount /iso/CentOS-7-x86_64-DVD-1708.iso  /var/ftp/centos/
mount: /dev/loop1 写保护，将以只读方式挂载
[root@room9pc01 ~]# vim /etc/yum.repos.d/dvd.repo
[dvd]
name=dvd
baseurl=ftp://192.168.1.254/centos
enabled=1
gpgcheck=0
[root@room9pc01 ~]# yum clean all
[root@room9pc01 ~]# yum repolist
[root@room9pc01 ~]# cd /var/lib/libvirt/images/
[root@room9pc01 images]# qemu-img create -f qcow2 node.qcow2 16G
Formatting 'node.qcow2',fmt=qcow2 size=17179869184 encryption=off cluster_size=65536 lazy_refcounts=off 
</pre></div></div>
      <p class="number">步骤二：安装一个虚拟机</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@room9pc01 images<span class="sh_symbol">]</span># virt<span class="sh_symbol">-</span>manager&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sh_comment">//真机操作，启动virt-manager</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@room9pc01 images]# virt-manager		//真机操作，启动virt-manager
</pre></div></div>
      <p>使用virt-manager软件选择新建虚拟机如图-1所示：</p>
      <div class="image">
        <img src="./CASE_files/image001.png">
        <p>图-1</p>
      </div>
      <p>选择安装方式如图-2所示：</p>
      <div class="image">
        <img src="./CASE_files/image002.png">
        <p>图-2</p>
      </div>
      <p>选择内存，cpu和自定义存储如图-3所示：</p>
      <div class="image">
        <img src="./CASE_files/image003.png">
        <p>图-3</p>
      </div>
      <p>选择虚拟机名称和网络如图-4所示：</p>
      <div class="image">
        <img src="./CASE_files/image004.png">
        <p>图-4</p>
        <p>
        </p>
      </div>
      <p>选择分区和KDUMP如图-5所示：</p>
      <div class="image">
        <img src="./CASE_files/image005.png">
        <p>图-5</p>
      </div>
      <p>选择创建分区如图-6所示：</p>
      <div class="image">
        <img src="./CASE_files/image006.png">
        <p>图-6</p>
        <p>
        </p>
      </div>
      <p>选择standard Partition如图-7所示：</p><p>图-7</p><p></p>
      <p>创建一个根分区如图-8所示：</p>
      <div class="image">
        <img src="./CASE_files/image007.png">
        <p>图-8</p>
      </div>
      <p class="number">步骤三：制作一个虚拟机模板</p>
      <p>1）禁用selinux</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@localhost <span class="sh_symbol">~]</span># <span class="sh_normal">vim </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span><span class="sh_normal">selinux</span><span class="sh_symbol">/</span>config</li><li>SELINUX<span class="sh_symbol">=</span>disabled</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@localhost ~]# vim /etc/selinux/config
SELINUX=disabled
</pre></div></div>
      <p>2）卸载防火墙与NetworkManager</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@localhost <span class="sh_symbol">~]</span># yum <span class="sh_symbol">-</span>y remove NetworkManager<span class="sh_symbol">-*</span> firewalld<span class="sh_symbol">-*</span> python<span class="sh_symbol">-</span>firewall</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@localhost ~]# yum -y remove NetworkManager-* firewalld-* python-firewall
</pre></div></div>
      <p>3）配置yum源</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@localhost <span class="sh_symbol">~]</span># <span class="sh_normal">vim </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span>yum<span class="sh_symbol">.</span>repos<span class="sh_symbol">.</span><span class="sh_normal">d</span><span class="sh_symbol">/</span>dvd<span class="sh_symbol">.</span>repo</li><li><span class="sh_symbol">[</span>dvd<span class="sh_symbol">]</span></li><li>name<span class="sh_symbol">=</span>dvd</li><li>baseurl<span class="sh_symbol">=</span>ftp<span class="sh_symbol">:</span><span class="sh_comment">//192.168.1.254/centos</span></li><li>enabled<span class="sh_symbol">=</span><span class="sh_number">1</span></li><li>gpgcheck<span class="sh_symbol">=</span><span class="sh_number">0</span></li><li><span class="sh_symbol">[</span>root@localhost <span class="sh_symbol">~]</span># yum clean all</li><li><span class="sh_symbol">[</span>root@localhost <span class="sh_symbol">~]</span># yum repolist</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@localhost ~]# vim /etc/yum.repos.d/dvd.repo
[dvd]
name=dvd
baseurl=ftp://192.168.1.254/centos
enabled=1
gpgcheck=0
[root@localhost ~]# yum clean all
[root@localhost ~]# yum repolist
</pre></div></div>
      <p>4）导入公钥</p>
      <p>注意：把/etc/yum.repos.d/dvd.repo的gpgcheck=0改成gpgcheck=1</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@localhost <span class="sh_symbol">~]</span># lftp <span class="sh_number">192.168.1.254</span></li><li>lftp <span class="sh_number">192.168.4.254</span><span class="sh_symbol">:~&gt;</span> cd centos</li><li>lftp <span class="sh_number">192.168.4.254</span><span class="sh_symbol">:/</span>centos<span class="sh_symbol">&gt;</span> get RPM<span class="sh_symbol">-</span>GPG<span class="sh_symbol">-</span>KEY<span class="sh_symbol">-</span>CentOs<span class="sh_number">-7</span></li><li>lftp <span class="sh_number">192.168.4.254</span><span class="sh_symbol">:/</span>centos<span class="sh_symbol">&gt;</span> exit</li><li><span class="sh_symbol">[</span>root@localhost <span class="sh_symbol">~]</span># rpm <span class="sh_symbol">--</span>import RPM<span class="sh_symbol">-</span>GPG<span class="sh_symbol">-</span>KEY<span class="sh_symbol">-</span>CentOs<span class="sh_number">-7</span></li><li><span class="sh_symbol">[</span>root@localhost <span class="sh_symbol">~]</span># yum <span class="sh_symbol">-</span>y install net<span class="sh_symbol">-</span>tools vim<span class="sh_symbol">-</span>enhanced bridge<span class="sh_symbol">-</span>utils psmisc</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@localhost ~]# lftp 192.168.1.254
lftp 192.168.4.254:~&gt; cd centos
lftp 192.168.4.254:/centos&gt; get RPM-GPG-KEY-CentOs-7
lftp 192.168.4.254:/centos&gt; exit
[root@localhost ~]# rpm --import RPM-GPG-KEY-CentOs-7
[root@localhost ~]# yum -y install net-tools vim-enhanced bridge-utils psmisc
</pre></div></div>
      <p>5）配置网卡</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@localhost <span class="sh_symbol">~]</span># <span class="sh_normal">vim </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span><span class="sh_normal">sysconfig</span><span class="sh_symbol">/</span>network<span class="sh_symbol">-</span><span class="sh_normal">scripts</span><span class="sh_symbol">/</span>ifcfg<span class="sh_symbol">-</span>eth0</li><li>DEVICE<span class="sh_symbol">=</span><span class="sh_string">"eth0"</span></li><li>ONBOOT<span class="sh_symbol">=</span><span class="sh_string">"yes"</span></li><li>IPV6INIT<span class="sh_symbol">=</span><span class="sh_string">"no"</span></li><li>TYPE<span class="sh_symbol">=</span><span class="sh_string">"Ethernet"</span></li><li>BOOTPROTO <span class="sh_symbol">=</span><span class="sh_string">"dhcp"</span></li><li><span class="sh_symbol">[</span>root@localhost <span class="sh_symbol">~]</span># systemctl restart network</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@localhost ~]# vim /etc/sysconfig/network-scripts/ifcfg-eth0
DEVICE="eth0"
ONBOOT="yes"
IPV6INIT="no"
TYPE="Ethernet"
BOOTPROTO ="dhcp"
[root@localhost ~]# systemctl restart network
</pre></div></div>
      <p>6）禁用空路由</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@localhost <span class="sh_symbol">~]</span># <span class="sh_normal">vim </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span><span class="sh_normal">sysconfig</span><span class="sh_symbol">/</span>network</li><li>NOZEROCONF<span class="sh_symbol">=</span><span class="sh_string">"yes"</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@localhost ~]# vim /etc/sysconfig/network
NOZEROCONF="yes"
</pre></div></div>
      <p>7）添加console配置</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@localhost <span class="sh_symbol">~]</span># <span class="sh_normal">vim </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span><span class="sh_keyword">default</span><span class="sh_symbol">/</span>grub</li><li>GRUB_CMDLINE_LINUX<span class="sh_symbol">=</span><span class="sh_string">"biosdevname=0 net.ifnames=0 console=ttyS0,115200n8"</span></li><li>GRUB_DISABLE_LINUX_UUID<span class="sh_symbol">=</span><span class="sh_string">"true"</span></li><li>GRUB_ENABLE_LINUX_LABEL<span class="sh_symbol">=</span><span class="sh_string">"true"</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@localhost ~]# vim /etc/default/grub
GRUB_CMDLINE_LINUX="biosdevname=0 net.ifnames=0 console=ttyS0,115200n8"
GRUB_DISABLE_LINUX_UUID="true"
GRUB_ENABLE_LINUX_LABEL="true"
</pre></div></div>
      <p>8）重新生成grub.cfg</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@localhost <span class="sh_symbol">~]</span># grub2<span class="sh_symbol">-</span>mkconfig   <span class="sh_symbol">-</span><span class="sh_normal">o  </span><span class="sh_symbol">/</span><span class="sh_normal">boot</span><span class="sh_symbol">/</span><span class="sh_normal">grub2</span><span class="sh_symbol">/</span>grub<span class="sh_symbol">.</span>cfg</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@localhost ~]# grub2-mkconfig   -o  /boot/grub2/grub.cfg
</pre></div></div>
      <p>9）安装扩展分区软件</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@localhost <span class="sh_symbol">~]</span># yum  install  <span class="sh_symbol">-</span>y  cloud<span class="sh_symbol">-</span>utils<span class="sh_symbol">-</span>growpart</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@localhost ~]# yum  install  -y  cloud-utils-growpart
</pre></div></div>
      <p>10）第一次开机自动扩容</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@localhost <span class="sh_symbol">~]</span># <span class="sh_regexp">/usr/</span><span class="sh_normal">bin</span><span class="sh_symbol">/</span><span class="sh_normal">growpart </span><span class="sh_symbol">/</span><span class="sh_normal">dev</span><span class="sh_symbol">/</span>vda <span class="sh_number">1</span></li><li><span class="sh_symbol">[</span>root@localhost <span class="sh_symbol">~]</span># <span class="sh_regexp">/usr/</span><span class="sh_normal">sbin</span><span class="sh_symbol">/</span><span class="sh_normal">xfs_growfs   </span><span class="sh_symbol">/</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@localhost ~]# /usr/bin/growpart /dev/vda 1
[root@localhost ~]# /usr/sbin/xfs_growfs   /
</pre></div></div>
      <p>11）关闭虚拟机后执行信息清理工作</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># virt<span class="sh_symbol">-</span>sysprep <span class="sh_symbol">-</span>d centos7<span class="sh_number">.0</span>    </li><li><span class="sh_comment">//真机上面操作，centos7.0为虚拟机名称</span></li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@room9pc01 ~]# virt-sysprep -d centos7.0    
//真机上面操作，centos7.0为虚拟机名称
</pre></div></div>
      <a name="case6">
      </a>
      <h2>6 案例6：离线访问虚拟机问题</h2>
      <p>本案例要求可以离线访问虚拟机：</p>
      <ul class="list">
        <li>利用xml文件生成一个新的虚拟机
</li>
        <li>利用guestmount实现离线访问虚拟机
</li>
      </ul>
      <h3>6.1 步骤</h3>
      <p>实现此案例需要按照如下步骤进行。</p>
      <p class="number">步骤一：用xml生成一个新的虚拟机</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># <span class="sh_normal">cd </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span><span class="sh_normal">libvirt</span><span class="sh_symbol">/</span><span class="sh_normal">qemu</span><span class="sh_symbol">/</span></li><li><span class="sh_symbol">[</span>root@room9pc01 qemu<span class="sh_symbol">]</span># cp centos7<span class="sh_number">.0</span><span class="sh_symbol">.</span>xml  local<span class="sh_symbol">.</span>xml</li><li><span class="sh_symbol">[</span>root@room9pc01 qemu<span class="sh_symbol">]</span># vim local<span class="sh_symbol">.</span>xml </li><li><span class="sh_symbol">&lt;</span>domain type<span class="sh_symbol">=</span><span class="sh_string">'kvm'</span><span class="sh_symbol">&gt;</span></li><li>  <span class="sh_symbol">&lt;</span>name<span class="sh_symbol">&gt;</span>local<span class="sh_symbol">&lt;</span><span class="sh_regexp">/name&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/</span><span class="sh_symbol">/</span>修改名字</li><li>  <span class="sh_symbol">&lt;</span>memory unit<span class="sh_symbol">=</span><span class="sh_string">'KiB'</span><span class="sh_symbol">&gt;</span><span class="sh_number">2048000</span><span class="sh_symbol">&lt;</span><span class="sh_regexp">/memory&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/</span><span class="sh_symbol">/</span>修改内存</li><li>  <span class="sh_symbol">&lt;</span>currentMemory unit<span class="sh_symbol">=</span><span class="sh_string">'KiB'</span><span class="sh_symbol">&gt;</span><span class="sh_number">2048000</span><span class="sh_symbol">&lt;/</span>currentMemory<span class="sh_symbol">&gt;</span></li><li><span class="sh_symbol">...</span></li><li>      <span class="sh_symbol">&lt;</span>source file<span class="sh_symbol">=</span><span class="sh_string">'/var/lib/libvirt/images/local.img'</span><span class="sh_regexp">/&gt; &nbsp;&nbsp;&nbsp;&nbsp;/</span><span class="sh_symbol">/</span>img文件位置</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@room9pc01 ~]# cd /etc/libvirt/qemu/
[root@room9pc01 qemu]# cp centos7.0.xml  local.xml
[root@room9pc01 qemu]# vim local.xml 
&lt;domain type='kvm'&gt;
  &lt;name&gt;local&lt;/name&gt;		//修改名字
  &lt;memory unit='KiB'&gt;2048000&lt;/memory&gt;		//修改内存
  &lt;currentMemory unit='KiB'&gt;2048000&lt;/currentMemory&gt;
...
      &lt;source file='/var/lib/libvirt/images/local.img'/&gt; 	//img文件位置
</pre></div></div>
      <p>注意：除这些外还要把mac地址删掉，带address字样的全部删除</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># <span class="sh_normal">cd </span><span class="sh_symbol">/</span><span class="sh_keyword">var</span><span class="sh_regexp">/lib/</span><span class="sh_normal">libvirt</span><span class="sh_symbol">/</span><span class="sh_normal">images</span><span class="sh_symbol">/</span></li><li><span class="sh_symbol">[</span>root@room9pc01 images<span class="sh_symbol">]</span># qemu<span class="sh_symbol">-</span>img  create –b node<span class="sh_symbol">.</span>qcow2 –f qcow2 local<span class="sh_symbol">.</span>img</li><li><span class="sh_symbol">[</span>root@room9pc01 images<span class="sh_symbol">]</span># virsh <span class="sh_normal">define </span><span class="sh_symbol">/</span><span class="sh_normal">etc</span><span class="sh_symbol">/</span><span class="sh_normal">libvirt</span><span class="sh_symbol">/</span><span class="sh_normal">qemu</span><span class="sh_symbol">/</span>local<span class="sh_symbol">.</span>xml</li><li><span class="sh_symbol">[</span>root@room9pc01 images<span class="sh_symbol">]</span># virsh start local</li><li><span class="sh_symbol">[</span>root@room9pc01 images<span class="sh_symbol">]</span># virsh console local</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@room9pc01 ~]# cd /var/lib/libvirt/images/
[root@room9pc01 images]# qemu-img  create –b node.qcow2 –f qcow2 local.img
[root@room9pc01 images]# virsh define /etc/libvirt/qemu/local.xml
[root@room9pc01 images]# virsh start local
[root@room9pc01 images]# virsh console local
</pre></div></div>
      <p class="number">步骤二：guestmount实现离线访问</p>
      <p>基本用法：guestmount  -a  虚拟机磁盘路径  -i  /挂载点</p>
      <p>-a：指定虚拟磁盘</p>
      <p>-i：挂载点</p>
      <div class="snippet-container" style="undefined;"><div class="sh_acid snippet-wrap"><div class="snippet-menu sh_sourceCode" style="display:none;"><pre style="display: none;"><a class="snippet-copy sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#" style="display: none;">copy</a><a class="snippet-text sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">text</a><a class="snippet-window sh_url" href="http://tts.tmooc.cn/ttsPage/LINUX/NSDTN201801/CLOUD/DAY01/CASE/01/index.html#">pop-up</a></pre></div><pre class="code sh_javascript snippet-formatted sh_sourceCode"><ol class="snippet-num"><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># <span class="sh_normal">mkdir </span><span class="sh_symbol">/</span><span class="sh_normal">mnt</span><span class="sh_symbol">/</span>kdisk</li><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># guestmount  <span class="sh_symbol">-</span>a  node1<span class="sh_symbol">.</span>qcow2  <span class="sh_symbol">-</span><span class="sh_normal">i  </span><span class="sh_symbol">/</span><span class="sh_normal">mnt</span><span class="sh_symbol">/</span>kdisk</li><li><span class="sh_symbol">[</span>root@room9pc01 <span class="sh_symbol">~]</span># <span class="sh_normal">cd </span><span class="sh_symbol">/</span><span class="sh_normal">mnt</span><span class="sh_symbol">/</span>kdisk</li><li><span class="sh_symbol">[</span>root@room9pc01 kdisk<span class="sh_symbol">]</span>#  ls</li><li>bin   &nbsp;&nbsp;&nbsp;&nbsp;home  &nbsp;&nbsp;&nbsp;&nbsp;media  &nbsp;&nbsp;&nbsp;&nbsp;opt    &nbsp;&nbsp;&nbsp;&nbsp;sbin &nbsp;&nbsp;&nbsp;&nbsp;tmp</li><li>boot  &nbsp;&nbsp;&nbsp;&nbsp;lib      misc   &nbsp;&nbsp;&nbsp;&nbsp;proc   &nbsp;&nbsp;&nbsp;&nbsp;selinux &nbsp;&nbsp;&nbsp;&nbsp;usr</li></ol></pre><pre class="snippet-textonly sh_sourceCode" style="display:none;">[root@room9pc01 ~]# mkdir /mnt/kdisk
[root@room9pc01 ~]# guestmount  -a  node1.qcow2  -i  /mnt/kdisk
[root@room9pc01 ~]# cd /mnt/kdisk
[root@room9pc01 kdisk]#  ls
bin   	home  	media  	opt    	sbin 	tmp
boot  	lib      misc   	proc   	selinux 	usr
</pre></div></div>
      <h3>6.2 </h3>
    </div>
  
</body></html>